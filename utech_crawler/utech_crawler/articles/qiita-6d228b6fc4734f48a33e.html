<!DOCTYPE html><html xmlns:og="http://ogp.me/ns#"><head><meta charset="UTF-8" /><title>【解答例】Haskellによる8086逆アセンブラ開発入門 - Qiita</title><meta content="width=device-width,initial-scale=1" name="viewport" /><meta content="Haskellによる8086逆アセンブラ開発入門の解答例です。


2進数

【問1】数値を2進数の文字列に変換する関数binをテストファーストで作成してください。


テスト

    , &quot;bin 1&quot; ~: bin 5  ~?= &quot;101&quot;
    , &quot;bin 2&quot; ~: bin 25 ~?= &quot;11001&quot;




実装

intToBin 0 = &#39;0&#39;
intToBin 1 = &#39;1&#39;

bin x
    | x1 == 0   = x2
    | o..." name="description" /><meta content="summary" name="twitter:card" /><meta content="@Qiita" name="twitter:site" /><meta content="7shi" name="twitter:creator" /><meta content="【解答例】Haskellによる8086逆アセンブラ開発入門 - Qiita" property="og:title" /><meta content="article" property="og:type" /><meta content="http://qiita.com/7shi/items/6d228b6fc4734f48a33e" property="og:url" /><meta content="http://cdn.qiita.com/assets/qiita-fb-2887e7b4aad86fd8c25cea84846f2236.png" property="og:image" /><meta content="[Haskellによる8086逆アセンブラ開発入門](http://qiita.com/7shi/items/026839b2bc193dbfb0cb)の解答例です。

# 2進数

【問1】数値を2進数の文字列に変換する関数`bin..." property="og:description" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><link rel="shortcut icon" type="image/x-icon" href="http://cdn.qiita.com/assets/favicons/public/production-4ff10c1e1e2b5fcb353ff9cafdd56c70.ico" /><link rel="apple-touch-icon" type="image/png" href="http://cdn.qiita.com/assets/favicons/public/apple-touch-icon-f9a6afad761ec2306e10db2736187c8b.png" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link rel="stylesheet" media="all" href="http://cdn.qiita.com/assets/public-e8d29e8ff1879118096f0f5877946857.min.css" /><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="q27yHo8dgDFfz+qm2ExN0Tqvo4slokjGHGP52oWDeMjF7GlGFDO5eqAcX7qoufOIWuiHOLJmEjEgvfAhZI12Dg==" /></head><body class="without-js" id=""><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-TBQWPN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>
  document.body.className = document.body.className.replace('without-js', '') + ' with-js';
  window.Qiita = {"asset_host":"cdn.qiita.com","TLD":"com","controller_path":"public/items","controller_action":"public/items#show","controller":"items","action":"show","env":"production","flash":{},"is_landing_page":false,"is_team_page":false,"root_domain":"qiita.com","variant":null,"config":{"mixpanel":{"career":"dd35af27e959781713d63fd7ca898a8d","per_team":"c0a2116368b33b44b5029ebd2cc9b094","public":"be87616606b0e26a87689099aab2c4e5","team":"b7c0342acba2dbc8742484d98788efb3"},"default_locale":"ja","locale":"en"},"team":null,"user":null,"GIT_BRANCH":null,"DEBUG":false};

</script>
<div class="headerContainer headerContainer-public" role="navigation"><div data-react-class="T.HeaderContainer" data-react-props="{&quot;user&quot;:null,&quot;team&quot;:null,&quot;news&quot;:{&quot;type&quot;:&quot;News&quot;,&quot;content&quot;:&quot;ストックの他に「いいね」が追加されました&quot;,&quot;url&quot;:&quot;http://blog.qiita.com/post/153200849029/qiita-like-button&quot;},&quot;initial_unread_count&quot;:null,&quot;siteid_image&quot;:&quot;http://cdn.qiita.com/siteid-reverse.png&quot;,&quot;is_team_page&quot;:false,&quot;on_team_setting&quot;:false,&quot;show_post_menu&quot;:true,&quot;show_search_menu&quot;:true,&quot;is_fluid&quot;:false,&quot;locale&quot;:&quot;en&quot;}"></div></div><div id="main"><ol class="itemBreadcrumbs" itemscope="" itemtype="http://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="/"><span itemprop="name">Qiita</span></a><meta content="1" itemprop="position" /></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="/items"><span itemprop="name">Items</span></a><meta content="2" itemprop="position" /></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="/tags/Haskell"><span itemprop="name">Haskell</span></a><meta content="3" itemprop="position" /></li></ol><article itemscope="" itemtype="http://schema.org/Article"><div class="ArticleMainHeader "><div class="container"></div><div class="container"><div class="row s-flex-align-center"><div class="col-sm-9"><h1 class="ArticleMainHeader__title">【解答例】Haskellによる8086逆アセンブラ開発入門</h1><ul class="TagList"><li class="TagList__item" data-count="1345"><a class="u-link-unstyled TagList__label" href="/tags/Haskell"><img alt="Haskell" class="TagList__icon" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/373b3b0595a92712b2a45616f53dae97bc1a04e5/medium.jpg?1387913155" /><span>Haskell</span></a></li><li class="TagList__item" data-count="8"><a class="u-link-unstyled TagList__label" href="/tags/Intel8086"><img alt="Intel8086" class="TagList__icon" src="//cdn.qiita.com/assets/icons/medium/missing-2e17009a0b32a6423572b0e6dc56727e.png" /><span>Intel8086</span></a></li></ul></div><div class="col-sm-3"><div class="itemsShowHeaderStock"><ul class="list-unstyled itemsShowHeaderStock_statusList"><li><div class="itemsShowHeaderStock_count stock"><span class="fa fa-thumbs-up"></span><span class="js-likecount">8</span></div><div class="itemsShowHeaderStock_countText">Like</div></li><li><div class="itemsShowHeaderStock_count" content="0 UserComments" itemprop="interactionCount"><span class="fa fa-comment"></span>0</div><div class="itemsShowHeaderStock_countText">Comment</div></li></ul></div><div class="js-likebutton" data-props="{&quot;like_status&quot;:false,&quot;like_count&quot;:8,&quot;uuid&quot;:&quot;6d228b6fc4734f48a33e&quot;,&quot;likable_type&quot;:&quot;Article&quot;,&quot;position&quot;:&quot;article-header&quot;}"></div><ul class="list-inline ArticleMainHeader__users"><li class="js-hovercard" data-hovercard-target-name="kasumani"><a itemprop="url" href="/kasumani"><img alt="kasumani" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/3397/profile-images/1473683087" /></a></li><li class="js-hovercard" data-hovercard-target-name="Reds"><a itemprop="url" href="/Reds"><img alt="Reds" class="thumb thumb--xs" src="https://0.gravatar.com/avatar/e751888e30cdc35253c1a3b241977adf?d=https%3A%2F%2Fidenticons.github.com%2F0e2f15414d97b8b642022be91ff105e0.png" /></a></li><li class="js-hovercard" data-hovercard-target-name="takehironet"><a itemprop="url" href="/takehironet"><img alt="takehironet" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/20589/profile-images/1473683057" /></a></li><li class="js-hovercard" data-hovercard-target-name="SuperAlloyZZ"><a itemprop="url" href="/SuperAlloyZZ"><img alt="SuperAlloyZZ" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/46744/profile-images/1473690751" /></a></li><li class="js-hovercard" data-hovercard-target-name="HirotoKagotani"><a itemprop="url" href="/HirotoKagotani"><img alt="HirotoKagotani" class="thumb thumb--xs" src="https://secure.gravatar.com/avatar/0a3d8eae4760b65766757df2475e09df?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" /></a></li><li class="js-hovercard" data-hovercard-target-name="studiokingyo"><a itemprop="url" href="/studiokingyo"><img alt="studiokingyo" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/25682/profile-images/1473684389" /></a></li><li class="js-hovercard" data-hovercard-target-name="KAGE_MIKU"><a itemprop="url" href="/KAGE_MIKU"><img alt="KAGE_MIKU" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/35230/profile-images/1473686650" /></a></li><li class="js-hovercard" data-hovercard-target-name="kou_tana77"><a itemprop="url" href="/kou_tana77"><img alt="kou_tana77" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/45958/profile-images/1473690481" /></a></li></ul></div></div></div></div><div class="ArticleAsideHeader"><div class="container"><div class="u-flex u-space-between"><div class="u-flex u-flex-wrap"><div class="u-flex u-align-center s-pdv-5 u-flex-wrap"><div class="ArticleAsideHeader__author"><a href="/7shi"><img class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/32057/profile-images/1473685823" alt="1473685823" /></a> <a class="u-link-unstyled" href="/7shi">7shi</a> </div><div class="ArticleAsideHeader__date"><span data-toggle="tooltip" title="posted at 2014-08-31">Edited at <time datetime="2015-01-09T15:04:06+09:00" itemprop="dateModified">2015-01-09</time></span></div></div><div class="u-flex u-align-center s-pdv-5 mobile-hidden"><div class="ArticleAsideHeader__revision"> <a data-toggle="tooltip" title="Revisions" href="/7shi/items/6d228b6fc4734f48a33e/revisions"><span class="fa fa-history"></span></a><span class="ArticleAsideHeader__revisionCount">16</span></div></div><div class="u-flex u-align-center s-pdv-5 mobile-hidden"></div></div><div class="u-flex u-align-center s-flex-justiry-between s-pdv-5 u-shrink-0"><div class="ArticleAsideHeader__stock"><div class="js-stockbutton" data-position="top" data-props="{&quot;stock_status&quot;:false}"></div></div><div class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="fa fa-ellipsis-h fa-lg"></span></a><ul class="dropdown-menu dropdown-menu-right"><li class="dropdown__item--mobile"><a href="/7shi/items/6d228b6fc4734f48a33e/revisions"><span class="fa fa-fw fa-history"></span> Revisions<span>(16)</span></a></li><li><a href="/7shi/items/6d228b6fc4734f48a33e.md"><span class="fa fa-fw fa-file-text-o"></span> Show article as Markdown</a></li><li><a data-target=".js-report-form" data-toggle="modal" href="#"><span class="fa fa-fw fa-flag"></span> Report article</a></li></ul></div></div></div></div></div><div class="container"><div class="row" id="article-body-wrapper"><div class="col-sm-9"><section class="markdownContent markdownContent-headingEnabled js-task-list-container clearfix position-relative" id="item-6d228b6fc4734f48a33e" itemprop="articleBody"><div class="alert alert-warning"><i class="fa fa-clock-o"></i> More than 1 year has passed since last update.</div><p><a href="http://qiita.com/7shi/items/026839b2bc193dbfb0cb" id="reference-e09b5d96bb736c14fb6f">Haskellによる8086逆アセンブラ開発入門</a>の解答例です。</p>

<h1>
<span id="2進数" class="fragment"></span><a href="#2%E9%80%B2%E6%95%B0"><i class="fa fa-link"></i></a>2進数</h1>

<p>【問1】数値を2進数の文字列に変換する関数<code>bin</code>をテストファーストで作成してください。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">テスト</span></div>
<div class="highlight"><pre>
    <span class="p">,</span> <span class="s">"bin 1"</span> <span class="o">~:</span> <span class="n">bin</span> <span class="mi">5</span>  <span class="o">~?=</span> <span class="s">"101"</span>
    <span class="p">,</span> <span class="s">"bin 2"</span> <span class="o">~:</span> <span class="n">bin</span> <span class="mi">25</span> <span class="o">~?=</span> <span class="s">"11001"</span>
</pre></div>
</div>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">実装</span></div>
<div class="highlight"><pre>
<span class="nf">intToBin</span> <span class="mi">0</span> <span class="ow">=</span> <span class="n">'0'</span>
<span class="nf">intToBin</span> <span class="mi">1</span> <span class="ow">=</span> <span class="n">'1'</span>

<span class="nf">bin</span> <span class="n">x</span>
    <span class="o">|</span> <span class="n">x1</span> <span class="o">==</span> <span class="mi">0</span>   <span class="ow">=</span> <span class="n">x2</span>
    <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">bin</span> <span class="n">x1</span> <span class="o">++</span> <span class="n">x2</span>
    <span class="kr">where</span>
        <span class="n">x1</span> <span class="ow">=</span> <span class="n">x</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="mi">2</span>
        <span class="n">x2</span> <span class="ow">=</span> <span class="p">[</span><span class="n">intToBin</span> <span class="p">(</span><span class="n">x</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="mi">2</span><span class="p">)]</span>
</pre></div>
</div>

<p>⇒ <a href="https://bitbucket.org/7shi/ikebin-hs-2/commits/73af0f54093f0853318c778abb0ca39d020fa7c7" rel="nofollow noopener" target="_blank">リビジョン 1</a></p>

<h1>
<span id="16進数" class="fragment"></span><a href="#16%E9%80%B2%E6%95%B0"><i class="fa fa-link"></i></a>16進数</h1>

<p>【問2】16進数の文字列を数値に変換する関数<code>hexStrToInt</code>をテストファーストで作成してください。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">テスト</span></div>
<div class="highlight"><pre>
    <span class="p">,</span> <span class="s">"digitToInt"</span> <span class="o">~:</span> <span class="n">digitToInt</span> <span class="n">'a'</span> <span class="o">~?=</span> <span class="mi">10</span>
    <span class="p">,</span> <span class="s">"hexStrToInt 1"</span> <span class="o">~:</span> <span class="n">hexStrToInt</span> <span class="s">"100"</span>  <span class="o">~?=</span> <span class="mi">256</span>
    <span class="p">,</span> <span class="s">"hexStrToInt 2"</span> <span class="o">~:</span> <span class="n">hexStrToInt</span> <span class="s">"ffff"</span> <span class="o">~?=</span> <span class="mi">65535</span>
</pre></div>
</div>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">importに追加</span></div>
<div class="highlight"><pre>
<span class="kr">import</span> <span class="nn">Data.Char</span>
</pre></div>
</div>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">実装</span></div>
<div class="highlight"><pre>
<span class="nf">hexStrToInt</span> <span class="n">hex</span> <span class="ow">=</span> <span class="n">f</span> <span class="p">(</span><span class="n">reverse</span> <span class="n">hex</span><span class="p">)</span>
    <span class="kr">where</span>
        <span class="n">f</span> <span class="s">""</span>     <span class="ow">=</span> <span class="mi">0</span>
        <span class="n">f</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">digitToInt</span> <span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span> <span class="o">*</span> <span class="p">(</span><span class="n">f</span> <span class="n">xs</span><span class="p">)</span>
</pre></div>
</div>

<p>⇒ <a href="https://bitbucket.org/7shi/ikebin-hs-2/commits/a302aab23fc918f6861e9d01c1e8ebbfb1b4e391" rel="nofollow noopener" target="_blank">リビジョン 2</a></p>

<p>【問3】数値を16進数の文字列に変換する関数<code>hex</code>をテストファーストで作成してください。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">テスト</span></div>
<div class="highlight"><pre>
    <span class="p">,</span> <span class="s">"intToDigit"</span> <span class="o">~:</span> <span class="n">intToDigit</span> <span class="mi">10</span>  <span class="o">~?=</span> <span class="n">'a'</span>
    <span class="p">,</span> <span class="s">"hex 1"</span> <span class="o">~:</span> <span class="n">hex</span> <span class="mi">256</span>   <span class="o">~?=</span> <span class="s">"100"</span>
    <span class="p">,</span> <span class="s">"hex 2"</span> <span class="o">~:</span> <span class="n">hex</span> <span class="mi">65535</span> <span class="o">~?=</span> <span class="s">"ffff"</span>
</pre></div>
</div>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">実装</span></div>
<div class="highlight"><pre>
<span class="nf">hex</span> <span class="n">x</span>
    <span class="o">|</span> <span class="n">x1</span> <span class="o">==</span> <span class="mi">0</span>   <span class="ow">=</span> <span class="n">x2</span>
    <span class="o">|</span> <span class="n">otherwise</span> <span class="ow">=</span> <span class="n">hex</span> <span class="n">x1</span> <span class="o">++</span> <span class="n">x2</span>
    <span class="kr">where</span>
        <span class="n">x1</span> <span class="ow">=</span> <span class="n">x</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="mi">16</span>
        <span class="n">x2</span> <span class="ow">=</span> <span class="p">[</span><span class="n">intToDigit</span> <span class="p">(</span><span class="n">x</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="mi">16</span><span class="p">)]</span>
</pre></div>
</div>

<p>⇒ <a href="https://bitbucket.org/7shi/ikebin-hs-2/commits/104ff8feb5de21d6aa3ab0d36be6c02dc57e2535" rel="nofollow noopener" target="_blank">リビジョン 3</a></p>

<h1>
<span id="ビッグエンディアン" class="fragment"></span><a href="#%E3%83%93%E3%83%83%E3%82%B0%E3%82%A8%E3%83%B3%E3%83%87%E3%82%A3%E3%82%A2%E3%83%B3"><i class="fa fa-link"></i></a>ビッグエンディアン</h1>

<p>【問4】数値⇔ビッグエンディアンの相互変換を実装してください。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">テスト</span></div>
<div class="highlight"><pre>
    <span class="p">,</span> <span class="s">"toBE 1"</span> <span class="o">~:</span> <span class="n">toBE</span> <span class="mi">2</span> <span class="mi">1</span>          <span class="o">~?=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">,</span> <span class="s">"toBE 2"</span> <span class="o">~:</span> <span class="n">toBE</span> <span class="mi">2</span> <span class="mh">0x10000</span>    <span class="o">~?=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="p">,</span> <span class="s">"toBE 3"</span> <span class="o">~:</span> <span class="n">toBE</span> <span class="mi">4</span> <span class="mh">0x12345678</span> <span class="o">~?=</span> <span class="p">[</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">]</span>
    <span class="p">,</span> <span class="s">"fromBE 1"</span> <span class="o">~:</span> <span class="n">fromBE</span> <span class="mi">2</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>                   <span class="o">~?=</span> <span class="mh">0x1</span>
    <span class="p">,</span> <span class="s">"fromBE 2"</span> <span class="o">~:</span> <span class="n">fromBE</span> <span class="mi">2</span> <span class="p">[</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">]</span> <span class="o">~?=</span> <span class="mh">0x7856</span>
    <span class="p">,</span> <span class="s">"fromBE 3"</span> <span class="o">~:</span> <span class="n">fromBE</span> <span class="mi">4</span> <span class="p">[</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">]</span> <span class="o">~?=</span> <span class="mh">0x78563412</span>
</pre></div>
</div>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">実装</span></div>
<div class="highlight"><pre>
<span class="nf">toBE</span> <span class="mi">0</span> <span class="kr">_</span> <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">toBE</span> <span class="n">n</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">(</span><span class="n">x</span> <span class="p">`</span><span class="n">div</span><span class="p">`</span> <span class="mh">0x100</span><span class="o">^</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="p">`</span><span class="n">mod</span><span class="p">`</span> <span class="mh">0x100</span> <span class="kt">:</span> <span class="n">toBE</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">x</span>

<span class="nf">fromBE</span> <span class="mi">0</span> <span class="kr">_</span> <span class="ow">=</span> <span class="mi">0</span>
<span class="nf">fromBE</span> <span class="n">n</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mh">0x100</span><span class="o">^</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fromBE</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="n">xs</span>
</pre></div>
</div>

<p>⇒ <a href="https://bitbucket.org/7shi/ikebin-hs-2/commits/4a74827b7eef68f0f06b04099d79d056fc847f9b" rel="nofollow noopener" target="_blank">リビジョン 9</a></p>

<h2>
<span id="別解" class="fragment"></span><a href="#%E5%88%A5%E8%A7%A3"><i class="fa fa-link"></i></a>別解</h2>

<p>リトルエンディアン実装を利用します。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">別実装</span></div>
<div class="highlight"><pre>
<span class="nf">toBE</span> <span class="n">n</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">reverse</span> <span class="p">(</span><span class="n">toLE</span> <span class="n">n</span> <span class="n">x</span><span class="p">)</span>
<span class="nf">fromBE</span> <span class="n">n</span> <span class="n">x</span> <span class="ow">=</span> <span class="n">fromLE</span> <span class="n">n</span> <span class="p">(</span><span class="n">reverse</span> <span class="p">(</span><span class="n">take</span> <span class="n">n</span> <span class="n">x</span><span class="p">))</span>
</pre></div>
</div>

<h1>
<span id="ビット演算" class="fragment"></span><a href="#%E3%83%93%E3%83%83%E3%83%88%E6%BC%94%E7%AE%97"><i class="fa fa-link"></i></a>ビット演算</h1>

<p>【問5】今まで実装した関数をビット演算で書き換えてください。</p>

<p>（準備中）</p>

<h1>
<span id="modrm" class="fragment"></span><a href="#modrm"><i class="fa fa-link"></i></a>ModR/M</h1>

<p>【問6】以下の手順で<code>modrm</code>の実装を完成させてください。</p>

<ol>
<li>mod=10,11の機械語をバイナリエディタで作る。</li>
<li>ndisasmで逆アセンブルしてアセンブリ言語を確認する。</li>
<li>テストケースを作る。</li>
<li>逆アセンブラを実装する。</li>
</ol>

<h2>
<span id="mod-10" class="fragment"></span><a href="#mod-10"><i class="fa fa-link"></i></a>mod 10</h2>

<p>ディスプレースメントが2バイトです。mod 01のテストの下位に00を入れてテストとします。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">テスト</span></div>
<div class="highlight"><pre>
    <span class="p">,</span> <span class="s">"88-8b mod=10 1"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89800001"</span> <span class="o">~?=</span> <span class="s">"mov [bx+si+0x100],ax"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=10 2"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"898900FF"</span> <span class="o">~?=</span> <span class="s">"mov [bx+di-0x100],cx"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=10 3"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89920002"</span> <span class="o">~?=</span> <span class="s">"mov [bp+si+0x200],dx"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=10 4"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"899B00FE"</span> <span class="o">~?=</span> <span class="s">"mov [bp+di-0x200],bx"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=10 5"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89A40064"</span> <span class="o">~?=</span> <span class="s">"mov [si+0x6400],sp"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=10 6"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89AD009C"</span> <span class="o">~?=</span> <span class="s">"mov [di-0x6400],bp"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=10 7"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89B60000"</span> <span class="o">~?=</span> <span class="s">"mov [bp+0x0],si"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=10 8"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89B60001"</span> <span class="o">~?=</span> <span class="s">"mov [bp+0x100],si"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=10 9"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89BF0001"</span> <span class="o">~?=</span> <span class="s">"mov [bx+0x100],di"</span>
</pre></div>
</div>

<p>2バイトのディスプレースメントを処理する関数を実装します。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">テスト</span></div>
<div class="highlight"><pre>
    <span class="p">,</span> <span class="s">"disp16 1"</span> <span class="o">~:</span> <span class="n">disp16</span> <span class="mi">0</span>      <span class="o">~?=</span> <span class="s">"+0x0"</span>
    <span class="p">,</span> <span class="s">"disp16 2"</span> <span class="o">~:</span> <span class="n">disp16</span> <span class="mh">0x7fff</span> <span class="o">~?=</span> <span class="s">"+0x7fff"</span>
    <span class="p">,</span> <span class="s">"disp16 3"</span> <span class="o">~:</span> <span class="n">disp16</span> <span class="mh">0x8000</span> <span class="o">~?=</span> <span class="s">"-0x8000"</span>
    <span class="p">,</span> <span class="s">"disp16 4"</span> <span class="o">~:</span> <span class="n">disp16</span> <span class="mh">0xffff</span> <span class="o">~?=</span> <span class="s">"-0x1"</span>
</pre></div>
</div>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">実装</span></div>
<div class="highlight"><pre>
<span class="nf">disp16</span> <span class="n">x</span>
    <span class="o">|</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mh">0x8000</span> <span class="ow">=</span> <span class="s">"+0x"</span> <span class="o">++</span> <span class="n">hex</span> <span class="n">x</span>
    <span class="o">|</span> <span class="n">otherwise</span>  <span class="ow">=</span> <span class="s">"-0x"</span> <span class="o">++</span> <span class="n">hex</span> <span class="p">(</span><span class="mh">0x10000</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span>
</pre></div>
</div>

<p><code>modrm</code>に追加します。</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">modrm</span> <span class="n">w</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">f</span> <span class="n">mode</span> <span class="n">rm</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span>
    <span class="kr">where</span>
        <span class="err">（略）</span>
        <span class="n">f</span> <span class="mi">2</span> <span class="n">rm</span> <span class="ow">=</span> <span class="s">"["</span> <span class="o">++</span> <span class="n">regad</span> <span class="o">!!</span> <span class="n">rm</span> <span class="o">++</span> <span class="n">disp</span> <span class="o">++</span> <span class="s">"]"</span>
            <span class="kr">where</span>
                <span class="n">disp</span> <span class="ow">=</span> <span class="n">disp16</span> <span class="p">(</span><span class="n">fromLE</span> <span class="mi">2</span> <span class="n">xs</span><span class="p">)</span>
</pre></div></div>

<p>ヒント: <code>fromLE</code>の使い方は少し上を見てください。</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
        <span class="n">f</span> <span class="mi">0</span> <span class="mi">6</span>  <span class="ow">=</span> <span class="s">"[0x"</span> <span class="o">++</span> <span class="n">hex</span> <span class="p">(</span><span class="n">fromLE</span> <span class="mi">2</span> <span class="n">xs</span><span class="p">)</span> <span class="o">++</span> <span class="s">"]"</span>
</pre></div></div>

<p>⇒ <a href="https://bitbucket.org/7shi/ikebin-hs-2/commits/eca7b6283af39cf11893e1b71280d9d9e3aa0a27" rel="nofollow noopener" target="_blank">リビジョン 25</a></p>

<h2>
<span id="mod-11" class="fragment"></span><a href="#mod-11"><i class="fa fa-link"></i></a>mod 11</h2>

<p>R/Mはレジスタ番号を表して、ディスプレースメントはありません。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">テスト</span></div>
<div class="highlight"><pre>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=1 1"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89C0"</span> <span class="o">~?=</span> <span class="s">"mov ax,ax"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=1 2"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89C1"</span> <span class="o">~?=</span> <span class="s">"mov cx,ax"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=1 3"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89C2"</span> <span class="o">~?=</span> <span class="s">"mov dx,ax"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=1 4"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89C3"</span> <span class="o">~?=</span> <span class="s">"mov bx,ax"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=1 5"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89C4"</span> <span class="o">~?=</span> <span class="s">"mov sp,ax"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=1 6"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89C5"</span> <span class="o">~?=</span> <span class="s">"mov bp,ax"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=1 7"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89C6"</span> <span class="o">~?=</span> <span class="s">"mov si,ax"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=1 8"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"89C7"</span> <span class="o">~?=</span> <span class="s">"mov di,ax"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=0 1"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"88C0"</span> <span class="o">~?=</span> <span class="s">"mov al,al"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=0 2"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"88C1"</span> <span class="o">~?=</span> <span class="s">"mov cl,al"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=0 3"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"88C2"</span> <span class="o">~?=</span> <span class="s">"mov dl,al"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=0 4"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"88C3"</span> <span class="o">~?=</span> <span class="s">"mov bl,al"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=0 5"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"88C4"</span> <span class="o">~?=</span> <span class="s">"mov ah,al"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=0 6"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"88C5"</span> <span class="o">~?=</span> <span class="s">"mov ch,al"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=0 7"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"88C6"</span> <span class="o">~?=</span> <span class="s">"mov dh,al"</span>
    <span class="p">,</span> <span class="s">"88-8b mod=11,w=0 8"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"88C7"</span> <span class="o">~?=</span> <span class="s">"mov bh,al"</span>
</pre></div>
</div>

<p>レジスタを決めるには<code>modrm</code>に<code>w</code>を渡す必要があります。</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">modrm</span> <span class="n">w</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">f</span> <span class="n">mode</span> <span class="n">rm</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span>
    <span class="kr">where</span>
        <span class="err">（略）</span>
        <span class="n">f</span> <span class="mi">3</span> <span class="n">rm</span> <span class="ow">=</span> <span class="n">regs</span> <span class="o">!!</span> <span class="n">w</span> <span class="o">!!</span> <span class="n">rm</span>
</pre></div></div>

<p>引数を増やしたので、呼び出し側も修正します。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">disasm</span></div>
<div class="highlight"><pre>
            <span class="p">(</span><span class="n">rm</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">=</span> <span class="n">modrm</span> <span class="n">w</span> <span class="n">xs</span>
</pre></div>
</div>

<p>⇒ <a href="https://bitbucket.org/7shi/ikebin-hs-2/commits/0d91cc7bb3056e4bb6c30a4a67dc993886aa23ed" rel="nofollow noopener" target="_blank">リビジョン 26</a></p>

<h1>
<span id="mov命令の2番目" class="fragment"></span><a href="#mov%E5%91%BD%E4%BB%A4%E3%81%AE2%E7%95%AA%E7%9B%AE"><i class="fa fa-link"></i></a>mov命令の2番目</h1>

<p>【問7】mov命令の2番目<code>Immediate to Register/Memory</code>を実装してください。</p>

<p>各mod,wでテストを作ります。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">テスト</span></div>
<div class="highlight"><pre>
    <span class="p">,</span> <span class="s">"c6-c7 mod=00,w=0 1"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"C60012"</span>       <span class="o">~?=</span> <span class="s">"mov byte [bx+si],0x12"</span>
    <span class="p">,</span> <span class="s">"c6-c7 mod=00,w=0 2"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"C606123456"</span>   <span class="o">~?=</span> <span class="s">"mov byte [0x3412],0x56"</span>
    <span class="p">,</span> <span class="s">"c6-c7 mod=01,w=0"</span>   <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"C6401234"</span>     <span class="o">~?=</span> <span class="s">"mov byte [bx+si+0x12],0x34"</span>
    <span class="p">,</span> <span class="s">"c6-c7 mod=10,w=0"</span>   <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"C680123456"</span>   <span class="o">~?=</span> <span class="s">"mov byte [bx+si+0x3412],0x56"</span>
    <span class="p">,</span> <span class="s">"c6-c7 mod=11,w=0"</span>   <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"C6C012"</span>       <span class="o">~?=</span> <span class="s">"mov al,0x12"</span>
    <span class="p">,</span> <span class="s">"c6-c7 mod=00,w=1 1"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"C7001234"</span>     <span class="o">~?=</span> <span class="s">"mov word [bx+si],0x3412"</span>
    <span class="p">,</span> <span class="s">"c6-c7 mod=00,w=1 2"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"C70612345678"</span> <span class="o">~?=</span> <span class="s">"mov word [0x3412],0x7856"</span>
    <span class="p">,</span> <span class="s">"c6-c7 mod=01,w=1"</span>   <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"C740123456"</span>   <span class="o">~?=</span> <span class="s">"mov word [bx+si+0x12],0x5634"</span>
    <span class="p">,</span> <span class="s">"c6-c7 mod=10,w=1"</span>   <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"C78012345678"</span> <span class="o">~?=</span> <span class="s">"mov word [bx+si+0x3412],0x7856"</span>
    <span class="p">,</span> <span class="s">"c6-c7 mod=11,w=1"</span>   <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"C7C01234"</span>     <span class="o">~?=</span> <span class="s">"mov ax,0x3412"</span>
</pre></div>
</div>

<p><code>modrm</code>の引数でプレフィックスの有無を指定して付加します。戻り値にディスプレースメントを含む消費したバイト数を追加します。</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">modrm</span> <span class="n">prefix</span> <span class="n">w</span> <span class="p">(</span><span class="n">x</span><span class="kt">:</span><span class="n">xs</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="n">len</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">reg</span><span class="p">)</span>
    <span class="kr">where</span>
        <span class="p">(</span><span class="n">len</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">=</span> <span class="n">f</span> <span class="n">mode</span> <span class="n">rm</span>
        <span class="n">mode</span> <span class="ow">=</span>  <span class="n">x</span> <span class="p">`</span><span class="n">shiftR</span><span class="p">`</span> <span class="mi">6</span>
        <span class="n">reg</span>  <span class="ow">=</span> <span class="p">(</span><span class="n">x</span> <span class="p">`</span><span class="n">shiftR</span><span class="p">`</span> <span class="mi">3</span><span class="p">)</span> <span class="o">.&amp;.</span> <span class="mi">7</span>
        <span class="n">rm</span>   <span class="ow">=</span>  <span class="n">x</span>             <span class="o">.&amp;.</span> <span class="mi">7</span>
        <span class="n">pfx</span> <span class="o">|</span> <span class="n">prefix</span> <span class="o">&amp;&amp;</span> <span class="n">w</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">=</span> <span class="s">"byte "</span>
            <span class="o">|</span> <span class="n">prefix</span> <span class="o">&amp;&amp;</span> <span class="n">w</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">=</span> <span class="s">"word "</span>
            <span class="o">|</span> <span class="n">otherwise</span>        <span class="ow">=</span> <span class="s">""</span>
        <span class="n">f</span> <span class="mi">0</span> <span class="mi">6</span>  <span class="ow">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">pfx</span> <span class="o">++</span> <span class="s">"[0x"</span> <span class="o">++</span> <span class="n">hex</span> <span class="p">(</span><span class="n">fromLE</span> <span class="mi">2</span> <span class="n">xs</span><span class="p">)</span> <span class="o">++</span> <span class="s">"]"</span><span class="p">)</span>
        <span class="n">f</span> <span class="mi">0</span> <span class="n">rm</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">pfx</span> <span class="o">++</span> <span class="s">"["</span> <span class="o">++</span> <span class="n">regad</span> <span class="o">!!</span> <span class="n">rm</span> <span class="o">++</span> <span class="s">"]"</span><span class="p">)</span>
        <span class="n">f</span> <span class="mi">1</span> <span class="n">rm</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">pfx</span> <span class="o">++</span> <span class="s">"["</span> <span class="o">++</span> <span class="n">regad</span> <span class="o">!!</span> <span class="n">rm</span> <span class="o">++</span> <span class="n">disp</span> <span class="o">++</span> <span class="s">"]"</span><span class="p">)</span>
            <span class="kr">where</span>
                <span class="n">disp</span> <span class="ow">=</span> <span class="n">disp8</span> <span class="p">(</span><span class="n">xs</span> <span class="o">!!</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">f</span> <span class="mi">2</span> <span class="n">rm</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">pfx</span> <span class="o">++</span> <span class="s">"["</span> <span class="o">++</span> <span class="n">regad</span> <span class="o">!!</span> <span class="n">rm</span> <span class="o">++</span> <span class="n">disp</span> <span class="o">++</span> <span class="s">"]"</span><span class="p">)</span>
            <span class="kr">where</span>
                <span class="n">disp</span> <span class="ow">=</span> <span class="n">disp16</span> <span class="p">(</span><span class="n">fromLE</span> <span class="mi">2</span> <span class="n">xs</span><span class="p">)</span>
        <span class="n">f</span> <span class="mi">3</span> <span class="n">rm</span> <span class="ow">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">regs</span> <span class="o">!!</span> <span class="n">w</span> <span class="o">!!</span> <span class="n">rm</span><span class="p">)</span>
</pre></div></div>

<p><code>disasmB</code>に追加します。</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="c1">-- Immediate to Register/Memory [1100011w][mod000r/m][data][data if w=1]</span>
<span class="nf">disasmB</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="n">xs</span> <span class="ow">=</span>
    <span class="s">"mov "</span> <span class="o">++</span> <span class="n">rm</span> <span class="o">++</span> <span class="s">","</span> <span class="o">++</span> <span class="n">imm</span>
    <span class="kr">where</span>
        <span class="p">(</span><span class="n">len</span><span class="p">,</span> <span class="n">rm</span><span class="p">,</span> <span class="kr">_</span><span class="p">)</span> <span class="ow">=</span> <span class="n">modrm</span> <span class="kt">True</span> <span class="n">w</span> <span class="n">xs</span>
        <span class="n">imm</span> <span class="ow">=</span> <span class="s">"0x"</span> <span class="o">++</span> <span class="n">hex</span> <span class="p">(</span><span class="n">fromLE</span> <span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">drop</span> <span class="n">len</span> <span class="n">xs</span><span class="p">))</span>
</pre></div></div>

<p>⇒ <a href="https://bitbucket.org/7shi/ikebin-hs-2/commits/5ff875340d42c5ad1f76d1d57b14d030f7ae18be" rel="nofollow noopener" target="_blank">リビジョン 27</a></p>

<h1>
<span id="mov命令の残り" class="fragment"></span><a href="#mov%E5%91%BD%E4%BB%A4%E3%81%AE%E6%AE%8B%E3%82%8A"><i class="fa fa-link"></i></a>mov命令の残り</h1>

<p>【問8】mov命令の残りを実装してください。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">テスト</span></div>
<div class="highlight"><pre>
    <span class="p">,</span> <span class="s">"a0-a1 w=0"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"A03412"</span> <span class="o">~?=</span> <span class="s">"mov al,[0x1234]"</span>
    <span class="p">,</span> <span class="s">"a0-a1 w=1"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"A13412"</span> <span class="o">~?=</span> <span class="s">"mov ax,[0x1234]"</span>
    <span class="p">,</span> <span class="s">"a2-a3 w=0"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"A23412"</span> <span class="o">~?=</span> <span class="s">"mov [0x1234],al"</span>
    <span class="p">,</span> <span class="s">"a2-a3 w=1"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"A33412"</span> <span class="o">~?=</span> <span class="s">"mov [0x1234],ax"</span>
    <span class="p">,</span> <span class="s">"8e mod=00"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"8E00"</span>     <span class="o">~?=</span> <span class="s">"mov es,[bx+si]"</span>
    <span class="p">,</span> <span class="s">"8e mod=01"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"8E4810"</span>   <span class="o">~?=</span> <span class="s">"mov cs,[bx+si+0x10]"</span>
    <span class="p">,</span> <span class="s">"8e mod=10"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"8E9000F0"</span> <span class="o">~?=</span> <span class="s">"mov ss,[bx+si-0x1000]"</span>
    <span class="p">,</span> <span class="s">"8e mod=11"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"8ED8"</span>     <span class="o">~?=</span> <span class="s">"mov ds,ax"</span>
    <span class="p">,</span> <span class="s">"8c mod=00"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"8C00"</span>     <span class="o">~?=</span> <span class="s">"mov [bx+si],es"</span>
    <span class="p">,</span> <span class="s">"8c mod=01"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"8C4810"</span>   <span class="o">~?=</span> <span class="s">"mov [bx+si+0x10],cs"</span>
    <span class="p">,</span> <span class="s">"8c mod=10"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"8C9000F0"</span> <span class="o">~?=</span> <span class="s">"mov [bx+si-0x1000],ss"</span>
    <span class="p">,</span> <span class="s">"8c mod=11"</span> <span class="o">~:</span> <span class="n">disasm'</span> <span class="s">"8CD8"</span>     <span class="o">~?=</span> <span class="s">"mov ax,ds"</span>
</pre></div>
</div>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">sregを追加</span></div>
<div class="highlight"><pre>
<span class="nf">sreg</span>  <span class="ow">=</span> <span class="p">[</span><span class="s">"es"</span><span class="p">,</span> <span class="s">"cs"</span><span class="p">,</span> <span class="s">"ss"</span><span class="p">,</span> <span class="s">"ds"</span><span class="p">]</span>
</pre></div>
</div>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">disasmBに追加</span></div>
<div class="highlight"><pre>
<span class="c1">-- Memory to Accumulator [1010000w][addr-low][addr-high]</span>
<span class="nf">disasmB</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="n">xs</span> <span class="ow">=</span>
    <span class="s">"mov "</span> <span class="o">++</span> <span class="n">reg</span> <span class="o">++</span> <span class="s">",[0x"</span> <span class="o">++</span> <span class="n">hex</span> <span class="p">(</span><span class="n">fromLE</span> <span class="mi">2</span> <span class="n">xs</span><span class="p">)</span> <span class="o">++</span> <span class="s">"]"</span>
    <span class="kr">where</span>
        <span class="n">reg</span> <span class="ow">=</span> <span class="n">regs</span> <span class="o">!!</span> <span class="n">w</span> <span class="o">!!</span> <span class="mi">0</span>
<span class="c1">-- Accumulator to Memory [1010001w][addr-low][addr-high]</span>
<span class="nf">disasmB</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="n">xs</span> <span class="ow">=</span>
    <span class="s">"mov "</span> <span class="o">++</span> <span class="s">"[0x"</span> <span class="o">++</span> <span class="n">hex</span> <span class="p">(</span><span class="n">fromLE</span> <span class="mi">2</span> <span class="n">xs</span><span class="p">)</span> <span class="o">++</span> <span class="s">"],"</span> <span class="o">++</span> <span class="n">reg</span>
    <span class="kr">where</span>
        <span class="n">reg</span> <span class="ow">=</span> <span class="n">regs</span> <span class="o">!!</span> <span class="n">w</span> <span class="o">!!</span> <span class="mi">0</span>
<span class="c1">-- Register/Memory to Segment Register [10001110][mod0reg r/m]</span>
<span class="nf">disasmB</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="n">xs</span> <span class="ow">=</span>
    <span class="s">"mov "</span> <span class="o">++</span> <span class="n">reg</span> <span class="o">++</span> <span class="s">","</span> <span class="o">++</span> <span class="n">rm</span>
    <span class="kr">where</span>
        <span class="p">(</span><span class="n">len</span><span class="p">,</span> <span class="n">rm</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">=</span> <span class="n">modrm</span> <span class="kt">False</span> <span class="mi">1</span> <span class="n">xs</span>
        <span class="n">reg</span> <span class="ow">=</span> <span class="n">sreg</span> <span class="o">!!</span> <span class="n">r</span>
<span class="c1">-- Segment Register to Register/Memory [10001100][mod0reg r/m]</span>
<span class="nf">disasmB</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="n">xs</span> <span class="ow">=</span>
    <span class="s">"mov "</span> <span class="o">++</span> <span class="n">rm</span> <span class="o">++</span> <span class="s">","</span> <span class="o">++</span> <span class="n">reg</span>
    <span class="kr">where</span>
        <span class="p">(</span><span class="n">len</span><span class="p">,</span> <span class="n">rm</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">=</span> <span class="n">modrm</span> <span class="kt">False</span> <span class="mi">1</span> <span class="n">xs</span>
        <span class="n">reg</span> <span class="ow">=</span> <span class="n">sreg</span> <span class="o">!!</span> <span class="n">r</span>
</pre></div>
</div>

<p>⇒ <a href="https://bitbucket.org/7shi/ikebin-hs-2/commits/ce131a968a8a856c9db33e7bdd31fa73c29662aa" rel="nofollow noopener" target="_blank">リビジョン 28</a></p>

<h1>
<span id="長さも返す" class="fragment"></span><a href="#%E9%95%B7%E3%81%95%E3%82%82%E8%BF%94%E3%81%99"><i class="fa fa-link"></i></a>長さも返す</h1>

<p>【問9】<code>disasm</code>が命令の長さも返すように修正してください。</p>

<div class="code-frame" data-lang="diff">
<div class="code-lang"><span class="bold">disasmBの差分</span></div>
<div class="highlight"><pre>
 -- Register/Memory to/from Register [100010dw][mod reg r/m]
 disasmB (1,0,0,0,1,0,d,w) xs
<span class="gd">-    | d == 0    = "mov " ++ rm  ++ "," ++ reg</span>
<span class="gd">-    | otherwise = "mov " ++ reg ++ "," ++ rm</span>
<span class="gi">+    | d == 0    = (1 + len, "mov " ++ rm  ++ "," ++ reg)</span>
<span class="gi">+    | otherwise = (1 + len, "mov " ++ reg ++ "," ++ rm )</span>
     where
<span class="gd">-        (_, rm, r) = modrm False w xs</span>
<span class="gi">+        (len, rm, r) = modrm False w xs</span>
         reg = regs !! w !! r
 -- Immediate to Register/Memory [1100011w][mod000r/m][data][data if w=1]
 disasmB (1,1,0,0,0,1,1,w) xs =
<span class="gd">-    "mov " ++ rm ++ "," ++ imm</span>
<span class="gi">+    (1 + len + w + 1, "mov " ++ rm ++ "," ++ imm)</span>
     where
         (len, rm, _) = modrm True w xs
         imm = "0x" ++ hex (fromLE (w + 1) (drop len xs))
 -- Immediate to Register [1011wreg][data][data if w=1]
 disasmB (1,0,1,1,w,r,e,g) xs =
<span class="gd">-    "mov " ++ reg ++ "," ++ imm</span>
<span class="gi">+    (2 + w, "mov " ++ reg ++ "," ++ imm)</span>
     where
         reg = regs !! w !! getReg r e g
         imm = "0x" ++ hex (fromLE (w + 1) xs)
 -- Memory to Accumulator [1010000w][addr-low][addr-high]
 disasmB (1,0,1,0,0,0,0,w) xs =
<span class="gd">-    "mov " ++ reg ++ ",[0x" ++ hex (fromLE 2 xs) ++ "]"</span>
<span class="gi">+    (3, "mov " ++ reg ++ ",[0x" ++ hex (fromLE 2 xs) ++ "]")</span>
     where
         reg = regs !! w !! 0
 -- Accumulator to Memory [1010001w][addr-low][addr-high]
 disasmB (1,0,1,0,0,0,1,w) xs =
<span class="gd">-    "mov " ++ "[0x" ++ hex (fromLE 2 xs) ++ "]," ++ reg</span>
<span class="gi">+    (3, "mov " ++ "[0x" ++ hex (fromLE 2 xs) ++ "]," ++ reg)</span>
     where
         reg = regs !! w !! 0
 -- Register/Memory to Segment Register [10001110][mod0reg r/m]
 disasmB (1,0,0,0,1,1,1,0) xs =
<span class="gd">-    "mov " ++ reg ++ "," ++ rm</span>
<span class="gi">+    (1 + len, "mov " ++ reg ++ "," ++ rm)</span>
     where
         (len, rm, r) = modrm False 1 xs
         reg = sreg !! r
 -- Segment Register to Register/Memory [10001100][mod0reg r/m]
 disasmB (1,0,0,0,1,1,0,0) xs =
<span class="gd">-    "mov " ++ rm ++ "," ++ reg</span>
<span class="gi">+    (1 + len, "mov " ++ rm ++ "," ++ reg)</span>
     where
         (len, rm, r) = modrm False 1 xs
         reg = sreg !! r
</pre></div>
</div>

<p>⇒ <a href="https://bitbucket.org/7shi/ikebin-hs-2/commits/c1b76ad95169de6ab9b0cf41b001c476d3b0d8dc" rel="nofollow noopener" target="_blank">リビジョン 29</a></p>

<h1>
<span id="複数命令対応" class="fragment"></span><a href="#%E8%A4%87%E6%95%B0%E5%91%BD%E4%BB%A4%E5%AF%BE%E5%BF%9C"><i class="fa fa-link"></i></a>複数命令対応</h1>

<p>【問10】複数の命令を含んだバイナリを渡すと逆アセンブル結果をリストで返す関数を実装してください。</p>

<p><code>disasm</code>が返す長さを利用して命令を次々に逆アセンブルします。</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">disasms</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">disasms</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">asm</span> <span class="kt">:</span> <span class="n">disasms</span> <span class="p">(</span><span class="n">drop</span> <span class="n">len</span> <span class="n">xs</span><span class="p">)</span>
    <span class="kr">where</span>
        <span class="n">asm</span> <span class="ow">=</span> <span class="n">disasm</span> <span class="n">xs</span>
        <span class="n">len</span> <span class="ow">=</span> <span class="n">fst</span> <span class="n">asm</span>

<span class="nf">disasms'</span> <span class="n">hex</span> <span class="ow">=</span> <span class="p">[</span><span class="n">snd</span> <span class="n">asm</span> <span class="o">|</span> <span class="n">asm</span> <span class="ow">&lt;-</span> <span class="n">disasms</span> <span class="o">$</span> <span class="n">hexStrToList</span> <span class="n">hex</span><span class="p">]</span>
</pre></div></div>

<p>⇒ <a href="https://bitbucket.org/7shi/ikebin-hs-2/commits/305567bf737c864ce004df44e9647439b240c742" rel="nofollow noopener" target="_blank">リビジョン 30</a></p>

<h1>
<span id="ndisasm準拠出力" class="fragment"></span><a href="#ndisasm%E6%BA%96%E6%8B%A0%E5%87%BA%E5%8A%9B"><i class="fa fa-link"></i></a>ndisasm準拠出力</h1>

<p>【問11】逆アセンブル結果にアドレスやダンプを含めてNASMと同じ出力にしてください。</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">importに追加</span></div>
<div class="highlight"><pre>
<span class="kr">import</span> <span class="nn">Data.Char</span>
</pre></div>
</div>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">ndisasm</span> <span class="n">ip</span> <span class="n">xs</span> <span class="ow">=</span> <span class="p">(</span><span class="n">len</span><span class="p">,</span> <span class="n">addr</span> <span class="o">++</span> <span class="s">"  "</span> <span class="o">++</span> <span class="n">dump</span> <span class="o">++</span> <span class="s">"  "</span> <span class="o">++</span> <span class="n">snd</span> <span class="n">asm</span><span class="p">)</span>
    <span class="kr">where</span>
        <span class="n">asm</span>  <span class="ow">=</span> <span class="n">disasm</span> <span class="n">xs</span>
        <span class="n">len</span>  <span class="ow">=</span> <span class="n">fst</span> <span class="n">asm</span>
        <span class="n">addr</span> <span class="ow">=</span> <span class="n">upper</span> <span class="o">$</span> <span class="n">hexn</span> <span class="mi">8</span> <span class="n">ip</span>
        <span class="n">dump</span> <span class="ow">=</span> <span class="n">upper</span> <span class="o">$</span> <span class="n">listToHexStr</span> <span class="n">list</span> <span class="o">++</span> <span class="n">spc</span>
        <span class="n">list</span> <span class="ow">=</span> <span class="n">take</span> <span class="n">len</span> <span class="n">xs</span>
        <span class="n">spc</span>  <span class="ow">=</span> <span class="n">replicate</span> <span class="p">(</span><span class="mi">16</span> <span class="o">-</span> <span class="n">len</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="n">'</span> <span class="n">'</span>
        <span class="n">upper</span> <span class="n">s</span> <span class="ow">=</span> <span class="p">[</span><span class="n">toUpper</span> <span class="n">ch</span> <span class="o">|</span> <span class="n">ch</span> <span class="ow">&lt;-</span> <span class="n">s</span><span class="p">]</span>

<span class="nf">ndisasms</span> <span class="kr">_</span> <span class="kt">[]</span> <span class="ow">=</span> <span class="kt">[]</span>
<span class="nf">ndisasms</span> <span class="n">ip</span> <span class="n">xs</span> <span class="ow">=</span> <span class="n">snd</span> <span class="n">asm</span> <span class="kt">:</span> <span class="n">ndisasms</span> <span class="p">(</span><span class="n">ip</span> <span class="o">+</span> <span class="n">len</span><span class="p">)</span> <span class="p">(</span><span class="n">drop</span> <span class="n">len</span> <span class="n">xs</span><span class="p">)</span>
    <span class="kr">where</span>
        <span class="n">asm</span> <span class="ow">=</span> <span class="n">ndisasm</span> <span class="n">ip</span> <span class="n">xs</span>
        <span class="n">len</span> <span class="ow">=</span> <span class="n">fst</span> <span class="n">asm</span>
</pre></div></div>

<p>⇒ <a href="https://bitbucket.org/7shi/ikebin-hs-2/commits/a5a36de931487d48f7a726a575f1c4c1a54d5a80" rel="nofollow noopener" target="_blank">リビジョン 31</a></p>
<div class="hidden"><form class="js-task-list-update" action="/7shi/items/6d228b6fc4734f48a33e" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><input type="hidden" name="authenticity_token" value="M7EFBEvys7voQpnZm6+vn4R99B8fIBUu+zxIHe9QhBddM55c0NyK8BeRLMXrWhHG5DrQrIjkT9nH4kHmDl6K0Q==" /><input type="hidden" name="updated_at_confirmation_in_unixtime" id="updated_at_confirmation_in_unixtime" value="1420783446" class="js-task-list-updated-at" /><textarea name="raw_body" id="raw_body" class="js-task-list-field">
[Haskellによる8086逆アセンブラ開発入門](http://qiita.com/7shi/items/026839b2bc193dbfb0cb)の解答例です。

# 2進数

【問1】数値を2進数の文字列に変換する関数`bin`をテストファーストで作成してください。

```hs:テスト
    , &quot;bin 1&quot; ~: bin 5  ~?= &quot;101&quot;
    , &quot;bin 2&quot; ~: bin 25 ~?= &quot;11001&quot;
```
```hs:実装
intToBin 0 = &#39;0&#39;
intToBin 1 = &#39;1&#39;

bin x
    | x1 == 0   = x2
    | otherwise = bin x1 ++ x2
    where
        x1 = x `div` 2
        x2 = [intToBin (x `mod` 2)]
```

⇒ [リビジョン 1](https://bitbucket.org/7shi/ikebin-hs-2/commits/73af0f54093f0853318c778abb0ca39d020fa7c7)

# 16進数

【問2】16進数の文字列を数値に変換する関数`hexStrToInt`をテストファーストで作成してください。

```hs:テスト
    , &quot;digitToInt&quot; ~: digitToInt &#39;a&#39; ~?= 10
    , &quot;hexStrToInt 1&quot; ~: hexStrToInt &quot;100&quot;  ~?= 256
    , &quot;hexStrToInt 2&quot; ~: hexStrToInt &quot;ffff&quot; ~?= 65535
```
```hs:importに追加
import Data.Char
```
```hs:実装
hexStrToInt hex = f (reverse hex)
    where
        f &quot;&quot;     = 0
        f (x:xs) = (digitToInt x) + 16 * (f xs)
```

⇒ [リビジョン 2](https://bitbucket.org/7shi/ikebin-hs-2/commits/a302aab23fc918f6861e9d01c1e8ebbfb1b4e391)

【問3】数値を16進数の文字列に変換する関数`hex`をテストファーストで作成してください。

```hs:テスト
    , &quot;intToDigit&quot; ~: intToDigit 10  ~?= &#39;a&#39;
    , &quot;hex 1&quot; ~: hex 256   ~?= &quot;100&quot;
    , &quot;hex 2&quot; ~: hex 65535 ~?= &quot;ffff&quot;
```
```hs:実装
hex x
    | x1 == 0   = x2
    | otherwise = hex x1 ++ x2
    where
        x1 = x `div` 16
        x2 = [intToDigit (x `mod` 16)]
```

⇒ [リビジョン 3](https://bitbucket.org/7shi/ikebin-hs-2/commits/104ff8feb5de21d6aa3ab0d36be6c02dc57e2535)

# ビッグエンディアン

【問4】数値⇔ビッグエンディアンの相互変換を実装してください。

```hs:テスト
    , &quot;toBE 1&quot; ~: toBE 2 1          ~?= [0, 1]
    , &quot;toBE 2&quot; ~: toBE 2 0x10000    ~?= [0, 0]
    , &quot;toBE 3&quot; ~: toBE 4 0x12345678 ~?= [0x12, 0x34, 0x56, 0x78]
    , &quot;fromBE 1&quot; ~: fromBE 2 [0, 1]                   ~?= 0x1
    , &quot;fromBE 2&quot; ~: fromBE 2 [0x78, 0x56, 0x34, 0x12] ~?= 0x7856
    , &quot;fromBE 3&quot; ~: fromBE 4 [0x78, 0x56, 0x34, 0x12] ~?= 0x78563412
```
```hs:実装
toBE 0 _ = []
toBE n x = (x `div` 0x100^(n - 1)) `mod` 0x100 : toBE (n - 1) x

fromBE 0 _ = 0
fromBE n (x:xs) = x * 0x100^(n - 1) + fromBE (n - 1) xs
```

⇒ [リビジョン 9](https://bitbucket.org/7shi/ikebin-hs-2/commits/4a74827b7eef68f0f06b04099d79d056fc847f9b)

## 別解

リトルエンディアン実装を利用します。

```hs:別実装
toBE n x = reverse (toLE n x)
fromBE n x = fromLE n (reverse (take n x))
```

# ビット演算

【問5】今まで実装した関数をビット演算で書き換えてください。

（準備中）

# ModR/M

【問6】以下の手順で`modrm`の実装を完成させてください。

1. mod=10,11の機械語をバイナリエディタで作る。
1. ndisasmで逆アセンブルしてアセンブリ言語を確認する。
1. テストケースを作る。
1. 逆アセンブラを実装する。

## mod 10

ディスプレースメントが2バイトです。mod 01のテストの下位に00を入れてテストとします。

```hs:テスト
    , &quot;88-8b mod=10 1&quot; ~: disasm&#39; &quot;89800001&quot; ~?= &quot;mov [bx+si+0x100],ax&quot;
    , &quot;88-8b mod=10 2&quot; ~: disasm&#39; &quot;898900FF&quot; ~?= &quot;mov [bx+di-0x100],cx&quot;
    , &quot;88-8b mod=10 3&quot; ~: disasm&#39; &quot;89920002&quot; ~?= &quot;mov [bp+si+0x200],dx&quot;
    , &quot;88-8b mod=10 4&quot; ~: disasm&#39; &quot;899B00FE&quot; ~?= &quot;mov [bp+di-0x200],bx&quot;
    , &quot;88-8b mod=10 5&quot; ~: disasm&#39; &quot;89A40064&quot; ~?= &quot;mov [si+0x6400],sp&quot;
    , &quot;88-8b mod=10 6&quot; ~: disasm&#39; &quot;89AD009C&quot; ~?= &quot;mov [di-0x6400],bp&quot;
    , &quot;88-8b mod=10 7&quot; ~: disasm&#39; &quot;89B60000&quot; ~?= &quot;mov [bp+0x0],si&quot;
    , &quot;88-8b mod=10 8&quot; ~: disasm&#39; &quot;89B60001&quot; ~?= &quot;mov [bp+0x100],si&quot;
    , &quot;88-8b mod=10 9&quot; ~: disasm&#39; &quot;89BF0001&quot; ~?= &quot;mov [bx+0x100],di&quot;
```

2バイトのディスプレースメントを処理する関数を実装します。

```hs:テスト
    , &quot;disp16 1&quot; ~: disp16 0      ~?= &quot;+0x0&quot;
    , &quot;disp16 2&quot; ~: disp16 0x7fff ~?= &quot;+0x7fff&quot;
    , &quot;disp16 3&quot; ~: disp16 0x8000 ~?= &quot;-0x8000&quot;
    , &quot;disp16 4&quot; ~: disp16 0xffff ~?= &quot;-0x1&quot;
```
```hs:実装
disp16 x
    | x &lt; 0x8000 = &quot;+0x&quot; ++ hex x
    | otherwise  = &quot;-0x&quot; ++ hex (0x10000 - x)
```

`modrm`に追加します。

```hs
modrm w (x:xs) = (f mode rm, reg)
    where
        （略）
        f 2 rm = &quot;[&quot; ++ regad !! rm ++ disp ++ &quot;]&quot;
            where
                disp = disp16 (fromLE 2 xs)
```

ヒント: `fromLE`の使い方は少し上を見てください。

```hs
        f 0 6  = &quot;[0x&quot; ++ hex (fromLE 2 xs) ++ &quot;]&quot;
```

⇒ [リビジョン 25](https://bitbucket.org/7shi/ikebin-hs-2/commits/eca7b6283af39cf11893e1b71280d9d9e3aa0a27)

## mod 11

R/Mはレジスタ番号を表して、ディスプレースメントはありません。

```hs:テスト
    , &quot;88-8b mod=11,w=1 1&quot; ~: disasm&#39; &quot;89C0&quot; ~?= &quot;mov ax,ax&quot;
    , &quot;88-8b mod=11,w=1 2&quot; ~: disasm&#39; &quot;89C1&quot; ~?= &quot;mov cx,ax&quot;
    , &quot;88-8b mod=11,w=1 3&quot; ~: disasm&#39; &quot;89C2&quot; ~?= &quot;mov dx,ax&quot;
    , &quot;88-8b mod=11,w=1 4&quot; ~: disasm&#39; &quot;89C3&quot; ~?= &quot;mov bx,ax&quot;
    , &quot;88-8b mod=11,w=1 5&quot; ~: disasm&#39; &quot;89C4&quot; ~?= &quot;mov sp,ax&quot;
    , &quot;88-8b mod=11,w=1 6&quot; ~: disasm&#39; &quot;89C5&quot; ~?= &quot;mov bp,ax&quot;
    , &quot;88-8b mod=11,w=1 7&quot; ~: disasm&#39; &quot;89C6&quot; ~?= &quot;mov si,ax&quot;
    , &quot;88-8b mod=11,w=1 8&quot; ~: disasm&#39; &quot;89C7&quot; ~?= &quot;mov di,ax&quot;
    , &quot;88-8b mod=11,w=0 1&quot; ~: disasm&#39; &quot;88C0&quot; ~?= &quot;mov al,al&quot;
    , &quot;88-8b mod=11,w=0 2&quot; ~: disasm&#39; &quot;88C1&quot; ~?= &quot;mov cl,al&quot;
    , &quot;88-8b mod=11,w=0 3&quot; ~: disasm&#39; &quot;88C2&quot; ~?= &quot;mov dl,al&quot;
    , &quot;88-8b mod=11,w=0 4&quot; ~: disasm&#39; &quot;88C3&quot; ~?= &quot;mov bl,al&quot;
    , &quot;88-8b mod=11,w=0 5&quot; ~: disasm&#39; &quot;88C4&quot; ~?= &quot;mov ah,al&quot;
    , &quot;88-8b mod=11,w=0 6&quot; ~: disasm&#39; &quot;88C5&quot; ~?= &quot;mov ch,al&quot;
    , &quot;88-8b mod=11,w=0 7&quot; ~: disasm&#39; &quot;88C6&quot; ~?= &quot;mov dh,al&quot;
    , &quot;88-8b mod=11,w=0 8&quot; ~: disasm&#39; &quot;88C7&quot; ~?= &quot;mov bh,al&quot;
```

レジスタを決めるには`modrm`に`w`を渡す必要があります。

```hs
modrm w (x:xs) = (f mode rm, reg)
    where
        （略）
        f 3 rm = regs !! w !! rm
```

引数を増やしたので、呼び出し側も修正します。

```hs:disasm
            (rm, r) = modrm w xs
```

⇒ [リビジョン 26](https://bitbucket.org/7shi/ikebin-hs-2/commits/0d91cc7bb3056e4bb6c30a4a67dc993886aa23ed)

# mov命令の2番目

【問7】mov命令の2番目`Immediate to Register/Memory`を実装してください。

各mod,wでテストを作ります。

```hs:テスト
    , &quot;c6-c7 mod=00,w=0 1&quot; ~: disasm&#39; &quot;C60012&quot;       ~?= &quot;mov byte [bx+si],0x12&quot;
    , &quot;c6-c7 mod=00,w=0 2&quot; ~: disasm&#39; &quot;C606123456&quot;   ~?= &quot;mov byte [0x3412],0x56&quot;
    , &quot;c6-c7 mod=01,w=0&quot;   ~: disasm&#39; &quot;C6401234&quot;     ~?= &quot;mov byte [bx+si+0x12],0x34&quot;
    , &quot;c6-c7 mod=10,w=0&quot;   ~: disasm&#39; &quot;C680123456&quot;   ~?= &quot;mov byte [bx+si+0x3412],0x56&quot;
    , &quot;c6-c7 mod=11,w=0&quot;   ~: disasm&#39; &quot;C6C012&quot;       ~?= &quot;mov al,0x12&quot;
    , &quot;c6-c7 mod=00,w=1 1&quot; ~: disasm&#39; &quot;C7001234&quot;     ~?= &quot;mov word [bx+si],0x3412&quot;
    , &quot;c6-c7 mod=00,w=1 2&quot; ~: disasm&#39; &quot;C70612345678&quot; ~?= &quot;mov word [0x3412],0x7856&quot;
    , &quot;c6-c7 mod=01,w=1&quot;   ~: disasm&#39; &quot;C740123456&quot;   ~?= &quot;mov word [bx+si+0x12],0x5634&quot;
    , &quot;c6-c7 mod=10,w=1&quot;   ~: disasm&#39; &quot;C78012345678&quot; ~?= &quot;mov word [bx+si+0x3412],0x7856&quot;
    , &quot;c6-c7 mod=11,w=1&quot;   ~: disasm&#39; &quot;C7C01234&quot;     ~?= &quot;mov ax,0x3412&quot;
```

`modrm`の引数でプレフィックスの有無を指定して付加します。戻り値にディスプレースメントを含む消費したバイト数を追加します。

```hs
modrm prefix w (x:xs) = (len, s, reg)
    where
        (len, s) = f mode rm
        mode =  x `shiftR` 6
        reg  = (x `shiftR` 3) .&amp;. 7
        rm   =  x             .&amp;. 7
        pfx | prefix &amp;&amp; w == 0 = &quot;byte &quot;
            | prefix &amp;&amp; w == 1 = &quot;word &quot;
            | otherwise        = &quot;&quot;
        f 0 6  = (3, pfx ++ &quot;[0x&quot; ++ hex (fromLE 2 xs) ++ &quot;]&quot;)
        f 0 rm = (1, pfx ++ &quot;[&quot; ++ regad !! rm ++ &quot;]&quot;)
        f 1 rm = (2, pfx ++ &quot;[&quot; ++ regad !! rm ++ disp ++ &quot;]&quot;)
            where
                disp = disp8 (xs !! 0)
        f 2 rm = (3, pfx ++ &quot;[&quot; ++ regad !! rm ++ disp ++ &quot;]&quot;)
            where
                disp = disp16 (fromLE 2 xs)
        f 3 rm = (1, regs !! w !! rm)
```

`disasmB`に追加します。

```hs
-- Immediate to Register/Memory [1100011w][mod000r/m][data][data if w=1]
disasmB (1,1,0,0,0,1,1,w) xs =
    &quot;mov &quot; ++ rm ++ &quot;,&quot; ++ imm
    where
        (len, rm, _) = modrm True w xs
        imm = &quot;0x&quot; ++ hex (fromLE (w + 1) (drop len xs))
```

⇒ [リビジョン 27](https://bitbucket.org/7shi/ikebin-hs-2/commits/5ff875340d42c5ad1f76d1d57b14d030f7ae18be)

# mov命令の残り

【問8】mov命令の残りを実装してください。

```hs:テスト
    , &quot;a0-a1 w=0&quot; ~: disasm&#39; &quot;A03412&quot; ~?= &quot;mov al,[0x1234]&quot;
    , &quot;a0-a1 w=1&quot; ~: disasm&#39; &quot;A13412&quot; ~?= &quot;mov ax,[0x1234]&quot;
    , &quot;a2-a3 w=0&quot; ~: disasm&#39; &quot;A23412&quot; ~?= &quot;mov [0x1234],al&quot;
    , &quot;a2-a3 w=1&quot; ~: disasm&#39; &quot;A33412&quot; ~?= &quot;mov [0x1234],ax&quot;
    , &quot;8e mod=00&quot; ~: disasm&#39; &quot;8E00&quot;     ~?= &quot;mov es,[bx+si]&quot;
    , &quot;8e mod=01&quot; ~: disasm&#39; &quot;8E4810&quot;   ~?= &quot;mov cs,[bx+si+0x10]&quot;
    , &quot;8e mod=10&quot; ~: disasm&#39; &quot;8E9000F0&quot; ~?= &quot;mov ss,[bx+si-0x1000]&quot;
    , &quot;8e mod=11&quot; ~: disasm&#39; &quot;8ED8&quot;     ~?= &quot;mov ds,ax&quot;
    , &quot;8c mod=00&quot; ~: disasm&#39; &quot;8C00&quot;     ~?= &quot;mov [bx+si],es&quot;
    , &quot;8c mod=01&quot; ~: disasm&#39; &quot;8C4810&quot;   ~?= &quot;mov [bx+si+0x10],cs&quot;
    , &quot;8c mod=10&quot; ~: disasm&#39; &quot;8C9000F0&quot; ~?= &quot;mov [bx+si-0x1000],ss&quot;
    , &quot;8c mod=11&quot; ~: disasm&#39; &quot;8CD8&quot;     ~?= &quot;mov ax,ds&quot;
```
```hs:sregを追加
sreg  = [&quot;es&quot;, &quot;cs&quot;, &quot;ss&quot;, &quot;ds&quot;]
```
```hs:disasmBに追加
-- Memory to Accumulator [1010000w][addr-low][addr-high]
disasmB (1,0,1,0,0,0,0,w) xs =
    &quot;mov &quot; ++ reg ++ &quot;,[0x&quot; ++ hex (fromLE 2 xs) ++ &quot;]&quot;
    where
        reg = regs !! w !! 0
-- Accumulator to Memory [1010001w][addr-low][addr-high]
disasmB (1,0,1,0,0,0,1,w) xs =
    &quot;mov &quot; ++ &quot;[0x&quot; ++ hex (fromLE 2 xs) ++ &quot;],&quot; ++ reg
    where
        reg = regs !! w !! 0
-- Register/Memory to Segment Register [10001110][mod0reg r/m]
disasmB (1,0,0,0,1,1,1,0) xs =
    &quot;mov &quot; ++ reg ++ &quot;,&quot; ++ rm
    where
        (len, rm, r) = modrm False 1 xs
        reg = sreg !! r
-- Segment Register to Register/Memory [10001100][mod0reg r/m]
disasmB (1,0,0,0,1,1,0,0) xs =
    &quot;mov &quot; ++ rm ++ &quot;,&quot; ++ reg
    where
        (len, rm, r) = modrm False 1 xs
        reg = sreg !! r
```

⇒ [リビジョン 28](https://bitbucket.org/7shi/ikebin-hs-2/commits/ce131a968a8a856c9db33e7bdd31fa73c29662aa)

# 長さも返す

【問9】`disasm`が命令の長さも返すように修正してください。

```diff:disasmBの差分
 -- Register/Memory to/from Register [100010dw][mod reg r/m]
 disasmB (1,0,0,0,1,0,d,w) xs
-    | d == 0    = &quot;mov &quot; ++ rm  ++ &quot;,&quot; ++ reg
-    | otherwise = &quot;mov &quot; ++ reg ++ &quot;,&quot; ++ rm
+    | d == 0    = (1 + len, &quot;mov &quot; ++ rm  ++ &quot;,&quot; ++ reg)
+    | otherwise = (1 + len, &quot;mov &quot; ++ reg ++ &quot;,&quot; ++ rm )
     where
-        (_, rm, r) = modrm False w xs
+        (len, rm, r) = modrm False w xs
         reg = regs !! w !! r
 -- Immediate to Register/Memory [1100011w][mod000r/m][data][data if w=1]
 disasmB (1,1,0,0,0,1,1,w) xs =
-    &quot;mov &quot; ++ rm ++ &quot;,&quot; ++ imm
+    (1 + len + w + 1, &quot;mov &quot; ++ rm ++ &quot;,&quot; ++ imm)
     where
         (len, rm, _) = modrm True w xs
         imm = &quot;0x&quot; ++ hex (fromLE (w + 1) (drop len xs))
 -- Immediate to Register [1011wreg][data][data if w=1]
 disasmB (1,0,1,1,w,r,e,g) xs =
-    &quot;mov &quot; ++ reg ++ &quot;,&quot; ++ imm
+    (2 + w, &quot;mov &quot; ++ reg ++ &quot;,&quot; ++ imm)
     where
         reg = regs !! w !! getReg r e g
         imm = &quot;0x&quot; ++ hex (fromLE (w + 1) xs)
 -- Memory to Accumulator [1010000w][addr-low][addr-high]
 disasmB (1,0,1,0,0,0,0,w) xs =
-    &quot;mov &quot; ++ reg ++ &quot;,[0x&quot; ++ hex (fromLE 2 xs) ++ &quot;]&quot;
+    (3, &quot;mov &quot; ++ reg ++ &quot;,[0x&quot; ++ hex (fromLE 2 xs) ++ &quot;]&quot;)
     where
         reg = regs !! w !! 0
 -- Accumulator to Memory [1010001w][addr-low][addr-high]
 disasmB (1,0,1,0,0,0,1,w) xs =
-    &quot;mov &quot; ++ &quot;[0x&quot; ++ hex (fromLE 2 xs) ++ &quot;],&quot; ++ reg
+    (3, &quot;mov &quot; ++ &quot;[0x&quot; ++ hex (fromLE 2 xs) ++ &quot;],&quot; ++ reg)
     where
         reg = regs !! w !! 0
 -- Register/Memory to Segment Register [10001110][mod0reg r/m]
 disasmB (1,0,0,0,1,1,1,0) xs =
-    &quot;mov &quot; ++ reg ++ &quot;,&quot; ++ rm
+    (1 + len, &quot;mov &quot; ++ reg ++ &quot;,&quot; ++ rm)
     where
         (len, rm, r) = modrm False 1 xs
         reg = sreg !! r
 -- Segment Register to Register/Memory [10001100][mod0reg r/m]
 disasmB (1,0,0,0,1,1,0,0) xs =
-    &quot;mov &quot; ++ rm ++ &quot;,&quot; ++ reg
+    (1 + len, &quot;mov &quot; ++ rm ++ &quot;,&quot; ++ reg)
     where
         (len, rm, r) = modrm False 1 xs
         reg = sreg !! r
```

⇒ [リビジョン 29](https://bitbucket.org/7shi/ikebin-hs-2/commits/c1b76ad95169de6ab9b0cf41b001c476d3b0d8dc)

# 複数命令対応

【問10】複数の命令を含んだバイナリを渡すと逆アセンブル結果をリストで返す関数を実装してください。

`disasm`が返す長さを利用して命令を次々に逆アセンブルします。

```hs
disasms [] = []
disasms xs = asm : disasms (drop len xs)
    where
        asm = disasm xs
        len = fst asm

disasms&#39; hex = [snd asm | asm &lt;- disasms $ hexStrToList hex]
```

⇒ [リビジョン 30](https://bitbucket.org/7shi/ikebin-hs-2/commits/305567bf737c864ce004df44e9647439b240c742)

# ndisasm準拠出力

【問11】逆アセンブル結果にアドレスやダンプを含めてNASMと同じ出力にしてください。

```hs:importに追加
import Data.Char
```
```hs
ndisasm ip xs = (len, addr ++ &quot;  &quot; ++ dump ++ &quot;  &quot; ++ snd asm)
    where
        asm  = disasm xs
        len  = fst asm
        addr = upper $ hexn 8 ip
        dump = upper $ listToHexStr list ++ spc
        list = take len xs
        spc  = replicate (16 - len * 2) &#39; &#39;
        upper s = [toUpper ch | ch &lt;- s]

ndisasms _ [] = []
ndisasms ip xs = snd asm : ndisasms (ip + len) (drop len xs)
    where
        asm = ndisasm ip xs
        len = fst asm
```

⇒ [リビジョン 31](https://bitbucket.org/7shi/ikebin-hs-2/commits/a5a36de931487d48f7a726a575f1c4c1a54d5a80)
</textarea><input type="submit" name="commit" value="Save changes" data-disable-with="Save changes" /></form></div></section></div><div class="col-sm-3"><div class="socialButtons"><div class="socialButtons_twitter"><a class="twitter-share-button" data-text="【解答例】Haskellによる8086逆アセンブラ開発入門 by @7shi on @Qiita" data-url="http://qiita.com/7shi/items/6d228b6fc4734f48a33e" href="https://twitter.com/share">Tweet</a></div><div class="socialButtons_hatebu"><a class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" data-hatena-bookmark-title="【解答例】Haskellによる8086逆アセンブラ開発入門" href="http://b.hatena.ne.jp/entry/http://qiita.com/7shi/items/6d228b6fc4734f48a33e" title="Add to Hatena Bookmark"><img alt="Add to Hatena Bookmark" height="20" src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" style="border: none;" width="20" /></a><script async="async" charset="utf-8" src="https://b.st-hatena.com/js/bookmark_button.js" type="text/javascript"></script></div><div class="socialButtons_googlePlus"><div class="g-plusone" data-href="http://qiita.com/7shi/items/6d228b6fc4734f48a33e" data-size="medium"></div></div><div class="socialButtons_facebook"><div class="fb-like" data-action="like" data-href="http://qiita.com/7shi/items/6d228b6fc4734f48a33e" data-layout="button_count" data-share="false" data-show-faces="false"></div></div><div class="socialButtons_pocket"><a class="pocket-btn" data-lang="en" data-pocket-count="horizontal" data-pocket-label="pocket"></a></div></div><section class="itemsShowAuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><a href="/7shi"><img alt="" class="itemsShowAuthorInfo_userIcon" itemprop="image" src="https://qiita-image-store.s3.amazonaws.com/0/32057/profile-images/1473685823" /></a><div class="itemsShowAuthorInfo_profileStats"><strong class="itemsShowAuthorInfo_userName" itemprop="name"><a itemprop="url" href="/7shi">7shi</a></strong><div class="itemsShowAuthorInfo_contribution"><span class="itemsShowAuthorInfo_count">2522</span><span class="itemsShowAuthorInfo_unit">Contribution</span></div><div data-react-class="T.UserFollowButton" data-react-props="{&quot;url_name&quot;:&quot;7shi&quot;,&quot;initial_followed_by&quot;:false,&quot;size&quot;:&quot;btn-xs&quot;,&quot;position&quot;:&quot;author-info&quot;}"></div></div><section class="itemsShowAuthorPopularItems"><h5 class="itemsShowAuthorPopularItems_sectionTitle">Popular Posts</h5><ul class="itemsShowAuthorPopularItems_posts list-unstyled"><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/7shi/items/145f1234f8ec2af923ef">Haskell 超入門</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/7shi/items/547b6137d7a3c482fe68">モナド則がちょっと分かった？</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/7shi/items/cac7b3e9b90bf91b00cc">文字列で学ぶC++入門</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/7shi/items/85afd7bbd5d6c4115ad6">Haskell アクション 超入門</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/7shi/items/d1e5a0c22be6cf61d286">Haskell IDE Leksah 入門</a></li></ul></section></section><div class="scroll-chaser"><div class="google-adsense"><style>.test-text-responsible { width: 200px; height: 200px; }@media(min-width: 1200px) {  .test-text-responsible { width: 250px; height: 250px; }}@media(max-width: 979px) and (min-width: 768px) {  .test-text-responsible { width: 120px; height: 240px; }}@media(max-width: 767px) {  .test-text-responsible { width: 320px; height: 50px; }}</style><script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle test-text-responsible" data-ad-client="ca-pub-8127218772604357" data-ad-slot="3880091879" style="display:inline-block"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div><div data-react-class="T.Toc" data-react-props="{&quot;body&quot;:&quot;\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#2%E9%80%B2%E6%95%B0\&quot;\u003e2進数\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#16%E9%80%B2%E6%95%B0\&quot;\u003e16進数\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E3%83%93%E3%83%83%E3%82%B0%E3%82%A8%E3%83%B3%E3%83%87%E3%82%A3%E3%82%A2%E3%83%B3\&quot;\u003eビッグエンディアン\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%88%A5%E8%A7%A3\&quot;\u003e別解\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E3%83%93%E3%83%83%E3%83%88%E6%BC%94%E7%AE%97\&quot;\u003eビット演算\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#modrm\&quot;\u003eModR/M\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#mod-10\&quot;\u003emod 10\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#mod-11\&quot;\u003emod 11\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#mov%E5%91%BD%E4%BB%A4%E3%81%AE2%E7%95%AA%E7%9B%AE\&quot;\u003emov命令の2番目\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#mov%E5%91%BD%E4%BB%A4%E3%81%AE%E6%AE%8B%E3%82%8A\&quot;\u003emov命令の残り\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E9%95%B7%E3%81%95%E3%82%82%E8%BF%94%E3%81%99\&quot;\u003e長さも返す\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E8%A4%87%E6%95%B0%E5%91%BD%E4%BB%A4%E5%AF%BE%E5%BF%9C\&quot;\u003e複数命令対応\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#ndisasm%E6%BA%96%E6%8B%A0%E5%87%BA%E5%8A%9B\&quot;\u003endisasm準拠出力\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n&quot;,&quot;wrapper&quot;:&quot;#article-body-wrapper&quot;}"></div></div></div><div class="row"><div class="col-sm-9"><div class="ArticleFooter__menu"><div class="s-flex-align-center"><div class="js-likebutton" data-props="{&quot;like_status&quot;:false,&quot;like_count&quot;:8,&quot;show_count&quot;:true,&quot;uuid&quot;:&quot;6d228b6fc4734f48a33e&quot;,&quot;likable_type&quot;:&quot;Article&quot;,&quot;position&quot;:&quot;article-footer&quot;}"></div><div class="ArticleFooter__userList"><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="kasumani"><a itemprop="url" href="/kasumani"><img alt="kasumani" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/3397/profile-images/1473683087" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="Reds"><a itemprop="url" href="/Reds"><img alt="Reds" class="thumb thumb--xs" src="https://0.gravatar.com/avatar/e751888e30cdc35253c1a3b241977adf?d=https%3A%2F%2Fidenticons.github.com%2F0e2f15414d97b8b642022be91ff105e0.png" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="takehironet"><a itemprop="url" href="/takehironet"><img alt="takehironet" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/20589/profile-images/1473683057" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="SuperAlloyZZ"><a itemprop="url" href="/SuperAlloyZZ"><img alt="SuperAlloyZZ" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/46744/profile-images/1473690751" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="HirotoKagotani"><a itemprop="url" href="/HirotoKagotani"><img alt="HirotoKagotani" class="thumb thumb--xs" src="https://secure.gravatar.com/avatar/0a3d8eae4760b65766757df2475e09df?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="studiokingyo"><a itemprop="url" href="/studiokingyo"><img alt="studiokingyo" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/25682/profile-images/1473684389" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="KAGE_MIKU"><a itemprop="url" href="/KAGE_MIKU"><img alt="KAGE_MIKU" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/35230/profile-images/1473686650" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="kou_tana77"><a itemprop="url" href="/kou_tana77"><img alt="kou_tana77" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/45958/profile-images/1473690481" /></a></div></div></div></div><div class="u-flex u-align-center"><div class="ArticleFooter__stock"><div class="js-stockbutton" data-position="footer_menu" data-props="{&quot;stock_status&quot;:false}"></div></div><div class="ArticleFooter__editRequest"><a class="u-link-no-underline" data-toggle="tooltip" title="You can propose improvements about the article to the author 💪" href="/drafts/6d228b6fc4734f48a33e/edit"><span class="fa fa-send-o fa-lg"></span> <span>Edit request</span></a></div><div class="dropdown ArticleFooter__dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="fa fa-ellipsis-h"></span></a><ul class="dropdown-menu dropdown-menu-right"><li><a href="/7shi/items/6d228b6fc4734f48a33e.md"><span class="fa fa-fw fa-file-text-o"></span> Show article as Markdown</a></li><li><a data-target=".js-report-form" data-toggle="modal" href="#"><i class="fa fa-fw fa-flag"></i> Report article</a></li></ul></div></div></div><ul class="references js-referencesView"><li class="references_header"><i class="fa fa-fw fa-link"></i> Linked from these articles</li><li class="references_reference js-reference"><span>Linked from </span><a href="/7shi/items/026839b2bc193dbfb0cb#_reference-ac849f1138885c45333c"><img alt="" width="18" height="18" src="https://qiita-image-store.s3.amazonaws.com/0/32057/profile-images/1473685823" />Haskellによる8086逆アセンブラ開発入門</a><time class="references_datetime js-dateTimeView" datetime="2014-08-31T14:05:54+00:00">over 2 years ago</time></li></ul><div class="itemsShowBody_articleColumnFooter"><div class="socialButtons"><div class="socialButtons_twitter"><a class="twitter-share-button" data-text="【解答例】Haskellによる8086逆アセンブラ開発入門 by @7shi on @Qiita" data-url="http://qiita.com/7shi/items/6d228b6fc4734f48a33e" href="https://twitter.com/share">Tweet</a></div><div class="socialButtons_hatebu"><a class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" data-hatena-bookmark-title="【解答例】Haskellによる8086逆アセンブラ開発入門" href="http://b.hatena.ne.jp/entry/http://qiita.com/7shi/items/6d228b6fc4734f48a33e" title="Add to Hatena Bookmark"><img alt="Add to Hatena Bookmark" height="20" src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" style="border: none;" width="20" /></a><script async="async" charset="utf-8" src="https://b.st-hatena.com/js/bookmark_button.js" type="text/javascript"></script></div><div class="socialButtons_googlePlus"><div class="g-plusone" data-href="http://qiita.com/7shi/items/6d228b6fc4734f48a33e" data-size="medium"></div></div><div class="socialButtons_facebook"><div class="fb-like" data-action="like" data-href="http://qiita.com/7shi/items/6d228b6fc4734f48a33e" data-layout="button_count" data-share="false" data-show-faces="false"></div></div><div class="socialButtons_pocket"><a class="pocket-btn" data-lang="en" data-pocket-count="horizontal" data-pocket-label="pocket"></a></div></div></div><div class="itemsShowComment_wrapper" id="comments"><div data-react-class="T.CommentListContainer" data-react-props="{&quot;currentUser&quot;:null,&quot;initialComments&quot;:[],&quot;monthly_public_image_uploadable_size_limit&quot;:null,&quot;total_uploaded_public_image_size_in_current_month&quot;:null,&quot;item&quot;:{&quot;id&quot;:121870,&quot;uuid&quot;:&quot;6d228b6fc4734f48a33e&quot;,&quot;suspended&quot;:false,&quot;secret&quot;:false},&quot;owner&quot;:{&quot;url_name&quot;:&quot;7shi&quot;},&quot;is_team&quot;:false,&quot;is_project&quot;:false,&quot;logged_in&quot;:false,&quot;polling&quot;:false,&quot;mention_candidates&quot;:[{&quot;id&quot;:32057,&quot;url_name&quot;:&quot;7shi&quot;,&quot;profile_image_url&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/32057/profile-images/1473685823&quot;}]}">Comments Loading...</div></div></div></div></div></article><div class="js-report-form modal fade reportForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Report article</h4></div><div class="modal-body"><form action="/reports" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="1ZP+Vtg+nXDc4fuhPYDKU3cmcWJK0CPY3ouyfWKjzdS7EWUOQxCkOyMyTr1NdXQKF2FV0d0UeS/iVbuGg63DEg==" /><input type="hidden" name="redirect_path" id="redirect_path" value="/7shi/items/6d228b6fc4734f48a33e" /><input type="hidden" name="item_uuid" id="item_uuid" value="6d228b6fc4734f48a33e" /><p>Help us understand the problem. What is going on with this item?</p><br /><div class="form-group"><ul class="list-unstyled"><li><label><input type="radio" name="report_type" id="report_type_spam" value="spam" required="required" /> It&#39;s spam </label></li><li><label><input type="radio" name="report_type" id="report_type_harassment" value="harassment" required="required" /> It&#39;s abusive or harmful </label></li><li><label><input type="radio" name="report_type" id="report_type_inappropriate_content" value="inappropriate_content" required="required" /> It contains inappropriate content </label></li></ul></div><div class="reportForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary reportForm_submitButton"><i class="fa fa-send"></i> Submit</button></div></form></div></div></div></div><script id="js-item" type="application/json">{ "url": "http://qiita.com/7shi/items/6d228b6fc4734f48a33e", "id": 121870, "uuid": "6d228b6fc4734f48a33e" }</script><script class="js-user" type="application/json">{&quot;id&quot;:32057,&quot;url_name&quot;:&quot;7shi&quot;,&quot;profile_image_url&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/32057/profile-images/1473685823&quot;}</script><script language="JavaScript" src="//cdn.bigmining.com/private/js/qiita_bigmining.js" type="text/javascript"></script></div><footer class="footer"><div class="footer_inner"><div class="footer_container"><ul class="footer_links-left"><li class="footer_link"><a class="footer_copyright" href="http://increments.co.jp">© 2011-2017 Increments Inc.</a></li><li class="footer_link"><a href="http://qiita.com/terms">Terms</a></li><li class="footer_link"><a href="http://qiita.com/privacy">Privacy</a></li><li class="footer_link"><a href="http://help.qiita.com">Help</a></li><li class="footer_link"><a href="https://increments.zendesk.com/anonymous_requests/new">Contact</a></li></ul><ul class="footer_links-right"><li class="footer_link"><a href="http://qiita.com/about">About</a></li><li class="footer_link"><a href="/users">Users</a></li><li class="footer_link"><a href="/tags">Tags</a></li><li class="footer_link"><a href="http://blog.qiita.com">Blog</a></li><li class="footer_link"><a href="http://qiita.com/api/v2/docs">API</a></li><li class="footer_link"><a href="https://teams.qiita.com/">Team</a></li><li class="footer_link"><a href="http://kobito.qiita.com">Kobito</a></li><li class="footer_link"><a class="js-public-form-feedback-link" data-target=".js-feedback-form" data-toggle="modal" href=""><i class="fa fa-heart"></i> Feedback <i class="fa fa-caret-down"></i></a></li></ul></div></div></footer><div class="js-feedback-form modal fade feedbackForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Feedback</h4></div><div class="modal-body"><form class="js-feedback-form-form" action="/feedbacks" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="KknUwp60ZNk8/MqItGtMS4Uli0YD27+7FKWe3MN7Mv1Ey0+aBZpdksMvf5TEnvIS5WKv9ZQf5Uwoe5cnInU8Ow==" /><input type="hidden" name="redirect_path" id="redirect_path" value="/7shi/items/6d228b6fc4734f48a33e" /><div class="form-group"><textarea name="feedback[message]" id="feedback_message" class="form-control js-feedback-form-text-area" placeholder="Please give us any feedback about Qiita." required="required" rows="5">
</textarea></div><div class="feedbackForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary feedbackForm_submitButton"><i class="fa fa-send"></i> Submit</button><p class="feedbackForm_note">We don&#39;t reply to any feedback.<br />If you need help with Qiita, please send a support request from <a href="https://increments.zendesk.com/anonymous_requests/new">here</a>.</p></div><div style="position:fixed;top:-99999px;opacity:0.0001;"><input name="feedback[name]" type="text" /></div></form></div></div></div></div><script>// if (window.mixpanel instanceof Element) {
//   window.mixpanel = [];
// }
// (function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
// for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2.2.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);</script><script src="http://cdn.qiita.com/assets/public-8c6201a66dc6db6f64a9017391c319bf.min.js"></script><script>
  (function () {
    var script = document.getElementsByTagName('script')[0];
    var load = function (src, id) {
      var el = document.createElement('script');
      el.async = true;
      el.src = src;
      el.id = id;
      script.parentNode.insertBefore(el, script);
    };
      // Optimizely
      load('//cdn.optimizely.com/js/52738645.js', 'optimizely-jssdk');
      // Google Analytics
      window._gaq = window._gaq || [];
      var isCareer = location.hostname.split('.')[0] == 'career';
      if (isCareer) {
        window._gaq.push(['_setAccount', 'UA-24675221-11']);
        window._gaq.push(['_setDomainName', 'qiita.com']);
      } else {
        window._gaq.push(['_setAccount', 'UA-24675221-1']);
      }
      window._gaq.push(['_setCustomVar', 1, 'logged_in', 'false', 2]);
      window._gaq.push(['_trackPageview']);
      var src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      load(src, 'google-analytics-jssdk');
    // Google Analytics - Universal Analytics
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-24675221-12', {
          
        });
        ga('set', 'dimension1', 'false');
        ga('set', 'dimension3', 'false');
      ga('require', 'displayfeatures');
      ga('set', 'forceSSL', true);
      ga('send', 'pageview');
    // Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TBQWPN');
  })();
</script>
</body></html>