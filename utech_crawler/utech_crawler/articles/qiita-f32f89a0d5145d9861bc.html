<!DOCTYPE html><html xmlns:og="http://ogp.me/ns#"><head><meta charset="UTF-8" /><title>Azure Machine Learning を利用したアプリケーション開発 - Qiita</title><meta content="width=device-width,initial-scale=1" name="viewport" /><meta content="Azure Machine Learningは、Webブラウザで手軽に機械学習のモデルを作成することができるプラットフォームです(2015年2月正式リリース)。

ここで作成したモデルはWeb APIから呼び出すことができます。
今までは機械学習を組み込む・・・となるとPython等のライブラリを使うことが一般的で、なれた言語とは異なるプラットフォームで開発しなければならないことも少なくありませんでしたが、これでWebリクエストさえ飛ばせれば機械学習アルゴリズムを利用し..." name="description" /><meta content="summary" name="twitter:card" /><meta content="@Qiita" name="twitter:site" /><meta content="icoxfog417" name="twitter:creator" /><meta content="Azure Machine Learning を利用したアプリケーション開発 - Qiita" property="og:title" /><meta content="article" property="og:type" /><meta content="http://qiita.com/icoxfog417/items/f32f89a0d5145d9861bc" property="og:url" /><meta content="http://cdn.qiita.com/assets/qiita-fb-2887e7b4aad86fd8c25cea84846f2236.png" property="og:image" /><meta content="Azure Machine Learningは、Webブラウザで手軽に機械学習のモデルを作成することができるプラットフォームです([2015年2月正式リリース](http://www.publickey1.jp/blog/15/azu..." property="og:description" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><link rel="shortcut icon" type="image/x-icon" href="http://cdn.qiita.com/assets/favicons/public/production-4ff10c1e1e2b5fcb353ff9cafdd56c70.ico" /><link rel="apple-touch-icon" type="image/png" href="http://cdn.qiita.com/assets/favicons/public/apple-touch-icon-f9a6afad761ec2306e10db2736187c8b.png" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link rel="stylesheet" media="all" href="http://cdn.qiita.com/assets/public-81dd63f4385f99b52aeab91266068ebd.min.css" /><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="KMCE5MYYc064IhqpZITkoQfJ4Vj0vpiBz/70ZFWZ5kWbR/47aOlsvMtwXyCj2411dMlJqo6vjhBDJ3KQRgHhWw==" /></head><body class="without-js" id=""><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-TBQWPN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>
  document.body.className = document.body.className.replace('without-js', '') + ' with-js';
  window.Qiita = {"asset_host":"cdn.qiita.com","TLD":"com","controller_path":"public/items","controller_action":"public/items#show","controller":"items","action":"show","action_path":"public/items#show","env":"production","flash":{},"is_landing_page":false,"is_team_page":false,"request_parameters":{"controller":"public/items","action":"show","user_id":"icoxfog417","type":"items","id":"f32f89a0d5145d9861bc"},"root_domain":"qiita.com","variant":null,"config":{"mixpanel":{"career":"dd35af27e959781713d63fd7ca898a8d","per_team":"c0a2116368b33b44b5029ebd2cc9b094","public":"be87616606b0e26a87689099aab2c4e5","team":"b7c0342acba2dbc8742484d98788efb3"},"default_locale":"ja","locale":"en"},"team":null,"user":null,"GIT_BRANCH":null,"DEBUG":false};

</script>
<div class="headerContainer headerContainer-public" role="navigation"><div class="js-react-on-rails-component" data-component-name="HeaderContainer" data-props="{&quot;user&quot;:null,&quot;team&quot;:null,&quot;news&quot;:{&quot;type&quot;:&quot;Hot&quot;,&quot;content&quot;:&quot;Markdownによる情報共有サービス、Qiita:Team&quot;,&quot;url&quot;:&quot;https://teams.qiita.com?utm_source=qiita\u0026utm_medium=header_news&quot;},&quot;initial_unread_count&quot;:null,&quot;siteid_image&quot;:&quot;http://cdn.qiita.com/siteid-reverse.png&quot;,&quot;is_team_page&quot;:false,&quot;on_team_setting&quot;:false,&quot;show_post_menu&quot;:true,&quot;show_search_menu&quot;:true,&quot;is_fluid&quot;:false,&quot;locale&quot;:&quot;en&quot;}" data-trace="false" data-dom-id="HeaderContainer-react-component-df458dc8-ba1a-416b-a5c6-ec35dcd2e5d7"></div>
    <div id="HeaderContainer-react-component-df458dc8-ba1a-416b-a5c6-ec35dcd2e5d7"></div>
    
</div><div id="main"><script type="application/ld+json">{  "@context": "http://schema.org",  "@type": "BreadcrumbList",  "itemListElement": [    {      "@type": "ListItem",      "position": 1,      "item": {        "@id": "/",        "name": "Qiita"      }    },    {      "@type": "ListItem",      "position": 2,      "item": {        "@id": "/items",        "name": "Items"      }    },    {      "@type": "ListItem",      "position": 3,      "item": {        "@id": "/tags/AzureMachineLearning",        "name": "AzureMachineLearning"      }    }  ]}</script><article itemscope="" itemtype="http://schema.org/Article"><div class="ArticleMainHeader "><div class="container"></div><div class="container"><div class="row s-flex-align-center"><div class="col-sm-9"><h1 class="ArticleMainHeader__title" itemprop="headline">Azure Machine Learning を利用したアプリケーション開発</h1><ul class="TagList"><li class="TagList__item" data-count="42"><a class="u-link-unstyled TagList__label" href="/tags/AzureMachineLearning"><img alt="AzureMachineLearning" class="TagList__icon" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/7d76d20e105f493653f9e6b8d27235ba179da137/medium.jpg?1442484286" /><span>AzureMachineLearning</span></a></li><li class="TagList__item" data-count="1835"><a class="u-link-unstyled TagList__label" href="/tags/%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92"><img alt="機械学習" class="TagList__icon" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/a94d4d239b3b0b83723d5b56c050ffc54b8593e7/medium.jpg?1394635775" /><span>機械学習</span></a></li><li class="TagList__item" data-count="814"><a class="u-link-unstyled TagList__label" href="/tags/MachineLearning"><img alt="MachineLearning" class="TagList__icon" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/b85c97772bddbfbb48a8b116669349c7ec92e4bf/medium.jpg?1395227038" /><span>MachineLearning</span></a></li><li class="TagList__item" data-count="9910"><a class="u-link-unstyled TagList__label" href="/tags/Python"><img alt="Python" class="TagList__icon" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/28fd3d6b220c89e6197fd82c02fd2fcd2bb66d81/medium.jpg?1383884245" /><span>Python</span><div class="tagIcon_version">3.4.2</div></a></li></ul></div><div class="col-sm-3"><div class="itemsShowHeaderStock"><ul class="list-unstyled itemsShowHeaderStock_statusList"><li><div class="itemsShowHeaderStock_count stock"><span class="fa fa-thumbs-up"></span><span class="js-likecount">125</span></div><div class="itemsShowHeaderStock_countText">Like</div></li><li><div class="itemsShowHeaderStock_count" content="0 UserComments" itemprop="commentCount"><span class="fa fa-comment"></span>0</div><div class="itemsShowHeaderStock_countText">Comment</div></li></ul></div><div class="js-likebutton" data-props="{&quot;like_status&quot;:false,&quot;like_count&quot;:125,&quot;uuid&quot;:&quot;f32f89a0d5145d9861bc&quot;,&quot;likable_type&quot;:&quot;Article&quot;,&quot;position&quot;:&quot;article-header&quot;}"></div><ul class="list-inline ArticleMainHeader__users"><li class="js-hovercard" data-hovercard-target-name="st450"><a itemprop="url" href="/st450"><img alt="st450" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/63970/profile-images/1473696432" /></a></li><li class="js-hovercard" data-hovercard-target-name="canard0328"><a itemprop="url" href="/canard0328"><img alt="canard0328" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/52533/profile-images/1473692763" /></a></li><li class="js-hovercard" data-hovercard-target-name="mettoboshi"><a itemprop="url" href="/mettoboshi"><img alt="mettoboshi" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/42925/profile-images/1473689342" /></a></li><li class="js-hovercard" data-hovercard-target-name="0xfffffff7"><a itemprop="url" href="/0xfffffff7"><img alt="0xfffffff7" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/33116/profile-images/1473686053" /></a></li><li class="js-hovercard" data-hovercard-target-name="masuhajime"><a itemprop="url" href="/masuhajime"><img alt="masuhajime" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/59518/profile-images/1489504014" /></a></li><li class="js-hovercard" data-hovercard-target-name="alg"><a itemprop="url" href="/alg"><img alt="alg" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/12408/profile-images/1473682400" /></a></li><li class="js-hovercard" data-hovercard-target-name="chezou"><a itemprop="url" href="/chezou"><img alt="chezou" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/11143/profile-images/1473681932" /></a></li><li class="js-hovercard" data-hovercard-target-name="shuhei"><a itemprop="url" href="/shuhei"><img alt="shuhei" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/3732/profile-images/1473683476" /></a></li><li class="js-hovercard" data-hovercard-target-name="Ushiki"><a itemprop="url" href="/Ushiki"><img alt="Ushiki" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/48690/profile-images/1473691443" /></a></li><li class="js-hovercard" data-hovercard-target-name="susieyy"><a itemprop="url" href="/susieyy"><img alt="susieyy" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/4943/profile-images/1473681085" /></a></li><li><a href="/icoxfog417/items/f32f89a0d5145d9861bc/likers"><span class="fa fa-ellipsis-h"></span></a></li></ul></div></div></div></div><div class="ArticleAsideHeader"><div class="container"><div class="u-flex u-space-between"><div class="u-flex u-flex-wrap"><div class="u-flex u-align-center s-pdv-5 u-flex-wrap"><div class="ArticleAsideHeader__author"><a href="/icoxfog417"><img class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/25990/profile-images/1484303516" alt="1484303516" /></a> <a class="u-link-unstyled" href="/icoxfog417">icoxfog417</a> </div><div class="ArticleAsideHeader__date"><meta content="2015-03-25T15:30:02+09:00" itemprop="datePublished" /><span data-toggle="tooltip" title="posted at 2015-03-25">Edited at <time datetime="2015-03-25T15:43:45+09:00" itemprop="dateModified">2015-03-25</time></span></div></div><div class="u-flex u-align-center s-pdv-5 mobile-hidden"><div class="ArticleAsideHeader__revision"> <a data-toggle="tooltip" title="Revisions" href="/icoxfog417/items/f32f89a0d5145d9861bc/revisions"><span class="fa fa-history"></span></a><span class="ArticleAsideHeader__revisionCount">4</span></div></div><div class="u-flex u-align-center s-pdv-5 mobile-hidden"></div></div><div class="u-flex u-align-center s-flex-justiry-between s-pdv-5 u-shrink-0"><div class="ArticleAsideHeader__stock"><div class="js-stockbutton" data-position="top" data-props="{&quot;stock_status&quot;:false}"></div></div><div class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="fa fa-ellipsis-h fa-lg"></span></a><ul class="dropdown-menu dropdown-menu-right"><li class="dropdown__item--mobile"><a href="/icoxfog417/items/f32f89a0d5145d9861bc/revisions"><span class="fa fa-fw fa-history"></span> Revisions<span>(4)</span></a></li><li><a href="/icoxfog417/items/f32f89a0d5145d9861bc.md"><span class="fa fa-fw fa-file-text-o"></span> Show article as Markdown</a></li><li><a data-target=".js-report-form" data-toggle="modal" href="#"><span class="fa fa-fw fa-flag"></span> Report article</a></li></ul></div></div></div></div></div><div class="container"><div class="row" id="article-body-wrapper"><div class="col-sm-9"><section class="markdownContent markdownContent-headingEnabled js-task-list-container clearfix position-relative" id="item-f32f89a0d5145d9861bc" itemprop="articleBody"><div class="alert alert-warning"><i class="fa fa-clock-o"></i> More than 1 year has passed since last update.</div><p>Azure Machine Learningは、Webブラウザで手軽に機械学習のモデルを作成することができるプラットフォームです(<a href="http://www.publickey1.jp/blog/15/azure_machine_learningpythonr.html" rel="nofollow noopener" target="_blank">2015年2月正式リリース</a>)。</p>

<p>ここで作成したモデルはWeb APIから呼び出すことができます。<br>
今までは機械学習を組み込む・・・となるとPython等のライブラリを使うことが一般的で、なれた言語とは異なるプラットフォームで開発しなければならないことも少なくありませんでしたが、これでWebリクエストさえ飛ばせれば機械学習アルゴリズムを利用したアプリケーションを開発することが可能になりました。</p>

<p>今回は、このAzure Machine Learningを利用したアプリケーション開発について、その手順を紹介します。以下は、今回作成したモデルの最終的な図になります。このフローに沿って解説していこうと思います。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/b4d91dd5-0607-7510-9841-f1661fb8f08b.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/b4d91dd5-0607-7510-9841-f1661fb8f08b.png" alt="flow1.PNG"></a></p>

<p>このモデル、およびこのモデルを利用したアプリケーションのコードは以下のGithubリポジトリからアクセスできます。ただ、後述する通りモデルの精度は残念なものなので、自分なりのチューニングなどしてみるもの一興かと思います。</p>

<p><a href="https://github.com/icoxfog417/pollen_prediction_by_azure" rel="nofollow noopener" target="_blank">pollen_prediction_by_azure</a></p>

<p>リポジトリのWikiには参考になるサイトへのリンクも貼ってあるので、併せてご参照ください。</p>

<h2>
<span id="0データの準備とモデル設計" class="fragment"></span><a href="#0%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%BA%96%E5%82%99%E3%81%A8%E3%83%A2%E3%83%87%E3%83%AB%E8%A8%AD%E8%A8%88"><i class="fa fa-link"></i></a>0.データの準備とモデル設計</h2>

<p>最初に、どんなデータを学習させて何をさせようとするのかを決めておきます。具体的には、最終的なモデルのインプット/アウトプットを設計し、そのためのデータにあたりを付けます。</p>

<p>機械学習でできることは、本当にざっくり言ってしまえば「値の予測」か「分類の判定」です。これはどんな複雑な、ディープラーニングのような学習機でも変わりません。</p>

<p>まず何を予測／分類したいのかを決め、それに必要なデータが公開していないか漁る、という進め方をした方が効率的に時間が使えることが多いです(経験的に)。ただ、公開されているデータというのもそうないので、その制約に縛られてしまうことも多いですが・・・</p>

<p>今回は、花粉の飛散量を予測することにします。天気予報で得られるパラメーターを入力として花粉の飛散量を予測し、花粉対策に役立てる・・・という寸法です。</p>

<p>花粉の飛散量は以下で公開されているので、これを学習データとして利用します。</p>

<p><a href="http://kafun.taiki.go.jp/map.aspx?Area=03" rel="nofollow noopener" target="_blank">環境省花粉観測システム(はなこさん)</a></p>

<p>天気予報は、実はありそうでなかなか無償で使えるものがなかったのですが、いい感じのものを見つけたのでこちらを利用します。飛散量のデータには気温の他に風速や風向きなどがあるのですが、こちらのAPIではそれらもとることができます。</p>

<p><a href="http://openweathermap.org/api" rel="nofollow noopener" target="_blank">OpenWeatherMap</a></p>

<h2>
<span id="1データの取得" class="fragment"></span><a href="#1%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%96%E5%BE%97"><i class="fa fa-link"></i></a>1.データの取得</h2>

<p>ここからAzure Machine Learningを使っていきます。<a href="http://azure.microsoft.com/ja-jp/services/machine-learning/" rel="nofollow noopener" target="_blank">こちら</a>から今すぐご利用しましょう。左下の＋ボタンから新規にモデルを作成することができます。</p>

<p>最初は、データの読み込みから始めます。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/60e22988-aebc-bc12-39ff-0e0aecf49caa.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/60e22988-aebc-bc12-39ff-0e0aecf49caa.png" alt="reader.PNG"></a></p>

<p>Data sourceとして一番使うのは「Web URL via HTTP」だと思います。今回はGitHubリポジトリにCSVファイルをpushし、そのRAWのアドレスを指定してデータをロードしました。<br>
※残念ながら2015/3時点ではJSON/XMLデータに対応していないため(<a href="https://datamarket.azure.com/browse/data" rel="nofollow noopener" target="_blank">Azure Marketplace</a>で使われているODataは使えます)、フィードやAPIから取得したデータをそのまま入れるのは難しい状況です。</p>

<p>データを取得するため、というか作成したプロセスを実行するには下にある「RUN」のボタンを押します。実行が行われるとデータが取得されているはずです。</p>

<p>Azure Machine Learningの特性として、データの可視化機能が簡単に使えるという点があります。場所が分かりにくいですが、実行後以下の場所で右クリックを押すと「Visualize」というメニューがあるはずです。それを実行すると取得したデータの情報を見ることができます。これできちんとデータが取得できているか確認しましょう。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/480caee7-fd7a-0e56-8786-92b50503e930.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/480caee7-fd7a-0e56-8786-92b50503e930.png" alt="right_click2.PNG"></a></p>

<p>また、Statistical Functionsをつなげることでデータの統計情報について詳細を参照することができます。これは、今後異常値の検知などを行っていくのに役立ちます。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/f1a0d9aa-d717-7241-a5ca-b5ee112c01d9.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/f1a0d9aa-d717-7241-a5ca-b5ee112c01d9.png" alt="statistics.PNG"></a></p>

<p>データがきちんとロードできていたら、Visualizeと同様コンテキストメニューから「Save as Dataset」でデータを保存しておきます。<br>
今後データフローを構築していく中で、何度もプロセスを実行することになります。そのたびにHTTPリクエストで大量のデータを取ってくるのは効率が悪い上取ってくる相手にも負荷をかけてしまうので、Datasetとして保管しいつでも使えるようにしておきます。</p>

<p>ここまでのポイントをまとめておきます。</p>

<ul>
<li>データの取得はReaderで行う。「Web URL via HTTP」により、Web上のファイルを取り込むことができる</li>
<li>RUNによりプロセスの実行を行う</li>
<li>コンテキストメニューによりデータのサマリを見ることができる。Statistical Functionsと合わせ、データの内容の確認に利用する</li>
<li>データは一旦取得したら「Save as Dataset」で保管しておく</li>
</ul>

<h2>
<span id="2データ整形" class="fragment"></span><a href="#2%E3%83%87%E3%83%BC%E3%82%BF%E6%95%B4%E5%BD%A2"><i class="fa fa-link"></i></a>2.データ整形</h2>

<p>データの中には欠損や異常値があったりするので、それを取り除いたり埋めたりする作業を行います。これをしているかしていないかでだいぶ精度が変わったりするので、非常に重要なプロセスです。</p>

<p>下記は、取り込んだデータをStatistical FunctionsのDescriptive Statisticsに繋ぎVisualizeしたものです。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/2c50544d-42e8-3af6-3d91-328897e35cfb.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/2c50544d-42e8-3af6-3d91-328897e35cfb.png" alt="data_preview.PNG"></a></p>

<p>ここから以下のようなことが分かります。</p>

<ul>
<li>Col2(アメダス測定局コード)が空白の欠損データが存在する</li>
<li>Col11(花粉飛散数)は、単位が個数/m3なのでマイナスはないはずだがマイナスのデータがあり、また最大値が異常に大きい(89773)</li>
<li>Col14/Col15(気温・降水量)に異常値と思われる値が-999のデータがある</li>
</ul>

<p>欠損・異常値のデータ件数はそれぞれ82件・4件と全体約30,000件からしてだいぶ少ないので、今回はすべて削除してしまうことにします。<br>
花粉の飛散量については確認したところ一応正常なデータっぽいので一旦はこのまま・・・いったんですが、精度があまり出なかったので最終的には1,500を超えるものは1,500を上限として設定しました。</p>

<p>この1,500という値はデータ提供元であるはなこさんによると花粉の数1,000以上はもうすべからく危険領域であるようだったので、それより少し多めの数でカットすることにしました。<br>
統計情報によると花粉飛散量の3rd Quartile(75%四分位点・小さい準から並べて75%のデータが入る地点)は45であり、ほとんどのデータが小さい範囲に入っていることが分かります。なので、カットの影響はそれほどないはずです。</p>

<p>この時点で回帰というよりは花粉飛散量を大中小ぐらいに分けた分類問題にした方がよさそうな気配がしますが、今回はAzure Machine Learningを使ってアプリケーションを作ってみるということが目的だったので、いったんそこは棚上げにして次に進みます。</p>

<p>欠損データと異常値について方針を決めたら、それを実装していきます。</p>

<ul>
<li>欠損データの処理には、Data TransformationのClean Missing Dataを使います</li>
<li>値によるデータ削除にはPython Language ModelsのExecute Python Scriptを使います</li>
<li>値の上限・下限といった設定にはData TransformationのFilterを使います</li>
</ul>

<p>実際は以下のような感じで実装しました。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/aa5f0167-19ef-f2c6-cdef-39f313db65ba.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/aa5f0167-19ef-f2c6-cdef-39f313db65ba.png" alt="data_manipulation.PNG"></a></p>

<p>Clean Missing Dataに限らず、以後この列に対して～という設定のためにColumn Selectorを開くことがままあります。ここでの設定方法には少し注意が必要です。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/1ef8f996-3dd1-9eb5-06d8-7a478fe6dea3.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/1ef8f996-3dd1-9eb5-06d8-7a478fe6dea3.png" alt="column_selector1.PNG"></a></p>

<p>基本的には、「全ての列からxxを除く」か「yyの列のみ」という指定になります。つまり、Begin WithがAll columnsの場合はExclude、No columnsの場合はIncludeを使うのが原則です。All columnsでさらにIncludeしたりすることに意味はないので注意してください。</p>

<p>Filterは名前からして「xx列がyy以上のデータを削除する」という用途に使えるかと思いきや、そうではありません。Filterは値の上限や下限を設定したりするのに使います(Threshold Filter、Greater Than 1,500なら1,500以上は1,500に設定される)。Apply FilterとFilterを組み合わせることでFilterの適用が可能です。</p>

<p>逆に、「xx列がyy以上のデータを削除する」という用途に使えるものは今のところない・・・ようなので(Clean Missing Dataは欠損値に対してしか作用しない)、Python Scriptで対応することにします。</p>

<p>Python Scriptは受け取るDatasetが引数として渡され、返り値として後続のフローに渡すデータセットを返します。引数の型は<a href="http://pandas.pydata.org/" rel="nofollow noopener" target="_blank">pandas</a>というデータフレームを扱えるライブラリの形式で入ってきます。なお、書けるPythonは2015/3時点では2.7なのでPython3ユーザーは注意してください。</p>

<p>今回使用したScriptは以下のようなものです。異常値と思われる値のデータをはじいています。</p>

<div class="code-frame" data-lang="py"><div class="highlight"><pre>
<span class="c"># The script MUST contain a function named azureml_main</span>
<span class="c"># which is the entry point for this module.</span>
<span class="c">#</span>
<span class="c"># The entry point function can contain up to two input arguments:</span>
<span class="c">#   Param&lt;dataframe1&gt;: a pandas.DataFrame</span>
<span class="c">#   Param&lt;dataframe2&gt;: a pandas.DataFrame</span>
<span class="k">def</span> <span class="nf">azureml_main</span><span class="p">(</span><span class="n">dataframe1</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">dataframe2</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

    <span class="c"># Execution logic goes here</span>
    <span class="c"># print('Input pandas.DataFrame #1:\r\n\r\n{0}'.format(dataframe1))</span>

    <span class="c"># If a zip file is connected to the third input port is connected,</span>
    <span class="c"># it is unzipped under ".\Script Bundle". This directory is added</span>
    <span class="c"># to sys.path. Therefore, if your zip file contains a Python file</span>
    <span class="c"># mymodule.py you can import it using:</span>
    <span class="c"># import mymodule</span>

    <span class="n">erased</span> <span class="o">=</span> <span class="n">dataframe1</span><span class="p">[</span><span class="n">dataframe1</span><span class="o">.</span><span class="n">Col11</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">erased</span> <span class="o">=</span> <span class="n">erased</span><span class="p">[</span><span class="n">erased</span><span class="o">.</span><span class="n">Col14</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">50</span><span class="p">]</span>
    <span class="n">erased</span> <span class="o">=</span> <span class="n">erased</span><span class="p">[</span><span class="n">erased</span><span class="o">.</span><span class="n">Col16</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">]</span>

    <span class="c"># Return value must be of a sequence of pandas.DataFrame</span>
    <span class="k">return</span> <span class="n">erased</span><span class="p">,</span>

</pre></div></div>

<p>ここまで来たらRunを実行してみて、Visualizeでちゃんとデータが処理されているか確認します(欠損値や異常値が消えているかなど)。</p>

<h2>
<span id="3データ項目定義" class="fragment"></span><a href="#3%E3%83%87%E3%83%BC%E3%82%BF%E9%A0%85%E7%9B%AE%E5%AE%9A%E7%BE%A9"><i class="fa fa-link"></i></a>3.データ項目定義</h2>

<p>データの項目定義とは、具体的には以下のようなものです。</p>

<ul>
<li>特徴量として使う項目か、予測値(ラベル値)として使う項目か</li>
<li>データ型</li>
<li>項目名の付与</li>
</ul>

<p>今回は以後のプロセスで扱いやすいよう項目に名前を付け、データ型をFloatにして花粉飛散量を予測値・それ以外を特徴量にしています。<br>
この作業には、Data Transformation &gt; ManipulationのMetadata Editorを利用します。</p>

<p>そして、使う特徴量を絞り込みたい場合はData Transformation &gt; ManipulationのProject Columnsで使う列を絞り込みます。<br>
モデルでは特徴量を突っ込めばいいというものでもなく、予測対象に良く効く少数精鋭で行った方が基本的にはいいです。そのため、すべての特徴量を使う場合でも、プロセスの中にこのProject Columnsを置いておき、後で使う特徴量の数を調整できるようにしておいた方がいいです。</p>

<h2>
<span id="4モデル構築" class="fragment"></span><a href="#4%E3%83%A2%E3%83%87%E3%83%AB%E6%A7%8B%E7%AF%89"><i class="fa fa-link"></i></a>4.モデル構築</h2>

<p>お待ちかねの機械学習モデルの構築を行います。ここまでがだいぶ長かったことからもわかるとおり、機械学習のプロセスとはその大半がデータの整形・加工のプロセスでもあります。</p>

<p>Machine LearningのセクションはEvaluate・Initialize Model・Score・Trainの4つに分かれています。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/673378a0-b5c1-05be-874d-b8f9159a5a4f.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/673378a0-b5c1-05be-874d-b8f9159a5a4f.png" alt="machines.PNG"></a></p>

<p>Initialize Model &gt; Train &gt; Score &gt; Evaluateというのが基本的な流れです。モデルを初期化し、学習させ、評価用データで値を予測させてみて、その結果を評価する、という流れです。</p>

<p>モデル構築ではInitialize Modelを選択し、今回は値の予測を行うのでLinear Regressionを利用します(実はNeural Networkでもやったんですが、あまり精度が出なかったので結局Linear Regressionに戻した)。</p>

<p>ちなみに、提供されているNeural Networkはディープラーニングにも十分対応できるものになっています。特にWindowsではDeep learning系のライブラリをインストールするのが難しかったりするので、大規模なものでない場合やとにかくパターンを色々試してみたい場合はこちらを使うのは十分ありだと思います。</p>

<p>各モデルには初期化パラメータがあり、どんな値を設定するかについてはやはり知識を問われます。Propertiesの一番下からドキュメントを参照することもできるので、そちらも見ながらパラメーターを設定します。</p>

<h2>
<span id="5学習評価" class="fragment"></span><a href="#5%E5%AD%A6%E7%BF%92%E8%A9%95%E4%BE%A1"><i class="fa fa-link"></i></a>5.学習・評価</h2>

<p>ここでモデルとデータがそろったので、それを利用して学習・精度の評価を行います。</p>

<p>まず、Data Transformation &gt; Sample and Split &gt; Splitを使用し学習用と評価用に分割します(下図のイメージ)。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/6cffc6d1-d595-6ee6-6045-b88f37fcde08.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/6cffc6d1-d595-6ee6-6045-b88f37fcde08.png" alt="train.PNG"></a></p>

<p>学習する前にデータの正規化をしないと、と思いますが多くの学習モデルはInitialize ModelのPropertyの一部として正規化の方法を指定するようになっているので、個別に正規化を行う必要はありません。今回のように値の予測を行う場合は、学習時正規化したなら予測値も正規化された値なので、本来は復元のための計算が必要になります・・・が、これもうまいことやってくれるようです。逆にData Transformation &gt; Normalize Dataなどから正規化を行いモデルでの正規化をなしにすると、おそらくこの復元が効かなくなると思います。</p>

<p>学習に使用するTrain Modelで設定するのは予測値(ラベル値)の項目一つだけで、他の項目は特徴量としてモデルに渡されます。<br>
Train Modelからは学習済みのモデルが渡され、それがScore Modelに繋がっていきます。ここで、学習済みのモデルを使用し評価データから値を予測します。予測した値と実際の値の差異は、最後のEvaluate Modelで参照することができます。<br>
もちろん、ここはCross Varidationで一気に済ませるという手もあります。</p>

<p>フローを構築後に、今まで同様RUNでプロセスを実行することで実際に学習や評価が行われます。</p>

<p>気になる結果ですが・・・</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/7cb77f07-ec6a-f0eb-e825-86f530ef75a2.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/7cb77f07-ec6a-f0eb-e825-86f530ef75a2.png" alt="result.PNG"></a></p>

<p>わかりやすいRoot Mean Squared Errorが146というのはあまりよくないニュースです。異常値をはじいた後の花粉飛散量の標準偏差は137.4186であり、Root Mean Squared Errorがこれよりも大きくなってしまっています。</p>

<p>これは予測した値が元々のデータ以上にばらついている、つまり全然あてにならないということを意味しているのでこのモデルによる予測値はほぼ信用ならないことを意味します。</p>

<p>Score ModelでVisualizeをしてみると、よりその傾向が顕著にわかります。下図は、予測した値であるScored Labelsと実際の値である花粉飛散量(pollen)をプロットしたものです。精度が高ければこの2つは完全な相関関係にあるはずなので、左から上に向かってきれいな線が出ていればうまく予測できていることになります・・・が、実際は。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/5b45d338-0782-34ba-60c2-77e372b824fe.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/5b45d338-0782-34ba-60c2-77e372b824fe.png" alt="result2.PNG"></a></p>

<p>この予測は当初簡単かなと思ったんですが(気温が高ければ増えて雨が降れば減る・・・みたいな)、実際そうではありませんでした。<br>
この後もチューニングを試みたんですが思うように精度が上がらなかったので、いったんここは棚に上げそこそこのモデルができたとし、この予測モデルをWebサービスとして使う準備に取り掛かります。</p>

<h2>
<span id="6-webサービス化" class="fragment"></span><a href="#6-web%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E5%8C%96"><i class="fa fa-link"></i></a>6. Webサービス化</h2>

<p>Webサービス化ですが、以下の2種類があります。</p>

<ul>
<li>学習用API：学習データを受け取り、モデルをトレーニングする</li>
<li>予測用API：予測用のデータを受け取り、予測値を返す</li>
</ul>

<p>学習は今作っていた流れそのものなので、下のボタンの「Publish Web Service」を押すことでAPI化することができます。元のデータ以外にWeb APIからの受け取り口と、レスポンスのための出口を用意します。何れもボタンを押すと自動的に追加されます。</p>

<p>実は通常時とWeb APIアクセス時でフローを切り替えることができ、左下の方にあるボタンでどちらの時のフローを構築するのか切り替えることができます。</p>

<p>↓普段は(今までは)左の状態になっていたと思いますが、これを切り替えると右のWeb APIアクセス時にスイッチします<br>
<a href="https://qiita-image-store.s3.amazonaws.com/0/25990/e0805e23-b1aa-c42d-b010-98a292a1ed23.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/e0805e23-b1aa-c42d-b010-98a292a1ed23.png" alt="switch_space.PNG"></a></p>

<p>予測用APIを作成するには、以下のボタンを押します。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/013dc52e-ee12-3957-af99-223711a6923a.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/013dc52e-ee12-3957-af99-223711a6923a.png" alt="create_scoring_model.PNG"></a></p>

<p>これを押すと、学習済みのモデルが組み込まれた予測用のフローがうねうね動いて作成されます。基本的には学習時のフローがコピーされますが、予測時には不要なものもあるのでそうしたプロセスを削除しながら予測時のフローを作成します。</p>

<p>今回は、以下のようなフローを作成しました。項目定義の部分は学習時のフローを踏襲していて、通常時は手で入力したデータを流してテスト(Data Input and Output &gt; Enter Dataを利用)、Web APIアクセス時はPOSTされたデータを受け取り予測値を返します。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/624d0c57-fcf1-bbbd-ccbd-3c68811116e9.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/624d0c57-fcf1-bbbd-ccbd-3c68811116e9.png" alt="web_api_model.PNG"></a></p>

<p>このフローを構築してRUNで動作を確認後、学習用APIと同様「Publish Web Service」でWeb Serviceを公開します。</p>

<p>Web APIのページからはアクセスURLやAPI Keyの確認ができます。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/25990/317f70c2-aa3c-bd10-5e35-52a9cf714ba9.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/25990/317f70c2-aa3c-bd10-5e35-52a9cf714ba9.png" alt="web_api.PNG"></a></p>

<p>ここでAPIのテストができるほか、C#/Python/Rのサンプルコードまで載せてくれています。これを利用することで、学習/予測をWeb API経由で行えるようになります。</p>

<h2>
<span id="実装" class="fragment"></span><a href="#%E5%AE%9F%E8%A3%85"><i class="fa fa-link"></i></a>実装</h2>

<p>今回は最初に決めたとおり天気予報をAPIから取得し、それを入力値として花粉飛散量を予測、これらの結果を合わせて表示させてみました。</p>

<p><a href="https://github.com/icoxfog417/pollen_prediction_by_azure/blob/master/application.py" rel="nofollow noopener" target="_blank">pollen_prediction_by_azure/application.py</a></p>

<p>HTTPリクエストの形式は結構面倒なフォーマットですが、いずれにせよこれでWeb API経由で予測モデルを利用することができるようになりました。</p>

<p>Azure Machine Learningを利用することで手軽にモデルを構築できるほか、Web API経由で様々なプラットフォームから学習・予測をさせることができるようになります。</p>

<p>インストールの手間などもなくすぐに使うことができるので、勉強用・初めての機械学習アプリケーション開発用には良いプラットフォームではないかと思います。</p>
<div class="hidden"><form class="js-task-list-update" action="/icoxfog417/items/f32f89a0d5145d9861bc" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><input type="hidden" name="authenticity_token" value="zukVwEIqBhU1ha3wcE7ccVMMT+Z1h7mLFirwaxeh7ut9bm8f7NsZ50bX6Hm3EbWlIAznFA+Wrxqa83afBDnp9Q==" /><input type="hidden" name="updated_at_confirmation_in_unixtime" id="updated_at_confirmation_in_unixtime" value="1427265825" class="js-task-list-updated-at" /><textarea name="raw_body" id="raw_body" class="js-task-list-field">
Azure Machine Learningは、Webブラウザで手軽に機械学習のモデルを作成することができるプラットフォームです([2015年2月正式リリース](http://www.publickey1.jp/blog/15/azure_machine_learningpythonr.html))。

ここで作成したモデルはWeb APIから呼び出すことができます。
今までは機械学習を組み込む・・・となるとPython等のライブラリを使うことが一般的で、なれた言語とは異なるプラットフォームで開発しなければならないことも少なくありませんでしたが、これでWebリクエストさえ飛ばせれば機械学習アルゴリズムを利用したアプリケーションを開発することが可能になりました。

今回は、このAzure Machine Learningを利用したアプリケーション開発について、その手順を紹介します。以下は、今回作成したモデルの最終的な図になります。このフローに沿って解説していこうと思います。

![flow1.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/b4d91dd5-0607-7510-9841-f1661fb8f08b.png)

このモデル、およびこのモデルを利用したアプリケーションのコードは以下のGithubリポジトリからアクセスできます。ただ、後述する通りモデルの精度は残念なものなので、自分なりのチューニングなどしてみるもの一興かと思います。

[pollen_prediction_by_azure](https://github.com/icoxfog417/pollen_prediction_by_azure)

リポジトリのWikiには参考になるサイトへのリンクも貼ってあるので、併せてご参照ください。

## 0.データの準備とモデル設計

最初に、どんなデータを学習させて何をさせようとするのかを決めておきます。具体的には、最終的なモデルのインプット/アウトプットを設計し、そのためのデータにあたりを付けます。

機械学習でできることは、本当にざっくり言ってしまえば「値の予測」か「分類の判定」です。これはどんな複雑な、ディープラーニングのような学習機でも変わりません。

まず何を予測／分類したいのかを決め、それに必要なデータが公開していないか漁る、という進め方をした方が効率的に時間が使えることが多いです(経験的に)。ただ、公開されているデータというのもそうないので、その制約に縛られてしまうことも多いですが・・・

今回は、花粉の飛散量を予測することにします。天気予報で得られるパラメーターを入力として花粉の飛散量を予測し、花粉対策に役立てる・・・という寸法です。

花粉の飛散量は以下で公開されているので、これを学習データとして利用します。

[環境省花粉観測システム(はなこさん)](http://kafun.taiki.go.jp/map.aspx?Area=03)

天気予報は、実はありそうでなかなか無償で使えるものがなかったのですが、いい感じのものを見つけたのでこちらを利用します。飛散量のデータには気温の他に風速や風向きなどがあるのですが、こちらのAPIではそれらもとることができます。

[OpenWeatherMap](http://openweathermap.org/api)


## 1.データの取得

ここからAzure Machine Learningを使っていきます。[こちら](http://azure.microsoft.com/ja-jp/services/machine-learning/)から今すぐご利用しましょう。左下の＋ボタンから新規にモデルを作成することができます。

最初は、データの読み込みから始めます。

![reader.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/60e22988-aebc-bc12-39ff-0e0aecf49caa.png)

Data sourceとして一番使うのは「Web URL via HTTP」だと思います。今回はGitHubリポジトリにCSVファイルをpushし、そのRAWのアドレスを指定してデータをロードしました。
※残念ながら2015/3時点ではJSON/XMLデータに対応していないため([Azure Marketplace](https://datamarket.azure.com/browse/data)で使われているODataは使えます)、フィードやAPIから取得したデータをそのまま入れるのは難しい状況です。

データを取得するため、というか作成したプロセスを実行するには下にある「RUN」のボタンを押します。実行が行われるとデータが取得されているはずです。

Azure Machine Learningの特性として、データの可視化機能が簡単に使えるという点があります。場所が分かりにくいですが、実行後以下の場所で右クリックを押すと「Visualize」というメニューがあるはずです。それを実行すると取得したデータの情報を見ることができます。これできちんとデータが取得できているか確認しましょう。

![right_click2.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/480caee7-fd7a-0e56-8786-92b50503e930.png)

また、Statistical Functionsをつなげることでデータの統計情報について詳細を参照することができます。これは、今後異常値の検知などを行っていくのに役立ちます。

![statistics.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/f1a0d9aa-d717-7241-a5ca-b5ee112c01d9.png)

データがきちんとロードできていたら、Visualizeと同様コンテキストメニューから「Save as Dataset」でデータを保存しておきます。
今後データフローを構築していく中で、何度もプロセスを実行することになります。そのたびにHTTPリクエストで大量のデータを取ってくるのは効率が悪い上取ってくる相手にも負荷をかけてしまうので、Datasetとして保管しいつでも使えるようにしておきます。

ここまでのポイントをまとめておきます。

* データの取得はReaderで行う。「Web URL via HTTP」により、Web上のファイルを取り込むことができる
* RUNによりプロセスの実行を行う
* コンテキストメニューによりデータのサマリを見ることができる。Statistical Functionsと合わせ、データの内容の確認に利用する
* データは一旦取得したら「Save as Dataset」で保管しておく

## 2.データ整形

データの中には欠損や異常値があったりするので、それを取り除いたり埋めたりする作業を行います。これをしているかしていないかでだいぶ精度が変わったりするので、非常に重要なプロセスです。

下記は、取り込んだデータをStatistical FunctionsのDescriptive Statisticsに繋ぎVisualizeしたものです。

![data_preview.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/2c50544d-42e8-3af6-3d91-328897e35cfb.png)

ここから以下のようなことが分かります。

* Col2(アメダス測定局コード)が空白の欠損データが存在する
* Col11(花粉飛散数)は、単位が個数/m3なのでマイナスはないはずだがマイナスのデータがあり、また最大値が異常に大きい(89773)
* Col14/Col15(気温・降水量)に異常値と思われる値が-999のデータがある

欠損・異常値のデータ件数はそれぞれ82件・4件と全体約30,000件からしてだいぶ少ないので、今回はすべて削除してしまうことにします。
花粉の飛散量については確認したところ一応正常なデータっぽいので一旦はこのまま・・・いったんですが、精度があまり出なかったので最終的には1,500を超えるものは1,500を上限として設定しました。

この1,500という値はデータ提供元であるはなこさんによると花粉の数1,000以上はもうすべからく危険領域であるようだったので、それより少し多めの数でカットすることにしました。
統計情報によると花粉飛散量の3rd Quartile(75%四分位点・小さい準から並べて75%のデータが入る地点)は45であり、ほとんどのデータが小さい範囲に入っていることが分かります。なので、カットの影響はそれほどないはずです。

この時点で回帰というよりは花粉飛散量を大中小ぐらいに分けた分類問題にした方がよさそうな気配がしますが、今回はAzure Machine Learningを使ってアプリケーションを作ってみるということが目的だったので、いったんそこは棚上げにして次に進みます。

欠損データと異常値について方針を決めたら、それを実装していきます。

* 欠損データの処理には、Data TransformationのClean Missing Dataを使います
* 値によるデータ削除にはPython Language ModelsのExecute Python Scriptを使います
* 値の上限・下限といった設定にはData TransformationのFilterを使います

実際は以下のような感じで実装しました。

![data_manipulation.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/aa5f0167-19ef-f2c6-cdef-39f313db65ba.png)

Clean Missing Dataに限らず、以後この列に対して～という設定のためにColumn Selectorを開くことがままあります。ここでの設定方法には少し注意が必要です。

![column_selector1.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/1ef8f996-3dd1-9eb5-06d8-7a478fe6dea3.png)

基本的には、「全ての列からxxを除く」か「yyの列のみ」という指定になります。つまり、Begin WithがAll columnsの場合はExclude、No columnsの場合はIncludeを使うのが原則です。All columnsでさらにIncludeしたりすることに意味はないので注意してください。

Filterは名前からして「xx列がyy以上のデータを削除する」という用途に使えるかと思いきや、そうではありません。Filterは値の上限や下限を設定したりするのに使います(Threshold Filter、Greater Than 1,500なら1,500以上は1,500に設定される)。Apply FilterとFilterを組み合わせることでFilterの適用が可能です。

逆に、「xx列がyy以上のデータを削除する」という用途に使えるものは今のところない・・・ようなので(Clean Missing Dataは欠損値に対してしか作用しない)、Python Scriptで対応することにします。

Python Scriptは受け取るDatasetが引数として渡され、返り値として後続のフローに渡すデータセットを返します。引数の型は[pandas](http://pandas.pydata.org/)というデータフレームを扱えるライブラリの形式で入ってきます。なお、書けるPythonは2015/3時点では2.7なのでPython3ユーザーは注意してください。

今回使用したScriptは以下のようなものです。異常値と思われる値のデータをはじいています。

```py
# The script MUST contain a function named azureml_main
# which is the entry point for this module.
#
# The entry point function can contain up to two input arguments:
#   Param&lt;dataframe1&gt;: a pandas.DataFrame
#   Param&lt;dataframe2&gt;: a pandas.DataFrame
def azureml_main(dataframe1 = None, dataframe2 = None):

    # Execution logic goes here
    # print(&#39;Input pandas.DataFrame #1:\r\n\r\n{0}&#39;.format(dataframe1))

    # If a zip file is connected to the third input port is connected,
    # it is unzipped under &quot;.\Script Bundle&quot;. This directory is added
    # to sys.path. Therefore, if your zip file contains a Python file
    # mymodule.py you can import it using:
    # import mymodule
    
    erased = dataframe1[dataframe1.Col11 &gt;= 0]
    erased = erased[erased.Col14 &gt; -50]
    erased = erased[erased.Col16 &gt;= 0]
        
    # Return value must be of a sequence of pandas.DataFrame
    return erased,

```

ここまで来たらRunを実行してみて、Visualizeでちゃんとデータが処理されているか確認します(欠損値や異常値が消えているかなど)。


## 3.データ項目定義

データの項目定義とは、具体的には以下のようなものです。

* 特徴量として使う項目か、予測値(ラベル値)として使う項目か
* データ型
* 項目名の付与

今回は以後のプロセスで扱いやすいよう項目に名前を付け、データ型をFloatにして花粉飛散量を予測値・それ以外を特徴量にしています。
この作業には、Data Transformation &gt; ManipulationのMetadata Editorを利用します。

そして、使う特徴量を絞り込みたい場合はData Transformation &gt; ManipulationのProject Columnsで使う列を絞り込みます。
モデルでは特徴量を突っ込めばいいというものでもなく、予測対象に良く効く少数精鋭で行った方が基本的にはいいです。そのため、すべての特徴量を使う場合でも、プロセスの中にこのProject Columnsを置いておき、後で使う特徴量の数を調整できるようにしておいた方がいいです。

## 4.モデル構築

お待ちかねの機械学習モデルの構築を行います。ここまでがだいぶ長かったことからもわかるとおり、機械学習のプロセスとはその大半がデータの整形・加工のプロセスでもあります。

Machine LearningのセクションはEvaluate・Initialize Model・Score・Trainの4つに分かれています。

![machines.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/673378a0-b5c1-05be-874d-b8f9159a5a4f.png)

Initialize Model &gt; Train &gt; Score &gt; Evaluateというのが基本的な流れです。モデルを初期化し、学習させ、評価用データで値を予測させてみて、その結果を評価する、という流れです。

モデル構築ではInitialize Modelを選択し、今回は値の予測を行うのでLinear Regressionを利用します(実はNeural Networkでもやったんですが、あまり精度が出なかったので結局Linear Regressionに戻した)。

ちなみに、提供されているNeural Networkはディープラーニングにも十分対応できるものになっています。特にWindowsではDeep learning系のライブラリをインストールするのが難しかったりするので、大規模なものでない場合やとにかくパターンを色々試してみたい場合はこちらを使うのは十分ありだと思います。

各モデルには初期化パラメータがあり、どんな値を設定するかについてはやはり知識を問われます。Propertiesの一番下からドキュメントを参照することもできるので、そちらも見ながらパラメーターを設定します。

## 5.学習・評価

ここでモデルとデータがそろったので、それを利用して学習・精度の評価を行います。

まず、Data Transformation &gt; Sample and Split &gt; Splitを使用し学習用と評価用に分割します(下図のイメージ)。

![train.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/6cffc6d1-d595-6ee6-6045-b88f37fcde08.png)

学習する前にデータの正規化をしないと、と思いますが多くの学習モデルはInitialize ModelのPropertyの一部として正規化の方法を指定するようになっているので、個別に正規化を行う必要はありません。今回のように値の予測を行う場合は、学習時正規化したなら予測値も正規化された値なので、本来は復元のための計算が必要になります・・・が、これもうまいことやってくれるようです。逆にData Transformation &gt; Normalize Dataなどから正規化を行いモデルでの正規化をなしにすると、おそらくこの復元が効かなくなると思います。

学習に使用するTrain Modelで設定するのは予測値(ラベル値)の項目一つだけで、他の項目は特徴量としてモデルに渡されます。
Train Modelからは学習済みのモデルが渡され、それがScore Modelに繋がっていきます。ここで、学習済みのモデルを使用し評価データから値を予測します。予測した値と実際の値の差異は、最後のEvaluate Modelで参照することができます。
もちろん、ここはCross Varidationで一気に済ませるという手もあります。

フローを構築後に、今まで同様RUNでプロセスを実行することで実際に学習や評価が行われます。

気になる結果ですが・・・

![result.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/7cb77f07-ec6a-f0eb-e825-86f530ef75a2.png)

わかりやすいRoot Mean Squared Errorが146というのはあまりよくないニュースです。異常値をはじいた後の花粉飛散量の標準偏差は137.4186であり、Root Mean Squared Errorがこれよりも大きくなってしまっています。

これは予測した値が元々のデータ以上にばらついている、つまり全然あてにならないということを意味しているのでこのモデルによる予測値はほぼ信用ならないことを意味します。

Score ModelでVisualizeをしてみると、よりその傾向が顕著にわかります。下図は、予測した値であるScored Labelsと実際の値である花粉飛散量(pollen)をプロットしたものです。精度が高ければこの2つは完全な相関関係にあるはずなので、左から上に向かってきれいな線が出ていればうまく予測できていることになります・・・が、実際は。

![result2.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/5b45d338-0782-34ba-60c2-77e372b824fe.png)

この予測は当初簡単かなと思ったんですが(気温が高ければ増えて雨が降れば減る・・・みたいな)、実際そうではありませんでした。
この後もチューニングを試みたんですが思うように精度が上がらなかったので、いったんここは棚に上げそこそこのモデルができたとし、この予測モデルをWebサービスとして使う準備に取り掛かります。

## 6. Webサービス化

Webサービス化ですが、以下の2種類があります。

* 学習用API：学習データを受け取り、モデルをトレーニングする
* 予測用API：予測用のデータを受け取り、予測値を返す

学習は今作っていた流れそのものなので、下のボタンの「Publish Web Service」を押すことでAPI化することができます。元のデータ以外にWeb APIからの受け取り口と、レスポンスのための出口を用意します。何れもボタンを押すと自動的に追加されます。

実は通常時とWeb APIアクセス時でフローを切り替えることができ、左下の方にあるボタンでどちらの時のフローを構築するのか切り替えることができます。

↓普段は(今までは)左の状態になっていたと思いますが、これを切り替えると右のWeb APIアクセス時にスイッチします
![switch_space.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/e0805e23-b1aa-c42d-b010-98a292a1ed23.png)

予測用APIを作成するには、以下のボタンを押します。

![create_scoring_model.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/013dc52e-ee12-3957-af99-223711a6923a.png)

これを押すと、学習済みのモデルが組み込まれた予測用のフローがうねうね動いて作成されます。基本的には学習時のフローがコピーされますが、予測時には不要なものもあるのでそうしたプロセスを削除しながら予測時のフローを作成します。

今回は、以下のようなフローを作成しました。項目定義の部分は学習時のフローを踏襲していて、通常時は手で入力したデータを流してテスト(Data Input and Output &gt; Enter Dataを利用)、Web APIアクセス時はPOSTされたデータを受け取り予測値を返します。

![web_api_model.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/624d0c57-fcf1-bbbd-ccbd-3c68811116e9.png)

このフローを構築してRUNで動作を確認後、学習用APIと同様「Publish Web Service」でWeb Serviceを公開します。

Web APIのページからはアクセスURLやAPI Keyの確認ができます。

![web_api.PNG](https://qiita-image-store.s3.amazonaws.com/0/25990/317f70c2-aa3c-bd10-5e35-52a9cf714ba9.png)

ここでAPIのテストができるほか、C#/Python/Rのサンプルコードまで載せてくれています。これを利用することで、学習/予測をWeb API経由で行えるようになります。

## 実装

今回は最初に決めたとおり天気予報をAPIから取得し、それを入力値として花粉飛散量を予測、これらの結果を合わせて表示させてみました。

[pollen_prediction_by_azure/application.py](https://github.com/icoxfog417/pollen_prediction_by_azure/blob/master/application.py)

HTTPリクエストの形式は結構面倒なフォーマットですが、いずれにせよこれでWeb API経由で予測モデルを利用することができるようになりました。

Azure Machine Learningを利用することで手軽にモデルを構築できるほか、Web API経由で様々なプラットフォームから学習・予測をさせることができるようになります。

インストールの手間などもなくすぐに使うことができるので、勉強用・初めての機械学習アプリケーション開発用には良いプラットフォームではないかと思います。
</textarea><input type="submit" name="commit" value="Save changes" data-disable-with="Save changes" /></form></div></section></div><div class="col-sm-3"><div class="socialButtons"><div class="socialButtons_twitter"><a class="twitter-share-button" data-text="Azure Machine Learning を利用したアプリケーション開発 by @icoxfog417 on @Qiita" data-url="http://qiita.com/icoxfog417/items/f32f89a0d5145d9861bc" href="https://twitter.com/share">Tweet</a></div><div class="socialButtons_hatebu"><a class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" data-hatena-bookmark-title="Azure Machine Learning を利用したアプリケーション開発" href="http://b.hatena.ne.jp/entry/http://qiita.com/icoxfog417/items/f32f89a0d5145d9861bc" title="Add to Hatena Bookmark"><img alt="Add to Hatena Bookmark" height="20" src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" style="border: none;" width="20" /></a><script async="async" charset="utf-8" src="https://b.st-hatena.com/js/bookmark_button.js" type="text/javascript"></script></div><div class="socialButtons_googlePlus"><div class="g-plusone" data-href="http://qiita.com/icoxfog417/items/f32f89a0d5145d9861bc" data-size="medium"></div></div><div class="socialButtons_facebook"><div class="fb-like" data-action="like" data-href="http://qiita.com/icoxfog417/items/f32f89a0d5145d9861bc" data-layout="button_count" data-share="false" data-show-faces="false"></div></div><div class="socialButtons_pocket"><a class="pocket-btn" data-lang="en" data-pocket-count="horizontal" data-pocket-label="pocket"></a></div></div><section class="itemsShowAuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><a href="/icoxfog417"><img alt="" class="itemsShowAuthorInfo_userIcon" itemprop="image" src="https://qiita-image-store.s3.amazonaws.com/0/25990/profile-images/1484303516" /></a><div class="itemsShowAuthorInfo_profileStats"><strong class="itemsShowAuthorInfo_userName" itemprop="name"><a itemprop="url" href="/icoxfog417">icoxfog417</a></strong><div class="itemsShowAuthorInfo_contribution"><span class="itemsShowAuthorInfo_count">20387</span><span class="itemsShowAuthorInfo_unit">Contribution</span></div><div id="js-react-on-rails-context" data-rails-context="{}"></div>
<div class="js-react-on-rails-component" data-component-name="UserFollowButton" data-props="{&quot;initial_followed_by&quot;:false,&quot;position&quot;:&quot;author-info&quot;,&quot;size&quot;:&quot;btn-xs&quot;,&quot;url_name&quot;:&quot;icoxfog417&quot;}" data-trace="false" data-dom-id="UserFollowButton-react-component-cde899c3-5b81-4b37-82f4-8927472cabb7"></div>
    <div id="UserFollowButton-react-component-cde899c3-5b81-4b37-82f4-8927472cabb7"></div>
    
</div><section class="itemsShowAuthorPopularItems"><h5 class="itemsShowAuthorPopularItems_sectionTitle">人気の投稿</h5><ul class="itemsShowAuthorPopularItems_posts list-unstyled"><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/icoxfog417/items/e8f97a6acad07903b5b0">Pythonを書き始める前に見るべきTips</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/icoxfog417/items/adbbf445d357c924b8fc">画像処理の数式を見て石になった時のための、金の針</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/icoxfog417/items/242439ecd1a477ece312">ゼロからDeepまで学ぶ強化学習</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/icoxfog417/items/65e800c3a2094457c3a0">はじめるDeep learning</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/icoxfog417/items/5d79b3336226aa51e30d">React.js 実戦投入への道</a></li></ul></section><section class="itemsShowAuthorInfo_organization"><h5 class="itemsShowAuthorInfo_organizationTitle">ORGANIZATION</h5><span itemprop="memberOf" itemscope="" itemtype="http://schema.org/Organization"><a itemprop="url" href="/organizations/tis"><img alt="TIS株式会社" class="itemsShowAuthorInfo_organizationLogo" itemprop="image" src="https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/5710e4c30854dd4ab3658e7f585930ab0d81a12c/original.jpg?1484790468" /></a></span></section></section><div class="scroll-chaser"><div class="google-adsense"><style>.test-text-responsible { width: 200px; height: 200px; }@media(min-width: 1200px) {  .test-text-responsible { width: 250px; height: 250px; }}@media(max-width: 979px) and (min-width: 768px) {  .test-text-responsible { width: 120px; height: 240px; }}@media(max-width: 767px) {  .test-text-responsible { width: 320px; height: 50px; }}</style><script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle test-text-responsible" data-ad-client="ca-pub-8127218772604357" data-ad-slot="3880091879" style="display:inline-block"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div><div class="js-react-on-rails-component" data-component-name="Toc" data-props="{&quot;body&quot;:&quot;\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#0%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%BA%96%E5%82%99%E3%81%A8%E3%83%A2%E3%83%87%E3%83%AB%E8%A8%AD%E8%A8%88\&quot;\u003e0.データの準備とモデル設計\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#1%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E5%8F%96%E5%BE%97\&quot;\u003e1.データの取得\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#2%E3%83%87%E3%83%BC%E3%82%BF%E6%95%B4%E5%BD%A2\&quot;\u003e2.データ整形\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#3%E3%83%87%E3%83%BC%E3%82%BF%E9%A0%85%E7%9B%AE%E5%AE%9A%E7%BE%A9\&quot;\u003e3.データ項目定義\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#4%E3%83%A2%E3%83%87%E3%83%AB%E6%A7%8B%E7%AF%89\&quot;\u003e4.モデル構築\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#5%E5%AD%A6%E7%BF%92%E8%A9%95%E4%BE%A1\&quot;\u003e5.学習・評価\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#6-web%E3%82%B5%E3%83%BC%E3%83%93%E3%82%B9%E5%8C%96\&quot;\u003e6. Webサービス化\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%AE%9F%E8%A3%85\&quot;\u003e実装\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n&quot;,&quot;wrapper&quot;:&quot;#article-body-wrapper&quot;}" data-trace="false" data-dom-id="Toc-react-component-cb002e69-3c40-45ba-a636-45d4afe2e81d"></div>
    <div id="Toc-react-component-cb002e69-3c40-45ba-a636-45d4afe2e81d"></div>
    
</div></div><div class="row"><div class="col-sm-9"><div class="ArticleFooter__menu"><div class="s-flex-align-center"><div class="js-likebutton" data-props="{&quot;like_status&quot;:false,&quot;like_count&quot;:125,&quot;show_count&quot;:true,&quot;uuid&quot;:&quot;f32f89a0d5145d9861bc&quot;,&quot;likable_type&quot;:&quot;Article&quot;,&quot;position&quot;:&quot;article-footer&quot;}"></div><div class="ArticleFooter__userList"><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="st450"><a itemprop="url" href="/st450"><img alt="st450" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/63970/profile-images/1473696432" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="canard0328"><a itemprop="url" href="/canard0328"><img alt="canard0328" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/52533/profile-images/1473692763" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="mettoboshi"><a itemprop="url" href="/mettoboshi"><img alt="mettoboshi" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/42925/profile-images/1473689342" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="0xfffffff7"><a itemprop="url" href="/0xfffffff7"><img alt="0xfffffff7" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/33116/profile-images/1473686053" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="masuhajime"><a itemprop="url" href="/masuhajime"><img alt="masuhajime" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/59518/profile-images/1489504014" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="alg"><a itemprop="url" href="/alg"><img alt="alg" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/12408/profile-images/1473682400" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="chezou"><a itemprop="url" href="/chezou"><img alt="chezou" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/11143/profile-images/1473681932" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="shuhei"><a itemprop="url" href="/shuhei"><img alt="shuhei" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/3732/profile-images/1473683476" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="Ushiki"><a itemprop="url" href="/Ushiki"><img alt="Ushiki" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/48690/profile-images/1473691443" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="susieyy"><a itemprop="url" href="/susieyy"><img alt="susieyy" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/4943/profile-images/1473681085" /></a></div></div><div class="ArticleFooter__user"><a href="/icoxfog417/items/f32f89a0d5145d9861bc/likers"><span class="fa fa-ellipsis-h"></span></a></div></div></div><div class="u-flex u-align-center"><div class="ArticleFooter__stock"><div class="js-stockbutton" data-position="footer_menu" data-props="{&quot;stock_status&quot;:false}"></div></div><div class="ArticleFooter__editRequest"><a class="u-link-no-underline" data-toggle="tooltip" title="You can propose improvements about the article to the author 💪" href="/drafts/f32f89a0d5145d9861bc/edit"><span class="fa fa-send-o fa-lg"></span> <span>Edit request</span></a></div><div class="dropdown ArticleFooter__dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="fa fa-ellipsis-h"></span></a><ul class="dropdown-menu dropdown-menu-right"><li><a href="/icoxfog417/items/f32f89a0d5145d9861bc.md"><span class="fa fa-fw fa-file-text-o"></span> Show article as Markdown</a></li><li><a data-target=".js-report-form" data-toggle="modal" href="#"><i class="fa fa-fw fa-flag"></i> Report article</a></li></ul></div></div></div><ul class="references js-referencesView"><li class="references_header"><i class="fa fa-fw fa-link"></i> Linked from these articles</li><li class="references_reference js-reference"><span>Linked from </span><a href="/cb400sp2/items/92d4f2699248fc479138#_reference-70539467ebb0bff40527"><img alt="" width="18" height="18" src="https://qiita-image-store.s3.amazonaws.com/0/7821/profile-images/1473680740" />Azure Machine Learning で競艇の予測をしてみた</a><time class="references_datetime js-dateTimeView" datetime="2015-10-27T13:31:01+00:00">over 1 year ago</time></li></ul><div class="itemsShowBody_articleColumnFooter"><div class="socialButtons"><div class="socialButtons_twitter"><a class="twitter-share-button" data-text="Azure Machine Learning を利用したアプリケーション開発 by @icoxfog417 on @Qiita" data-url="http://qiita.com/icoxfog417/items/f32f89a0d5145d9861bc" href="https://twitter.com/share">Tweet</a></div><div class="socialButtons_hatebu"><a class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" data-hatena-bookmark-title="Azure Machine Learning を利用したアプリケーション開発" href="http://b.hatena.ne.jp/entry/http://qiita.com/icoxfog417/items/f32f89a0d5145d9861bc" title="Add to Hatena Bookmark"><img alt="Add to Hatena Bookmark" height="20" src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" style="border: none;" width="20" /></a><script async="async" charset="utf-8" src="https://b.st-hatena.com/js/bookmark_button.js" type="text/javascript"></script></div><div class="socialButtons_googlePlus"><div class="g-plusone" data-href="http://qiita.com/icoxfog417/items/f32f89a0d5145d9861bc" data-size="medium"></div></div><div class="socialButtons_facebook"><div class="fb-like" data-action="like" data-href="http://qiita.com/icoxfog417/items/f32f89a0d5145d9861bc" data-layout="button_count" data-share="false" data-show-faces="false"></div></div><div class="socialButtons_pocket"><a class="pocket-btn" data-lang="en" data-pocket-count="horizontal" data-pocket-label="pocket"></a></div></div></div><div class="itemsShowComment_wrapper" id="comments"><div class="js-react-on-rails-component" data-component-name="CommentListContainer" data-props="{&quot;currentUser&quot;:null,&quot;initialComments&quot;:[],&quot;monthly_public_image_uploadable_size_limit&quot;:null,&quot;total_uploaded_public_image_size_in_current_month&quot;:null,&quot;item&quot;:{&quot;id&quot;:292613,&quot;uuid&quot;:&quot;f32f89a0d5145d9861bc&quot;,&quot;suspended&quot;:false,&quot;secret&quot;:false},&quot;owner&quot;:{&quot;url_name&quot;:&quot;icoxfog417&quot;},&quot;is_team&quot;:false,&quot;is_project&quot;:false,&quot;logged_in&quot;:false,&quot;polling&quot;:false,&quot;mention_candidates&quot;:[{&quot;id&quot;:25990,&quot;url_name&quot;:&quot;icoxfog417&quot;,&quot;profile_image_url&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/25990/profile-images/1484303516&quot;}]}" data-trace="false" data-dom-id="CommentListContainer-react-component-773d611c-132f-4fd7-9ea9-1de2763ad390"></div>
    <div id="CommentListContainer-react-component-773d611c-132f-4fd7-9ea9-1de2763ad390"></div>
    
</div></div></div></div></article><div class="js-report-form modal fade reportForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Report article</h4></div><div class="modal-body"><form action="/reports" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="L0OYR9JdHTIUK6JAld9mBZC8lJ6pNCbDXuTUnSR7f42cxOKYfKwCwGd558lSgA/R47w8bNMlMFLSPVJpN+N4kw==" /><input type="hidden" name="redirect_path" id="redirect_path" value="/icoxfog417/items/f32f89a0d5145d9861bc" /><input type="hidden" name="item_uuid" id="item_uuid" value="f32f89a0d5145d9861bc" /><p>Help us understand the problem. What is going on with this item?</p><br /><div class="form-group"><ul class="list-unstyled"><li><label><input type="radio" name="report_type" id="report_type_spam" value="spam" required="required" /> It&#39;s spam </label></li><li><label><input type="radio" name="report_type" id="report_type_harassment" value="harassment" required="required" /> It&#39;s abusive or harmful </label></li><li><label><input type="radio" name="report_type" id="report_type_inappropriate_content" value="inappropriate_content" required="required" /> It contains inappropriate content </label></li></ul></div><div class="reportForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary reportForm_submitButton"><i class="fa fa-send"></i> Submit</button></div></form></div></div></div></div><script id="js-item" type="application/json">{ "url": "http://qiita.com/icoxfog417/items/f32f89a0d5145d9861bc", "id": 292613, "uuid": "f32f89a0d5145d9861bc" }</script><script class="js-user" type="application/json">{&quot;id&quot;:25990,&quot;url_name&quot;:&quot;icoxfog417&quot;,&quot;profile_image_url&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/25990/profile-images/1484303516&quot;}</script><script language="JavaScript" src="//cdn.bigmining.com/private/js/qiita_bigmining.js" type="text/javascript"></script></div><footer class="footer"><div class="footer_inner"><div class="footer_container"><ul class="footer_links-left"><li class="footer_link"><a class="footer_copyright" href="http://increments.co.jp">© 2011-2017 Increments Inc.</a></li><li class="footer_link"><a href="http://qiita.com/terms">Terms</a></li><li class="footer_link"><a href="http://qiita.com/privacy">Privacy</a></li><li class="footer_link"><a href="http://help.qiita.com">Help</a></li><li class="footer_link"><a href="https://increments.zendesk.com/anonymous_requests/new">Contact</a></li></ul><ul class="footer_links-right"><li class="footer_link"><a href="http://qiita.com/about">About</a></li><li class="footer_link"><a href="/users">Users</a></li><li class="footer_link"><a href="/tags">Tags</a></li><li class="footer_link"><a href="http://blog.qiita.com">Blog</a></li><li class="footer_link"><a href="http://qiita.com/api/v2/docs">API</a></li><li class="footer_link"><a href="https://teams.qiita.com/">Team</a></li><li class="footer_link"><a href="http://kobito.qiita.com">Kobito</a></li><li class="footer_link"><a class="js-public-form-feedback-link" data-target=".js-feedback-form" data-toggle="modal" href=""><i class="fa fa-heart"></i> Feedback <i class="fa fa-caret-down"></i></a></li></ul></div></div></footer><div class="js-feedback-form modal fade feedbackForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Feedback</h4></div><div class="modal-body"><form class="js-feedback-form-form" action="/feedbacks" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="eSiTOM9ud1Yw7cFwHRSROUuF/uamcFboMMAR/Jh18ePKr+nnYZ9opEO/hPnaS/jtOIVWFNxhQHm8GZcIi+32/Q==" /><input type="hidden" name="redirect_path" id="redirect_path" value="/icoxfog417/items/f32f89a0d5145d9861bc" /><div class="form-group"><textarea name="feedback[message]" id="feedback_message" class="form-control js-feedback-form-text-area" placeholder="Please give us any feedback about Qiita." required="required" rows="5">
</textarea></div><div class="feedbackForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary feedbackForm_submitButton"><i class="fa fa-send"></i> Submit</button><p class="feedbackForm_note">We don&#39;t reply to any feedback.<br />If you need help with Qiita, please send a support request from <a href="https://increments.zendesk.com/anonymous_requests/new">here</a>.</p></div><div style="position:fixed;top:-99999px;opacity:0.0001;"><input name="feedback[name]" type="text" /></div></form></div></div></div></div><script>// if (window.mixpanel instanceof Element) {
//   window.mixpanel = [];
// }
// (function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
// for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2.2.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);</script><script src="http://cdn.qiita.com/assets/public-3af9c1d29a49f3320bb796fb5e75304b.min.js"></script><script>
  (function () {
    var script = document.getElementsByTagName('script')[0];
    var load = function (src, id) {
      var el = document.createElement('script');
      el.async = true;
      el.src = src;
      el.id = id;
      script.parentNode.insertBefore(el, script);
    };
      // Optimizely
      load('//cdn.optimizely.com/js/52738645.js', 'optimizely-jssdk');
      // Google Analytics
      window._gaq = window._gaq || [];
      var isCareer = location.hostname.split('.')[0] == 'career';
      if (isCareer) {
        window._gaq.push(['_setAccount', 'UA-24675221-11']);
        window._gaq.push(['_setDomainName', 'qiita.com']);
      } else {
        window._gaq.push(['_setAccount', 'UA-24675221-1']);
      }
      window._gaq.push(['_setCustomVar', 1, 'logged_in', 'false', 2]);
      window._gaq.push(['_trackPageview']);
      var src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      load(src, 'google-analytics-jssdk');
    // Google Analytics - Universal Analytics
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-24675221-12', {
          
        });
        ga('set', 'dimension1', 'false');
        ga('set', 'dimension3', 'false');
      ga('require', 'displayfeatures');
      ga('set', 'forceSSL', true);
      ga('send', 'pageview');
    // Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TBQWPN');
  })();
</script>
</body></html>