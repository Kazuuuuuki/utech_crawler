<!DOCTYPE html><html xmlns:og="http://ogp.me/ns#"><head><meta charset="UTF-8" /><title>ディープラーニングを使って転職会議の企業クチコミデータを感情分析してみる - Qiita</title><meta content="width=device-width,initial-scale=1" name="viewport" /><meta content="せっかく会社の名前を借りたAdvent Calendarの記事なので、会社に絡んだ題材を扱います。


（前置き）転職会議 について

Livesenseでは、転職会議という転職者による企業の評判クチコミを扱ったサイトを運営しており、日々企業についてのクチコミが投稿されている。

これまで転職会議では、クチコミのテキストデータと5段階からなる評点データを別々のデータとして取得していたが、先日のリニューアルで、評点とテキストデータを同時に投稿できるようになり、さらに読みや..." name="description" /><meta content="summary" name="twitter:card" /><meta content="@Qiita" name="twitter:site" /><meta content="inuscript" name="twitter:creator" /><meta content="ディープラーニングを使って転職会議の企業クチコミデータを感情分析してみる - Qiita" property="og:title" /><meta content="article" property="og:type" /><meta content="http://qiita.com/inuscript/items/54daa5aedde599e2637c" property="og:url" /><meta content="http://cdn.qiita.com/assets/qiita-fb-2887e7b4aad86fd8c25cea84846f2236.png" property="og:image" /><meta content="
せっかく会社の名前を借りたAdvent Calendarの記事なので、会社に絡んだ題材を扱います。

#（前置き）[転職会議](http://jobtalk.jp/) について
Livesenseでは、転職会議という転職者による企業..." property="og:description" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><link rel="shortcut icon" type="image/x-icon" href="http://cdn.qiita.com/assets/favicons/public/production-4ff10c1e1e2b5fcb353ff9cafdd56c70.ico" /><link rel="apple-touch-icon" type="image/png" href="http://cdn.qiita.com/assets/favicons/public/apple-touch-icon-f9a6afad761ec2306e10db2736187c8b.png" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link rel="stylesheet" media="all" href="http://cdn.qiita.com/assets/public-81dd63f4385f99b52aeab91266068ebd.min.css" /><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="jPZNbraloHJi3UeLg/gk55aqEMQ8B0bMbJ/WuQSl6qub0IZ5Ny5zIJ5o1WqQUH6s6wkzrm5iGoFB0/NPNNtqCw==" /></head><body class="without-js" id=""><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-TBQWPN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>
  document.body.className = document.body.className.replace('without-js', '') + ' with-js';
  window.Qiita = {"asset_host":"cdn.qiita.com","TLD":"com","controller_path":"public/items","controller_action":"public/items#show","controller":"items","action":"show","action_path":"public/items#show","env":"production","flash":{},"is_landing_page":false,"is_team_page":false,"request_parameters":{"controller":"public/items","action":"show","user_id":"inuscript","type":"items","id":"54daa5aedde599e2637c"},"root_domain":"qiita.com","variant":null,"config":{"mixpanel":{"career":"dd35af27e959781713d63fd7ca898a8d","per_team":"c0a2116368b33b44b5029ebd2cc9b094","public":"be87616606b0e26a87689099aab2c4e5","team":"b7c0342acba2dbc8742484d98788efb3"},"default_locale":"ja","locale":"en"},"team":null,"user":null,"GIT_BRANCH":null,"DEBUG":false};

</script>
<div class="headerContainer headerContainer-public" role="navigation"><div class="js-react-on-rails-component" data-component-name="HeaderContainer" data-props="{&quot;user&quot;:null,&quot;team&quot;:null,&quot;news&quot;:{&quot;type&quot;:&quot;募集&quot;,&quot;content&quot;:&quot;QiitaやQiita:Teamを良くしたいエンジニア&quot;,&quot;url&quot;:&quot;http://increments.co.jp/jobs/engineers?utm_source=qiita\u0026utm_medium=header_news&quot;},&quot;initial_unread_count&quot;:null,&quot;siteid_image&quot;:&quot;http://cdn.qiita.com/siteid-reverse.png&quot;,&quot;is_team_page&quot;:false,&quot;on_team_setting&quot;:false,&quot;show_post_menu&quot;:true,&quot;show_search_menu&quot;:true,&quot;is_fluid&quot;:false,&quot;locale&quot;:&quot;en&quot;}" data-trace="false" data-dom-id="HeaderContainer-react-component-4a8b79c4-4391-4695-b0d4-edf81ecce418"></div>
    <div id="HeaderContainer-react-component-4a8b79c4-4391-4695-b0d4-edf81ecce418"></div>
    
</div><div id="main"><script type="application/ld+json">{  "@context": "http://schema.org",  "@type": "BreadcrumbList",  "itemListElement": [    {      "@type": "ListItem",      "position": 1,      "item": {        "@id": "/",        "name": "Qiita"      }    },    {      "@type": "ListItem",      "position": 2,      "item": {        "@id": "/items",        "name": "Items"      }    },    {      "@type": "ListItem",      "position": 3,      "item": {        "@id": "/tags/%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92",        "name": "機械学習"      }    }  ]}</script><article itemscope="" itemtype="http://schema.org/Article"><div class="ArticleMainHeader ArticleMainHeader--adcalItem"><div class="container"></div><div class="container"><div class="row s-flex-align-center"><div class="col-sm-9"><div class="adventCalendarRibbon"><span><a class="adventCalendarRibbon_title" href="/advent-calendar/2015/livesense_1">Livesense Advent Calendar 2015</a> Day 8</span></div><h1 class="ArticleMainHeader__title" itemprop="headline">ディープラーニングを使って転職会議の企業クチコミデータを感情分析してみる</h1><ul class="TagList"><li class="TagList__item" data-count="1835"><a class="u-link-unstyled TagList__label" href="/tags/%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92"><img alt="機械学習" class="TagList__icon" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/a94d4d239b3b0b83723d5b56c050ffc54b8593e7/medium.jpg?1394635775" /><span>機械学習</span></a></li><li class="TagList__item" data-count="1075"><a class="u-link-unstyled TagList__label" href="/tags/DeepLearning"><img alt="DeepLearning" class="TagList__icon" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/eac844d1d880a38fc3be5ebf534cad5182b64ebf/medium.jpg?1453002020" /><span>DeepLearning</span></a></li><li class="TagList__item" data-count="9910"><a class="u-link-unstyled TagList__label" href="/tags/Python"><img alt="Python" class="TagList__icon" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/28fd3d6b220c89e6197fd82c02fd2fcd2bb66d81/medium.jpg?1383884245" /><span>Python</span></a></li><li class="TagList__item" data-count="38"><a class="u-link-unstyled TagList__label" href="/tags/Theano"><img alt="Theano" class="TagList__icon" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/d6b3b30cd76a6c49ba613f686e19e778c6714c64/medium.jpg?1481535923" /><span>Theano</span></a></li><li class="TagList__item" data-count="814"><a class="u-link-unstyled TagList__label" href="/tags/MachineLearning"><img alt="MachineLearning" class="TagList__icon" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/b85c97772bddbfbb48a8b116669349c7ec92e4bf/medium.jpg?1395227038" /><span>MachineLearning</span></a></li></ul></div><div class="col-sm-3"><div class="itemsShowHeaderStock"><ul class="list-unstyled itemsShowHeaderStock_statusList"><li><div class="itemsShowHeaderStock_count stock"><span class="fa fa-thumbs-up"></span><span class="js-likecount">346</span></div><div class="itemsShowHeaderStock_countText">Like</div></li><li><div class="itemsShowHeaderStock_count" content="2 UserComments" itemprop="commentCount"><span class="fa fa-comment"></span>2</div><div class="itemsShowHeaderStock_countText">Comment</div></li></ul></div><div class="js-likebutton" data-props="{&quot;like_status&quot;:false,&quot;like_count&quot;:346,&quot;uuid&quot;:&quot;54daa5aedde599e2637c&quot;,&quot;likable_type&quot;:&quot;Article&quot;,&quot;position&quot;:&quot;article-header&quot;}"></div><ul class="list-inline ArticleMainHeader__users"><li class="js-hovercard" data-hovercard-target-name="quattro_4"><a itemprop="url" href="/quattro_4"><img alt="quattro_4" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/5764/profile-images/1473682244" /></a></li><li class="js-hovercard" data-hovercard-target-name="highwide"><a itemprop="url" href="/highwide"><img alt="highwide" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/51449/profile-images/1483519687" /></a></li><li class="js-hovercard" data-hovercard-target-name="ieee0824"><a itemprop="url" href="/ieee0824"><img alt="ieee0824" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/58368/profile-images/1473694613" /></a></li><li class="js-hovercard" data-hovercard-target-name="knoguchi"><a itemprop="url" href="/knoguchi"><img alt="knoguchi" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/13775/profile-images/1473683016" /></a></li><li class="js-hovercard" data-hovercard-target-name="Kawada"><a itemprop="url" href="/Kawada"><img alt="Kawada" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/43073/profile-images/1473689397" /></a></li><li class="js-hovercard" data-hovercard-target-name="yakk512"><a itemprop="url" href="/yakk512"><img alt="yakk512" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/24006/profile-images/1473683971" /></a></li><li class="js-hovercard" data-hovercard-target-name="st450"><a itemprop="url" href="/st450"><img alt="st450" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/63970/profile-images/1473696432" /></a></li><li class="js-hovercard" data-hovercard-target-name="yahihi"><a itemprop="url" href="/yahihi"><img alt="yahihi" class="thumb thumb--xs" src="https://secure.gravatar.com/avatar/c0b97f4521e0cdb6b8f835077a8f7e0f?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" /></a></li><li class="js-hovercard" data-hovercard-target-name="haminiku"><a itemprop="url" href="/haminiku"><img alt="haminiku" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/65312/profile-images/1473696847" /></a></li><li class="js-hovercard" data-hovercard-target-name="shuhei"><a itemprop="url" href="/shuhei"><img alt="shuhei" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/3732/profile-images/1473683476" /></a></li><li><a href="/inuscript/items/54daa5aedde599e2637c/likers"><span class="fa fa-ellipsis-h"></span></a></li></ul></div></div></div></div><div class="ArticleAsideHeader"><div class="container"><div class="u-flex u-space-between"><div class="u-flex u-flex-wrap"><div class="u-flex u-align-center s-pdv-5 u-flex-wrap"><div class="ArticleAsideHeader__author"><a href="/inuscript"><img class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/7307/profile-images/1473684148" alt="1473684148" /></a> <a class="u-link-unstyled" href="/inuscript">inuscript</a> </div><div class="ArticleAsideHeader__date"><meta content="2015-12-08T00:00:31+09:00" itemprop="datePublished" /><span data-toggle="tooltip" title="posted at 2015-12-08">Edited at <time datetime="2015-12-08T00:47:46+09:00" itemprop="dateModified">2015-12-08</time></span></div></div><div class="u-flex u-align-center s-pdv-5 mobile-hidden"><div class="ArticleAsideHeader__revision"> <a data-toggle="tooltip" title="Revisions" href="/inuscript/items/54daa5aedde599e2637c/revisions"><span class="fa fa-history"></span></a><span class="ArticleAsideHeader__revisionCount">19</span></div></div><div class="u-flex u-align-center s-pdv-5 mobile-hidden"></div></div><div class="u-flex u-align-center s-flex-justiry-between s-pdv-5 u-shrink-0"><div class="ArticleAsideHeader__stock"><div class="js-stockbutton" data-position="top" data-props="{&quot;stock_status&quot;:false}"></div></div><div class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="fa fa-ellipsis-h fa-lg"></span></a><ul class="dropdown-menu dropdown-menu-right"><li class="dropdown__item--mobile"><a href="/inuscript/items/54daa5aedde599e2637c/revisions"><span class="fa fa-fw fa-history"></span> Revisions<span>(19)</span></a></li><li><a href="/inuscript/items/54daa5aedde599e2637c.md"><span class="fa fa-fw fa-file-text-o"></span> Show article as Markdown</a></li><li><a data-target=".js-report-form" data-toggle="modal" href="#"><span class="fa fa-fw fa-flag"></span> Report article</a></li></ul></div></div></div></div></div><div class="container"><div class="row" id="article-body-wrapper"><div class="col-sm-9"><section class="markdownContent markdownContent-headingEnabled js-task-list-container clearfix position-relative" id="item-54daa5aedde599e2637c" itemprop="articleBody"><div class="alert alert-warning"><i class="fa fa-clock-o"></i> More than 1 year has passed since last update.</div><p>せっかく会社の名前を借りたAdvent Calendarの記事なので、会社に絡んだ題材を扱います。</p>

<h1>
<span id="前置き転職会議-について" class="fragment"></span><a href="#%E5%89%8D%E7%BD%AE%E3%81%8D%E8%BB%A2%E8%81%B7%E4%BC%9A%E8%AD%B0-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6"><i class="fa fa-link"></i></a>（前置き）<a href="http://jobtalk.jp/" rel="nofollow noopener" target="_blank">転職会議</a> について</h1>

<p>Livesenseでは、転職会議という転職者による企業の評判クチコミを扱ったサイトを運営しており、日々企業についてのクチコミが投稿されている。</p>

<p>これまで転職会議では、クチコミのテキストデータと5段階からなる評点データを別々のデータとして取得していたが、先日のリニューアルで、評点とテキストデータを同時に投稿できるようになり、さらに読みやすいクチコミを提供できるようになった。</p>

<table>
<thead>
<tr>
<th>リニューアル以前に投稿されたクチコミ</th>
<th>リニューアル後に投稿されたクチコミ</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="http://jobtalk.jp/company/answer_1388452.html" rel="nofollow noopener" target="_blank"><img src="https://qiita-image-store.s3.amazonaws.com/0/7307/680fd65f-5b4f-6919-0ab7-b53163d3d0eb.png" width="400"></a></td>
<td><a href="http://jobtalk.jp/company/answer_2000003.html" rel="nofollow noopener" target="_blank"><img src="https://qiita-image-store.s3.amazonaws.com/0/7307/85f25beb-8cc9-6b03-2afc-a0a1995b84d8.png" width="400"></a></td>
</tr>
</tbody>
</table>

<h3>
<span id="ここで感じる課題感" class="fragment"></span><a href="#%E3%81%93%E3%81%93%E3%81%A7%E6%84%9F%E3%81%98%E3%82%8B%E8%AA%B2%E9%A1%8C%E6%84%9F"><i class="fa fa-link"></i></a>ここで感じる課題感</h3>

<p>新しく投稿されるクチコミは評点によって読みやすくなったものの、過去に蓄積された大量の投稿には当然5段階の評点データは無いし、そのままでは顔アイコンを出すことは当然出来ない。</p>

<p>しかしこの課題を解決して、<strong>過去のクチコミも同じように読みやすくなったらもっと良いサイトになるはず！</strong></p>

<p>という所を解決することは出来ないかやってみることにした。</p>

<h1>
<span id="取っ掛かり探し手法を調べる" class="fragment"></span><a href="#%E5%8F%96%E3%81%A3%E6%8E%9B%E3%81%8B%E3%82%8A%E6%8E%A2%E3%81%97%E6%89%8B%E6%B3%95%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>取っ掛かり探し。手法を調べる</h1>

<p>調べてみると、この問題は感情分析（他には評判分析、 Sentiment Analysis または Sentiment Classificationとか)と呼ばれている問題だそう。</p>

<p>さらにその手法は大別するとこんなあたりが確認できた。</p>

<ul>
<li>感情辞書を使った判定手法

<ul>
<li><a href="http://qiita.com/kenmatsu4/items/52ab6deffdd61e7d8c0f" id="reference-39985d57d13bee7acde8">Twitter Stream APIデータに対して初歩的な感情分析を試みる</a></li>
<li><a href="http://tt-house.com/2013/08/twitter-nega-posi.html" rel="nofollow noopener" target="_blank">PythonでTwitterでのツイートをネガポジ判定してみた結果</a></li>
</ul>
</li>
<li>機械学習を使った手法

<ul>
<li><a href="http://qiita.com/hogefugabar/items/93fcb2bc27d7b268cbe6" id="reference-83ef8a6a6b47e2083890">深層学習でツイートの感情分析</a></li>
</ul>
</li>
</ul>

<h2>
<span id="手法1-感情辞書を使った手法" class="fragment"></span><a href="#%E6%89%8B%E6%B3%951-%E6%84%9F%E6%83%85%E8%BE%9E%E6%9B%B8%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%89%8B%E6%B3%95"><i class="fa fa-link"></i></a>手法1: 感情辞書を使った手法</h2>

<p>感情辞書を使う手法は、例えば「<code>残業</code>」がネガティブだとして「<code>残業はない</code>」であれば打ち消されてポジティブと判定する、というような単純なロジックだ。<br>
しかし、すぐに困難に当たった。</p>

<blockquote>
<p>残業はそんなにありませんでした</p>
</blockquote>

<p>例えば上記のような場合、チョチョイと係り受けをするだけでは解決せず、色々なパターンを考えなければならなそうだった。<br>
さらに転職のクチコミという性質のせいか、このような言い回しはよく使われているようだった。。。</p>

<p>という所まで来てこの手法は早々に断念</p>

<h2>
<span id="手法2-機械学習による手法" class="fragment"></span><a href="#%E6%89%8B%E6%B3%952-%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92%E3%81%AB%E3%82%88%E3%82%8B%E6%89%8B%E6%B3%95"><i class="fa fa-link"></i></a>手法2: 機械学習による手法</h2>

<p>機械学習やらディープラーニングやらの未知の領域。<br>
個人的には全く無知だし難易度高そうだなあ、、、と思いつつ、個人的にもそろそろ気になっていたのでこの手法を模索してみることにした。</p>

<h3>
<span id="機械学習による感情分析について調べる" class="fragment"></span><a href="#%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92%E3%81%AB%E3%82%88%E3%82%8B%E6%84%9F%E6%83%85%E5%88%86%E6%9E%90%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%AA%BF%E3%81%B9%E3%82%8B"><i class="fa fa-link"></i></a>機械学習による感情分析について調べる</h3>

<p>ゆるふわな知識しか無いところから、「Sentiment Analysis」というワードを頼りに更に調査を進めると、だいたい下記のような事が見えてきた。</p>

<ul>
<li>
<p>再帰型ニューラルネットワーク（RNN）というのが文章などを扱うにはよさそうらしい。</p>

<ul>
<li>中でもLSTMというのが精度が良くなりやすいとか。</li>
<li><a href="http://qiita.com/icoxfog417/items/2791ee878deee0d0fd9c" id="reference-0da109d626203f9e984c">ニューラルネットワークで時系列データの予測を行う</a></li>
<li>
<a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/" rel="nofollow noopener" target="_blank">The Unreasonable Effectiveness of Recurrent Neural Networks</a>

<ul>
<li>上記の<a href="http://qiita.com/GushiSnow/items/c0ff3f213cade8b760b8" id="reference-2dfba8032d507c42fb47">日本語翻訳された記事</a>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Sentiment Analysisをしているサンプルもそれなりに見つけられた。</p>

<ul>
<li>
<a href="https://github.com/dennybritz/sentiment-analysis" rel="nofollow noopener" target="_blank">Tensorflowを使ったサンプル</a>(github)

<ul>
<li>日本語を文字単位に区切って入力としている。</li>
<li>良さそうだったが、ちょっと自由に操るのは難しそうだった。</li>
</ul>
</li>
<li>
<a href="https://github.com/pfnet/chainer/tree/master/examples/sentiment" rel="nofollow noopener" target="_blank">Chainerのサンプル</a>(github)

<ul>
<li>英文を係り受け？にしているっぽい。</li>
<li>使うには下処理が色々必要そう</li>
<li><a href="http://qiita.com/K-1/items/282f2d8c4d5e33bc95ab" id="reference-d8ccfe9a4e57efbbc1be">参考記事</a></li>
</ul>
</li>
<li>
<a href="https://github.com/yusuketomoto/chainer-char-rnn" rel="nofollow noopener" target="_blank">Chaninerで文字単位のRNNを行っているサンプル</a>(github)

<ul>
<li>これはSentiment Analysisではなく次に来る文章を生成するものっぽい。これも楽しそう</li>
</ul>
</li>
<li>
<a href="http://deeplearning.net/tutorial/lstm.html" rel="nofollow noopener" target="_blank">Theanoを使ったサンプル</a>

<ul>
<li>英文の映画レビューを判定しているっぽい。</li>
<li>どこで何やっているのかなんとなくわかる。</li>
<li><strong>データを作れればなんか動かせそう</strong></li>
<li>希望が見えてきた。</li>
</ul>
</li>
</ul>
</li>
</ul>

<h1>
<span id="ここから本題lstmで感情分析を行う" class="fragment"></span><a href="#%E3%81%93%E3%81%93%E3%81%8B%E3%82%89%E6%9C%AC%E9%A1%8Clstm%E3%81%A7%E6%84%9F%E6%83%85%E5%88%86%E6%9E%90%E3%82%92%E8%A1%8C%E3%81%86"><i class="fa fa-link"></i></a>(ここから本題）LSTMで感情分析を行う</h1>

<p>今回は <a href="http://deeplearning.net/tutorial/lstm.html" rel="nofollow noopener" target="_blank">Theanoを使ったサンプル</a> を流用して検証を進める事にする。</p>

<p>（利用にあたって<a href="http://qiita.com/inuscript/items/84f972af73c2af27849a" id="reference-986852c3e8213cd02d8d">コードリーディングした書き置き</a>を別記事にしたので、興味がある方はそちらを参照）</p>

<h2>
<span id="学習データの特徴とか問題設定とか" class="fragment"></span><a href="#%E5%AD%A6%E7%BF%92%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%89%B9%E5%BE%B4%E3%81%A8%E3%81%8B%E5%95%8F%E9%A1%8C%E8%A8%AD%E5%AE%9A%E3%81%A8%E3%81%8B"><i class="fa fa-link"></i></a>学習データの特徴とか問題設定とか</h2>

<h3>
<span id="学習データの特徴" class="fragment"></span><a href="#%E5%AD%A6%E7%BF%92%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%89%B9%E5%BE%B4"><i class="fa fa-link"></i></a>学習データの特徴</h3>

<p>今回学習データにする転職会議のクチコミデータは、1つのクチコミについて下記のような特徴がある。</p>

<ul>
<li>
<p>テキストデータ</p>

<ul>
<li>100文字以上</li>
<li>1つの企業のついてのレビュー（今回はあんまり関係しない）</li>
<li>1つの質問項目についてのレビュー（今回はあんまり関係しない）</li>
</ul>
</li>
<li>
<p>評点データ</p>

<ul>
<li>会社についての5段階評価</li>
<li>1が最も低く、5が最も高い評価</li>
<li>星をいくつつけるかで選んでもらうよくあるアレ</li>
</ul>
</li>
</ul>

<h3>
<span id="問題設定" class="fragment"></span><a href="#%E5%95%8F%E9%A1%8C%E8%A8%AD%E5%AE%9A"><i class="fa fa-link"></i></a>問題設定</h3>

<p>ここまでの結果を踏まえ、改めて下記のように問題設定をする。</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>
書き込まれたクチコミの文章が、ポジティブであるかネガティブであるかを判定できるモデルを作る
</pre></div></div>

<p>本来であればデータにあわせて5段階評価まで目指したいものの、まあやっぱり難易度が高そうなので、今回は見送り。</p>

<p>あと今回はざっくり感覚に基づいてやってみるので、評点が低く付くような文章が「<strong>ネガティブ</strong>」、高く付くような文章が「<strong>ポジティブ</strong>」であるというような前提・仮定をして進める。</p>

<h3>
<span id="データの準備" class="fragment"></span><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%BA%96%E5%82%99"><i class="fa fa-link"></i></a>データの準備</h3>

<p>データの下処理として、だいたいこんな感じで準備を進めていく</p>

<ul>
<li>入力は1文字ずつを辞書の数値化したものを利用

<ul>
<li>例:) いい会社 -&gt; <code>[1,1,2,3]</code>
</li>
</ul>
</li>
<li>サンプルに、1300件ずつ、評点が1(ネガティブ)、5(ポジティブ)であるクチコミを準備。</li>
<li>ネガティブを0、ポジティブを1として再ラベリング</li>
<li>
<a href="http://deeplearning.net/tutorial/code/imdb.py" rel="nofollow noopener" target="_blank">データ読み込みのスクリプト</a>を修正して独自のデータが読み込めるように調整

<ul>
<li>このスクリプト側で学習データを、訓練用と検証用に分割してくれたりする。</li>
<li>学習データと同様に、テストデータも用意。

<ul>
<li>今回のスクリプトでは、テストデータは、学習から完全に独立して、誤差測定にのみ利用される。</li>
</ul>
</li>
</ul>
</li>
</ul>

<h2>
<span id="とりあえずサンプル的に動かしてみる" class="fragment"></span><a href="#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E7%9A%84%E3%81%AB%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><i class="fa fa-link"></i></a>とりあえずサンプル的に動かしてみる。</h2>

<p>データの準備ができたら動かす。 <br>
デフォルトだと結構時間がかかるので、適度に隠れ層の数などを調整するほうが良さそうだった。</p>

<h3>
<span id="簡易スクリプトで試す" class="fragment"></span><a href="#%E7%B0%A1%E6%98%93%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E8%A9%A6%E3%81%99"><i class="fa fa-link"></i></a>簡易スクリプトで試す</h3>

<p>しばらく待ってモデルが構築されたら、ひとまず簡易なワードを投げてうまく行ってそうか動かしてみる。</p>

<p><a href="http://deeplearning.net/tutorial/code/lstm.py" rel="nofollow noopener" target="_blank">学習スクリプト</a>の400行目あたりの<code>pred_probs()</code>を見ると 「学習済みのモデルで検証したかったらこれ参考にすると良いよ」的な事が書いてあるので、これを参考にちょっとしたスクリプトで検証。</p>

<div class="code-frame" data-lang="python">
<div class="code-lang"><span class="bold">negaposi.py</span></div>
<div class="highlight"><pre>
<span class="n">model</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">"lstm_model.npz"</span><span class="p">)</span>
<span class="n">tparams</span> <span class="o">=</span> <span class="n">lstm</span><span class="o">.</span><span class="n">init_tparams</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

<span class="p">(</span><span class="n">use_noise</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">f_pred_prob</span><span class="p">,</span> <span class="n">f_pred</span><span class="p">,</span> <span class="n">cost</span><span class="p">)</span> <span class="o">=</span> <span class="n">lstm</span><span class="o">.</span><span class="n">build_model</span><span class="p">(</span><span class="n">tparams</span><span class="p">,</span> 
    <span class="c"># このへんのoptions投げないとKeyErrorになってしまう。</span>
    <span class="s">'encoder'</span><span class="p">:</span> <span class="s">'lstm'</span><span class="p">,</span>
    <span class="s">'dim_proj'</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
    <span class="s">'use_dropout'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
<span class="p">})</span>

<span class="c"># 最低限に簡略化</span>
<span class="k">def</span> <span class="nf">pred_probs</span><span class="p">(</span><span class="n">f_pred_prob</span><span class="p">,</span> <span class="n">sentence</span><span class="p">):</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">floatX</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">_y</span> <span class="o">=</span> <span class="n">imdb</span><span class="o">.</span><span class="n">prepare_data</span><span class="p">([</span><span class="n">sentence</span><span class="p">],</span>
                              <span class="mi">1</span><span class="p">,</span> <span class="c"># dummy。利用されないので適当に。</span>
                              <span class="n">maxlen</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f_pred_prob</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c"># それぞれ文字列を数値化した入力</span>
<span class="n">sentences</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s">"data"</span><span class="p">:</span> <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">23</span><span class="p">],</span>
        <span class="s">"text"</span><span class="p">:</span> <span class="s">"とても良い会社だ"</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s">"data"</span><span class="p">:</span> <span class="p">[</span><span class="mi">27</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">402</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">23</span><span class="p">],</span>
        <span class="s">"text"</span><span class="p">:</span> <span class="s">"とても最悪な会社だ"</span>
    <span class="p">}</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">sentence</span> <span class="ow">in</span> <span class="n">sentences</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pred_probs</span><span class="p">(</span><span class="n">f_pred_prob</span><span class="p">,</span> <span class="n">sentence</span><span class="p">[</span><span class="s">"data"</span><span class="p">])</span>
    <span class="k">print</span> <span class="s">"==="</span>
    <span class="k">print</span> <span class="n">result</span>
    <span class="k">print</span> <span class="n">sentence</span><span class="p">[</span><span class="s">"text"</span><span class="p">],</span> <span class="p">(</span><span class="s">"is positive"</span> <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">else</span> <span class="s">"is negative"</span><span class="p">)</span>
</pre></div>
</div>

<h3>
<span id="実行" class="fragment"></span><a href="#%E5%AE%9F%E8%A1%8C"><i class="fa fa-link"></i></a>実行</h3>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>
% python sample.py
===
input: とても良い会社だ =&gt; [27, 72, 104, 150, 19, 8, 106, 23]
output: [ 0.06803907  0.93196093]
とても良い会社だ is positive
===
input: とても最悪な会社だ =&gt; [27, 72, 104, 402, 121, 73, 8, 106, 23]
output: [ 0.73581125  0.26418875]
とても最悪な会社だ is negative
</pre></div></div>

<p>なんかそれっぽく出てきた。すごい。<br>
出力はLSTMを通した結果で、それぞれのクラスである確率が返ってきているらしい。</p>

<p>いけそうな感触が出てきたので、更に検証を進める。</p>

<h2>
<span id="試験結果" class="fragment"></span><a href="#%E8%A9%A6%E9%A8%93%E7%B5%90%E6%9E%9C"><i class="fa fa-link"></i></a>試験結果</h2>

<p>色々パラメータをいじりつつ、実行結果を細かく見てみる。<br>
とりあえず今回はそれなりに良さそうな結果になったdim_proj=8(隠れ層)、validFreq=30(検証頻度)の結果。</p>

<h3>
<span id="エラー率の推移" class="fragment"></span><a href="#%E3%82%A8%E3%83%A9%E3%83%BC%E7%8E%87%E3%81%AE%E6%8E%A8%E7%A7%BB"><i class="fa fa-link"></i></a>エラー率の推移</h3>

<p>今回実行したスクリプトは、検証用データとテストデータのエラーの遷移を記録している。<br>
だいたいこんな推移らしい。</p>

<p><a href="https://qiita-image-store.s3.amazonaws.com/0/7307/5ec90d0b-6d5d-77ac-8c9c-57f96dc0baa8.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/7307/5ec90d0b-6d5d-77ac-8c9c-57f96dc0baa8.png" width="500"></a></p>

<p>検証データを終える2600 updateを超えたあたりで1エポックを終えるので、その後から誤差が縮んでいる様子が見える。</p>

<p>また、訓練スクリプトの中で、Early stoppingをしてくれているので、過剰適合が起きる前で適度に止まってくれている様子も伺える。</p>

<h3>
<span id="testデータの結果分析" class="fragment"></span><a href="#test%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%B5%90%E6%9E%9C%E5%88%86%E6%9E%90"><i class="fa fa-link"></i></a>Testデータの結果分析</h3>

<p>検証では、最終的にテストデータのエラー率は0.2〜0.3程度ということなので、だいたい正答率7〜8割が期待できる。</p>

<p>本当にそうなっているか、それぞれTestとして利用したデータの中を見てみる。</p>

<h4>
<span id="評点と感情分類の分布を見る" class="fragment"></span><a href="#%E8%A9%95%E7%82%B9%E3%81%A8%E6%84%9F%E6%83%85%E5%88%86%E9%A1%9E%E3%81%AE%E5%88%86%E5%B8%83%E3%82%92%E8%A6%8B%E3%82%8B"><i class="fa fa-link"></i></a>評点と感情分類の分布を見る</h4>

<p>先ほど利用した<code>negaposi.py</code>を拡張して、テストサンプルをnegative / positveで分類をし、それぞれの分布を出すとこんな感じ</p>

<table>
<thead>
<tr>
<th style="text-align: left">評点</th>
<th style="text-align: left">negative(%)</th>
<th style="text-align: left">positive(%)</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left"><strong>★1つのクチコミ</strong></td>
<td style="text-align: left"><strong>84.34</strong></td>
<td style="text-align: left">15.66</td>
</tr>
<tr>
<td style="text-align: left">★2つのクチコミ</td>
<td style="text-align: left">66.53</td>
<td style="text-align: left">33.47</td>
</tr>
<tr>
<td style="text-align: left">★3つのクチコミ</td>
<td style="text-align: left">45.07</td>
<td style="text-align: left">54.93</td>
</tr>
<tr>
<td style="text-align: left">★4つのクチコミ</td>
<td style="text-align: left">25.77</td>
<td style="text-align: left">74.23</td>
</tr>
<tr>
<td style="text-align: left"><strong>★5つのクチコミ</strong></td>
<td style="text-align: left">27.59</td>
<td style="text-align: left"><strong>72.41</strong></td>
</tr>
</tbody>
</table>

<p>だいたいこんな事が見て取れる</p>

<ul>
<li>所感：割りと良さそう</li>
<li>★1、★5でだいたい正答率70%~80%。やはり結果とも大きくは相違無さそう。</li>
<li>テスト時には除外していた★4、★2もそれなりに妥当な数値になっている。</li>
<li>★3が五分五分に近い数値になっているのちょっと興味深い。

<ul>
<li>ちょっと中身をじっくり見ると何か気づきがありそう</li>
</ul>
</li>
</ul>

<h2>
<span id="検証結果を受けて" class="fragment"></span><a href="#%E6%A4%9C%E8%A8%BC%E7%B5%90%E6%9E%9C%E3%82%92%E5%8F%97%E3%81%91%E3%81%A6"><i class="fa fa-link"></i></a>検証結果を受けて</h2>

<ul>
<li>結果：まあ成功ぐらいな感じ

<ul>
<li>大成功！とまではいかないまでも、もうちょっとがんばれば使えるものになりそう。</li>
<li>結構実用化も夢ではなさそう</li>
</ul>
</li>
<li>
<p>さっくりやっただけの割にここまで来れた。LSTMすごい！</p>

<ul>
<li>正直係り受け頑張ってここまで辿りつけたかというとあんまり自信無い</li>
</ul>
</li>
<li>
<p>精度をもうちょっとあげることを考えたらこのへん出来そう</p>

<ul>
<li>年代や、業界などの情報を絞ったら精度が上がらないか？</li>
<li>隠れ層などパラメータをもっと調整？</li>
<li>データ量がまだ少ない？もう少し待つ？</li>
</ul>
</li>
</ul>

<h1>
<span id="感想" class="fragment"></span><a href="#%E6%84%9F%E6%83%B3"><i class="fa fa-link"></i></a>感想</h1>

<ul>
<li>調べてる間は「全然わからん・・・」となっていたけど動かしつつやってみていたらだんだんわかって来ることが多かった。

<ul>
<li>とりあえずやってみるの大事</li>
</ul>
</li>
<li>いろんなわからないことが出尽くしたタイミングで<a href="http://www.amazon.co.jp/dp/4061529021/ref=cm_sw_r_tw_dp_Si.ywb1KFVVJH" rel="nofollow noopener" target="_blank">深層学習</a>を読んだらすごい脳みそが穴埋めされた感じあってすごい助かった。</li>
<li>数日もがいてみた程度だが、いろんな意味で機械学習の世界のヤバさの片鱗を感じる事が出来た。

<ul>
<li>数年後にエンジニアの必須科目になっててもおかしくないとすら思えるポテンシャル</li>
</ul>
</li>
<li>
<a href="http://pandas.pydata.org/" rel="nofollow noopener" target="_blank">pandas</a>扱いやすくて最高だった。pandaありがとう。</li>
</ul>
<div class="hidden"><form class="js-task-list-update" action="/inuscript/items/54daa5aedde599e2637c" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><input type="hidden" name="authenticity_token" value="PXYNrN1zatdcQtMWPQiMOG4sibrr+vzb/EapDV8n7WgqUMa7XPi5haD3QfcuoNZzE4+q0LmfoJbRCoz7b1ltyA==" /><input type="hidden" name="updated_at_confirmation_in_unixtime" id="updated_at_confirmation_in_unixtime" value="1449503266" class="js-task-list-updated-at" /><textarea name="raw_body" id="raw_body" class="js-task-list-field">

せっかく会社の名前を借りたAdvent Calendarの記事なので、会社に絡んだ題材を扱います。

#（前置き）[転職会議](http://jobtalk.jp/) について
Livesenseでは、転職会議という転職者による企業の評判クチコミを扱ったサイトを運営しており、日々企業についてのクチコミが投稿されている。

これまで転職会議では、クチコミのテキストデータと5段階からなる評点データを別々のデータとして取得していたが、先日のリニューアルで、評点とテキストデータを同時に投稿できるようになり、さらに読みやすいクチコミを提供できるようになった。

|リニューアル以前に投稿されたクチコミ|リニューアル後に投稿されたクチコミ|
|---|---|
|&lt;a href=&quot;http://jobtalk.jp/company/answer_1388452.html&quot;&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/7307/680fd65f-5b4f-6919-0ab7-b53163d3d0eb.png&quot;before.png&quot; width=&quot;400&quot;&gt;&lt;/a&gt;|&lt;a href=&quot;http://jobtalk.jp/company/answer_2000003.html&quot;&gt;&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/7307/85f25beb-8cc9-6b03-2afc-a0a1995b84d8.png&quot; width=&quot;400&quot;&gt;&lt;/a&gt;|


### ここで感じる課題感

新しく投稿されるクチコミは評点によって読みやすくなったものの、過去に蓄積された大量の投稿には当然5段階の評点データは無いし、そのままでは顔アイコンを出すことは当然出来ない。

しかしこの課題を解決して、**過去のクチコミも同じように読みやすくなったらもっと良いサイトになるはず！**

という所を解決することは出来ないかやってみることにした。

# 取っ掛かり探し。手法を調べる
調べてみると、この問題は感情分析（他には評判分析、 Sentiment Analysis または Sentiment Classificationとか)と呼ばれている問題だそう。

さらにその手法は大別するとこんなあたりが確認できた。

- 感情辞書を使った判定手法
  - [Twitter Stream APIデータに対して初歩的な感情分析を試みる](http://qiita.com/kenmatsu4/items/52ab6deffdd61e7d8c0f)
  - [PythonでTwitterでのツイートをネガポジ判定してみた結果](http://tt-house.com/2013/08/twitter-nega-posi.html)
- 機械学習を使った手法
  - [深層学習でツイートの感情分析](http://qiita.com/hogefugabar/items/93fcb2bc27d7b268cbe6)

## 手法1: 感情辞書を使った手法
感情辞書を使う手法は、例えば「`残業`」がネガティブだとして「`残業はない`」であれば打ち消されてポジティブと判定する、というような単純なロジックだ。
しかし、すぐに困難に当たった。

&gt; 残業はそんなにありませんでした

例えば上記のような場合、チョチョイと係り受けをするだけでは解決せず、色々なパターンを考えなければならなそうだった。
さらに転職のクチコミという性質のせいか、このような言い回しはよく使われているようだった。。。

という所まで来てこの手法は早々に断念

## 手法2: 機械学習による手法
機械学習やらディープラーニングやらの未知の領域。
個人的には全く無知だし難易度高そうだなあ、、、と思いつつ、個人的にもそろそろ気になっていたのでこの手法を模索してみることにした。

### 機械学習による感情分析について調べる
ゆるふわな知識しか無いところから、「Sentiment Analysis」というワードを頼りに更に調査を進めると、だいたい下記のような事が見えてきた。

- 再帰型ニューラルネットワーク（RNN）というのが文章などを扱うにはよさそうらしい。
  - 中でもLSTMというのが精度が良くなりやすいとか。
  - [ニューラルネットワークで時系列データの予測を行う](http://qiita.com/icoxfog417/items/2791ee878deee0d0fd9c)

  - [The Unreasonable Effectiveness of Recurrent Neural Networks](http://karpathy.github.io/2015/05/21/rnn-effectiveness/)
      - 上記の[日本語翻訳された記事](http://qiita.com/GushiSnow/items/c0ff3f213cade8b760b8)

- Sentiment Analysisをしているサンプルもそれなりに見つけられた。

  - [Tensorflowを使ったサンプル](https://github.com/dennybritz/sentiment-analysis)(github)
      - 日本語を文字単位に区切って入力としている。
      - 良さそうだったが、ちょっと自由に操るのは難しそうだった。

  - [Chainerのサンプル](https://github.com/pfnet/chainer/tree/master/examples/sentiment)(github)
      - 英文を係り受け？にしているっぽい。
      - 使うには下処理が色々必要そう
      - [参考記事](http://qiita.com/K-1/items/282f2d8c4d5e33bc95ab)

  - [Chaninerで文字単位のRNNを行っているサンプル](https://github.com/yusuketomoto/chainer-char-rnn)(github)
      - これはSentiment Analysisではなく次に来る文章を生成するものっぽい。これも楽しそう

  - [Theanoを使ったサンプル](http://deeplearning.net/tutorial/lstm.html)
      - 英文の映画レビューを判定しているっぽい。
      - どこで何やっているのかなんとなくわかる。
      - **データを作れればなんか動かせそう**
      - 希望が見えてきた。

# (ここから本題）LSTMで感情分析を行う

今回は [Theanoを使ったサンプル](http://deeplearning.net/tutorial/lstm.html) を流用して検証を進める事にする。

（利用にあたって[コードリーディングした書き置き](http://qiita.com/inuscript/items/84f972af73c2af27849a)を別記事にしたので、興味がある方はそちらを参照）

## 学習データの特徴とか問題設定とか
### 学習データの特徴
今回学習データにする転職会議のクチコミデータは、1つのクチコミについて下記のような特徴がある。

- テキストデータ
  - 100文字以上
  - 1つの企業のついてのレビュー（今回はあんまり関係しない）
  - 1つの質問項目についてのレビュー（今回はあんまり関係しない）

- 評点データ
  - 会社についての5段階評価
  - 1が最も低く、5が最も高い評価
  - 星をいくつつけるかで選んでもらうよくあるアレ

### 問題設定
ここまでの結果を踏まえ、改めて下記のように問題設定をする。

```
書き込まれたクチコミの文章が、ポジティブであるかネガティブであるかを判定できるモデルを作る
```

本来であればデータにあわせて5段階評価まで目指したいものの、まあやっぱり難易度が高そうなので、今回は見送り。

あと今回はざっくり感覚に基づいてやってみるので、評点が低く付くような文章が「__ネガティブ__」、高く付くような文章が「__ポジティブ__」であるというような前提・仮定をして進める。

### データの準備

データの下処理として、だいたいこんな感じで準備を進めていく

- 入力は1文字ずつを辞書の数値化したものを利用
  - 例:) いい会社 -&gt; `[1,1,2,3]`
- サンプルに、1300件ずつ、評点が1(ネガティブ)、5(ポジティブ)であるクチコミを準備。
- ネガティブを0、ポジティブを1として再ラベリング
- [データ読み込みのスクリプト](http://deeplearning.net/tutorial/code/imdb.py)を修正して独自のデータが読み込めるように調整
  - このスクリプト側で学習データを、訓練用と検証用に分割してくれたりする。
  - 学習データと同様に、テストデータも用意。
      - 今回のスクリプトでは、テストデータは、学習から完全に独立して、誤差測定にのみ利用される。

## とりあえずサンプル的に動かしてみる。
データの準備ができたら動かす。 
デフォルトだと結構時間がかかるので、適度に隠れ層の数などを調整するほうが良さそうだった。

### 簡易スクリプトで試す
しばらく待ってモデルが構築されたら、ひとまず簡易なワードを投げてうまく行ってそうか動かしてみる。

[学習スクリプト](http://deeplearning.net/tutorial/code/lstm.py)の400行目あたりの`pred_probs()`を見ると 「学習済みのモデルで検証したかったらこれ参考にすると良いよ」的な事が書いてあるので、これを参考にちょっとしたスクリプトで検証。

```negaposi.py
model = numpy.load(&quot;lstm_model.npz&quot;)
tparams = lstm.init_tparams(model)

(use_noise, x, mask, y, f_pred_prob, f_pred, cost) = lstm.build_model(tparams, 
    # このへんのoptions投げないとKeyErrorになってしまう。
    &#39;encoder&#39;: &#39;lstm&#39;,
    &#39;dim_proj&#39;: 128,
    &#39;use_dropout&#39;: True,
})

# 最低限に簡略化
def pred_probs(f_pred_prob, sentence):
    probs = numpy.zeros((1, 2)).astype(config.floatX)
    x, mask, _y = imdb.prepare_data([sentence],
                              1, # dummy。利用されないので適当に。
                              maxlen=None)
    return f_pred_prob(x, mask)[0]

# それぞれ文字列を数値化した入力
sentences = [
    {
        &quot;data&quot;: [27, 72, 104, 150, 19, 8, 106, 23],
        &quot;text&quot;: &quot;とても良い会社だ&quot;
    },
    {
        &quot;data&quot;: [27, 72, 104, 402, 121, 73, 8, 106, 23],
        &quot;text&quot;: &quot;とても最悪な会社だ&quot;
    }
]

for sentence in sentences:
    result = pred_probs(f_pred_prob, sentence[&quot;data&quot;])
    print &quot;===&quot;
    print result
    print sentence[&quot;text&quot;], (&quot;is positive&quot; if (result[0] &lt; result[1]) else &quot;is negative&quot;)
```

### 実行

```
% python sample.py
===
input: とても良い会社だ =&gt; [27, 72, 104, 150, 19, 8, 106, 23]
output: [ 0.06803907  0.93196093]
とても良い会社だ is positive
===
input: とても最悪な会社だ =&gt; [27, 72, 104, 402, 121, 73, 8, 106, 23]
output: [ 0.73581125  0.26418875]
とても最悪な会社だ is negative
```

なんかそれっぽく出てきた。すごい。
出力はLSTMを通した結果で、それぞれのクラスである確率が返ってきているらしい。

いけそうな感触が出てきたので、更に検証を進める。

## 試験結果
色々パラメータをいじりつつ、実行結果を細かく見てみる。
とりあえず今回はそれなりに良さそうな結果になったdim_proj=8(隠れ層)、validFreq=30(検証頻度)の結果。

### エラー率の推移
今回実行したスクリプトは、検証用データとテストデータのエラーの遷移を記録している。
だいたいこんな推移らしい。

&lt;img src=&quot;https://qiita-image-store.s3.amazonaws.com/0/7307/5ec90d0b-6d5d-77ac-8c9c-57f96dc0baa8.png&quot; width=&quot;500&quot;&gt;

検証データを終える2600 updateを超えたあたりで1エポックを終えるので、その後から誤差が縮んでいる様子が見える。

また、訓練スクリプトの中で、Early stoppingをしてくれているので、過剰適合が起きる前で適度に止まってくれている様子も伺える。

### Testデータの結果分析

検証では、最終的にテストデータのエラー率は0.2〜0.3程度ということなので、だいたい正答率7〜8割が期待できる。

本当にそうなっているか、それぞれTestとして利用したデータの中を見てみる。


#### 評点と感情分類の分布を見る

先ほど利用した`negaposi.py`を拡張して、テストサンプルをnegative / positveで分類をし、それぞれの分布を出すとこんな感じ

評点|negative(%)|positive(%)
:---|:---|:---
**★1つのクチコミ** | **84.34** | 15.66
★2つのクチコミ | 66.53 | 33.47
★3つのクチコミ | 45.07 | 54.93
★4つのクチコミ | 25.77 | 74.23
**★5つのクチコミ** | 27.59 | **72.41**

だいたいこんな事が見て取れる

- 所感：割りと良さそう
- ★1、★5でだいたい正答率70%~80%。やはり結果とも大きくは相違無さそう。
- テスト時には除外していた★4、★2もそれなりに妥当な数値になっている。
- ★3が五分五分に近い数値になっているのちょっと興味深い。
  - ちょっと中身をじっくり見ると何か気づきがありそう

## 検証結果を受けて
- 結果：まあ成功ぐらいな感じ
  - 大成功！とまではいかないまでも、もうちょっとがんばれば使えるものになりそう。
  - 結構実用化も夢ではなさそう
- さっくりやっただけの割にここまで来れた。LSTMすごい！
  - 正直係り受け頑張ってここまで辿りつけたかというとあんまり自信無い
 
- 精度をもうちょっとあげることを考えたらこのへん出来そう
  - 年代や、業界などの情報を絞ったら精度が上がらないか？
  - 隠れ層などパラメータをもっと調整？
  - データ量がまだ少ない？もう少し待つ？

# 感想
- 調べてる間は「全然わからん・・・」となっていたけど動かしつつやってみていたらだんだんわかって来ることが多かった。
  - とりあえずやってみるの大事
- いろんなわからないことが出尽くしたタイミングで[深層学習](http://www.amazon.co.jp/dp/4061529021/ref=cm_sw_r_tw_dp_Si.ywb1KFVVJH)を読んだらすごい脳みそが穴埋めされた感じあってすごい助かった。
- 数日もがいてみた程度だが、いろんな意味で機械学習の世界のヤバさの片鱗を感じる事が出来た。
    - 数年後にエンジニアの必須科目になっててもおかしくないとすら思えるポテンシャル
- [pandas](http://pandas.pydata.org/)扱いやすくて最高だった。pandaありがとう。
</textarea><input type="submit" name="commit" value="Save changes" data-disable-with="Save changes" /></form></div></section></div><div class="col-sm-3"><div class="socialButtons"><div class="socialButtons_twitter"><a class="twitter-share-button" data-text="ディープラーニングを使って転職会議の企業クチコミデータを感情分析してみる by @inuscript on @Qiita" data-url="http://qiita.com/inuscript/items/54daa5aedde599e2637c" href="https://twitter.com/share">Tweet</a></div><div class="socialButtons_hatebu"><a class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" data-hatena-bookmark-title="ディープラーニングを使って転職会議の企業クチコミデータを感情分析してみる" href="http://b.hatena.ne.jp/entry/http://qiita.com/inuscript/items/54daa5aedde599e2637c" title="Add to Hatena Bookmark"><img alt="Add to Hatena Bookmark" height="20" src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" style="border: none;" width="20" /></a><script async="async" charset="utf-8" src="https://b.st-hatena.com/js/bookmark_button.js" type="text/javascript"></script></div><div class="socialButtons_googlePlus"><div class="g-plusone" data-href="http://qiita.com/inuscript/items/54daa5aedde599e2637c" data-size="medium"></div></div><div class="socialButtons_facebook"><div class="fb-like" data-action="like" data-href="http://qiita.com/inuscript/items/54daa5aedde599e2637c" data-layout="button_count" data-share="false" data-show-faces="false"></div></div><div class="socialButtons_pocket"><a class="pocket-btn" data-lang="en" data-pocket-count="horizontal" data-pocket-label="pocket"></a></div></div><section class="itemsShowAuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><a href="/inuscript"><img alt="" class="itemsShowAuthorInfo_userIcon" itemprop="image" src="https://qiita-image-store.s3.amazonaws.com/0/7307/profile-images/1473684148" /></a><div class="itemsShowAuthorInfo_profileStats"><strong class="itemsShowAuthorInfo_userName" itemprop="name"><a itemprop="url" href="/inuscript">inuscript</a></strong><div class="itemsShowAuthorInfo_contribution"><span class="itemsShowAuthorInfo_count">4120</span><span class="itemsShowAuthorInfo_unit">Contribution</span></div><div id="js-react-on-rails-context" data-rails-context="{}"></div>
<div class="js-react-on-rails-component" data-component-name="UserFollowButton" data-props="{&quot;initial_followed_by&quot;:false,&quot;position&quot;:&quot;author-info&quot;,&quot;size&quot;:&quot;btn-xs&quot;,&quot;url_name&quot;:&quot;inuscript&quot;}" data-trace="false" data-dom-id="UserFollowButton-react-component-53b48516-2a0a-433a-b7d5-dfc64ef504a9"></div>
    <div id="UserFollowButton-react-component-53b48516-2a0a-433a-b7d5-dfc64ef504a9"></div>
    
</div><section class="itemsShowAuthorPopularItems"><h5 class="itemsShowAuthorPopularItems_sectionTitle">人気の投稿</h5><ul class="itemsShowAuthorPopularItems_posts list-unstyled"><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/inuscript/items/41168a50904242005271">【古い記事】Babelにおける import / export </a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/inuscript/items/dcf48f56d8f484c0a1a8">時代はESLint。JSLintでもJSHintでもなくESLint。</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/inuscript/items/54daa5aedde599e2637c">ディープラーニングを使って転職会議の企業クチコミデータを感情分析してみる</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/inuscript/items/e996c42798bbb17add13">SCSSと付き合う上でやって(知って)よかったこと8選</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/inuscript/items/3ad3c0eded587e432aa5">究極で軽量なlazyloader。lazysizes</a></li></ul></section><section class="itemsShowAuthorInfo_organization"><h5 class="itemsShowAuthorInfo_organizationTitle">ORGANIZATION</h5><span itemprop="memberOf" itemscope="" itemtype="http://schema.org/Organization"><a itemprop="url" href="/organizations/livesense"><img alt="株式会社リブセンス" class="itemsShowAuthorInfo_organizationLogo" itemprop="image" src="https://s3-ap-northeast-1.amazonaws.com/qiita-organization-image/0a2109ccf38d4fb898cdc41c27c7a3a60db8af20/original.jpg?1411014219" /></a></span></section></section><div class="scroll-chaser"><div class="google-adsense"><style>.test-text-responsible { width: 200px; height: 200px; }@media(min-width: 1200px) {  .test-text-responsible { width: 250px; height: 250px; }}@media(max-width: 979px) and (min-width: 768px) {  .test-text-responsible { width: 120px; height: 240px; }}@media(max-width: 767px) {  .test-text-responsible { width: 320px; height: 50px; }}</style><script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle test-text-responsible" data-ad-client="ca-pub-8127218772604357" data-ad-slot="3880091879" style="display:inline-block"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div><div class="js-react-on-rails-component" data-component-name="Toc" data-props="{&quot;body&quot;:&quot;\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%89%8D%E7%BD%AE%E3%81%8D%E8%BB%A2%E8%81%B7%E4%BC%9A%E8%AD%B0-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6\&quot;\u003e（前置き）転職会議 について\u003c/a\u003e\n\u003cul\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E3%81%93%E3%81%93%E3%81%A7%E6%84%9F%E3%81%98%E3%82%8B%E8%AA%B2%E9%A1%8C%E6%84%9F\&quot;\u003eここで感じる課題感\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003ca href=\&quot;#%E5%8F%96%E3%81%A3%E6%8E%9B%E3%81%8B%E3%82%8A%E6%8E%A2%E3%81%97%E6%89%8B%E6%B3%95%E3%82%92%E8%AA%BF%E3%81%B9%E3%82%8B\&quot;\u003e取っ掛かり探し。手法を調べる\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E6%89%8B%E6%B3%951-%E6%84%9F%E6%83%85%E8%BE%9E%E6%9B%B8%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%9F%E6%89%8B%E6%B3%95\&quot;\u003e手法1: 感情辞書を使った手法\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E6%89%8B%E6%B3%952-%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92%E3%81%AB%E3%82%88%E3%82%8B%E6%89%8B%E6%B3%95\&quot;\u003e手法2: 機械学習による手法\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92%E3%81%AB%E3%82%88%E3%82%8B%E6%84%9F%E6%83%85%E5%88%86%E6%9E%90%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%AA%BF%E3%81%B9%E3%82%8B\&quot;\u003e機械学習による感情分析について調べる\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003ca href=\&quot;#%E3%81%93%E3%81%93%E3%81%8B%E3%82%89%E6%9C%AC%E9%A1%8Clstm%E3%81%A7%E6%84%9F%E6%83%85%E5%88%86%E6%9E%90%E3%82%92%E8%A1%8C%E3%81%86\&quot;\u003e(ここから本題）LSTMで感情分析を行う\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%AD%A6%E7%BF%92%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%89%B9%E5%BE%B4%E3%81%A8%E3%81%8B%E5%95%8F%E9%A1%8C%E8%A8%AD%E5%AE%9A%E3%81%A8%E3%81%8B\&quot;\u003e学習データの特徴とか問題設定とか\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%AD%A6%E7%BF%92%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%89%B9%E5%BE%B4\&quot;\u003e学習データの特徴\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%95%8F%E9%A1%8C%E8%A8%AD%E5%AE%9A\&quot;\u003e問題設定\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E6%BA%96%E5%82%99\&quot;\u003eデータの準備\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E3%81%A8%E3%82%8A%E3%81%82%E3%81%88%E3%81%9A%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E7%9A%84%E3%81%AB%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B\&quot;\u003eとりあえずサンプル的に動かしてみる。\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E7%B0%A1%E6%98%93%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%81%A7%E8%A9%A6%E3%81%99\&quot;\u003e簡易スクリプトで試す\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%AE%9F%E8%A1%8C\&quot;\u003e実行\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E8%A9%A6%E9%A8%93%E7%B5%90%E6%9E%9C\&quot;\u003e試験結果\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E3%82%A8%E3%83%A9%E3%83%BC%E7%8E%87%E3%81%AE%E6%8E%A8%E7%A7%BB\&quot;\u003eエラー率の推移\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#test%E3%83%87%E3%83%BC%E3%82%BF%E3%81%AE%E7%B5%90%E6%9E%9C%E5%88%86%E6%9E%90\&quot;\u003eTestデータの結果分析\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E8%A9%95%E7%82%B9%E3%81%A8%E6%84%9F%E6%83%85%E5%88%86%E9%A1%9E%E3%81%AE%E5%88%86%E5%B8%83%E3%82%92%E8%A6%8B%E3%82%8B\&quot;\u003e評点と感情分類の分布を見る\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E6%A4%9C%E8%A8%BC%E7%B5%90%E6%9E%9C%E3%82%92%E5%8F%97%E3%81%91%E3%81%A6\&quot;\u003e検証結果を受けて\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\n\n\u003ca href=\&quot;#%E6%84%9F%E6%83%B3\&quot;\u003e感想\u003c/a\u003e\n\n\n&quot;,&quot;wrapper&quot;:&quot;#article-body-wrapper&quot;}" data-trace="false" data-dom-id="Toc-react-component-ef87ed6f-675c-4643-89a7-588e511db0e0"></div>
    <div id="Toc-react-component-ef87ed6f-675c-4643-89a7-588e511db0e0"></div>
    
</div></div><div class="row"><div class="col-sm-9"><div class="ArticleFooter__menu"><div class="s-flex-align-center"><div class="js-likebutton" data-props="{&quot;like_status&quot;:false,&quot;like_count&quot;:346,&quot;show_count&quot;:true,&quot;uuid&quot;:&quot;54daa5aedde599e2637c&quot;,&quot;likable_type&quot;:&quot;Article&quot;,&quot;position&quot;:&quot;article-footer&quot;}"></div><div class="ArticleFooter__userList"><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="quattro_4"><a itemprop="url" href="/quattro_4"><img alt="quattro_4" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/5764/profile-images/1473682244" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="highwide"><a itemprop="url" href="/highwide"><img alt="highwide" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/51449/profile-images/1483519687" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="ieee0824"><a itemprop="url" href="/ieee0824"><img alt="ieee0824" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/58368/profile-images/1473694613" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="knoguchi"><a itemprop="url" href="/knoguchi"><img alt="knoguchi" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/13775/profile-images/1473683016" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="Kawada"><a itemprop="url" href="/Kawada"><img alt="Kawada" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/43073/profile-images/1473689397" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="yakk512"><a itemprop="url" href="/yakk512"><img alt="yakk512" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/24006/profile-images/1473683971" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="st450"><a itemprop="url" href="/st450"><img alt="st450" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/63970/profile-images/1473696432" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="yahihi"><a itemprop="url" href="/yahihi"><img alt="yahihi" class="thumb thumb--xs" src="https://secure.gravatar.com/avatar/c0b97f4521e0cdb6b8f835077a8f7e0f?d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="haminiku"><a itemprop="url" href="/haminiku"><img alt="haminiku" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/65312/profile-images/1473696847" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="shuhei"><a itemprop="url" href="/shuhei"><img alt="shuhei" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/3732/profile-images/1473683476" /></a></div></div><div class="ArticleFooter__user"><a href="/inuscript/items/54daa5aedde599e2637c/likers"><span class="fa fa-ellipsis-h"></span></a></div></div></div><div class="u-flex u-align-center"><div class="ArticleFooter__stock"><div class="js-stockbutton" data-position="footer_menu" data-props="{&quot;stock_status&quot;:false}"></div></div><div class="ArticleFooter__editRequest"><a class="u-link-no-underline" data-toggle="tooltip" title="You can propose improvements about the article to the author 💪" href="/drafts/54daa5aedde599e2637c/edit"><span class="fa fa-send-o fa-lg"></span> <span>Edit request</span></a></div><div class="dropdown ArticleFooter__dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="fa fa-ellipsis-h"></span></a><ul class="dropdown-menu dropdown-menu-right"><li><a href="/inuscript/items/54daa5aedde599e2637c.md"><span class="fa fa-fw fa-file-text-o"></span> Show article as Markdown</a></li><li><a data-target=".js-report-form" data-toggle="modal" href="#"><i class="fa fa-fw fa-flag"></i> Report article</a></li></ul></div></div></div><div class="itemsShowBody_adventCalendar"><div class="itemsShowBody_adventCalendar_header"><i class="fa fa-fw fa-calendar"></i> This post is the <span class="date">No.8</span> article of <a class="title" href="/advent-calendar/2015/livesense_1">Livesense Advent Calendar 2015</a></div><ul class="itemsShowBody_adventCalendar_nav list-unstyled"><li class="itemsShowBody_adventCalendar_neighborItem itemsShowBody_adventCalendar_neighborItem-prev"><span class="itemsShowBody_adventCalendar_date"><i class="fa fa-fw fa-arrow-circle-left"></i> Day 7:</span><span class="itemsShowBody_adventCalendar_title"><img alt="xorphitus" class="itemsShowBody_adventCalendar_icon" src="https://qiita-image-store.s3.amazonaws.com/0/890/profile-images/1473682139" width="18" height="18" /> <a class="itemsShowBody_adventCalendar_link" href="/xorphitus/items/8cd6a0cb1d5312aee44c">ある日moriの中Transducersに出会ったけどこれは何者か</a></span></li><li class="itemsShowBody_adventCalendar_neighborItem itemsShowBody_adventCalendar_neighborItem-next"><span class="itemsShowBody_adventCalendar_date"><i class="fa fa-fw fa-arrow-circle-right"></i> Day 9:</span><span class="itemsShowBody_adventCalendar_title"><img alt="yoheiit" class="itemsShowBody_adventCalendar_icon" src="https://qiita-image-store.s3.amazonaws.com/0/93640/profile-images/1473706016" width="18" height="18" /> <a class="itemsShowBody_adventCalendar_link" href="/yoheiit/items/5a0ab0491513b6281e80">Ottoでサンプルを動かしてみた</a></span></li></ul></div><ul class="references js-referencesView"><li class="references_header"><i class="fa fa-fw fa-link"></i> Linked from these articles</li><li class="references_reference js-reference"><span>Linked from </span><a href="/keigohtr/items/e85b413283b87ac02f4b#_reference-0941eb2eb5b8dc19d844"><img alt="" width="18" height="18" src="https://qiita-image-store.s3.amazonaws.com/0/113163/profile-images/1473712165" />日本語極性判定を作って公開した</a><time class="references_datetime js-dateTimeView" datetime="2016-11-05T06:58:30+00:00">4 months ago</time></li></ul><div class="itemsShowBody_articleColumnFooter"><div class="socialButtons"><div class="socialButtons_twitter"><a class="twitter-share-button" data-text="ディープラーニングを使って転職会議の企業クチコミデータを感情分析してみる by @inuscript on @Qiita" data-url="http://qiita.com/inuscript/items/54daa5aedde599e2637c" href="https://twitter.com/share">Tweet</a></div><div class="socialButtons_hatebu"><a class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" data-hatena-bookmark-title="ディープラーニングを使って転職会議の企業クチコミデータを感情分析してみる" href="http://b.hatena.ne.jp/entry/http://qiita.com/inuscript/items/54daa5aedde599e2637c" title="Add to Hatena Bookmark"><img alt="Add to Hatena Bookmark" height="20" src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" style="border: none;" width="20" /></a><script async="async" charset="utf-8" src="https://b.st-hatena.com/js/bookmark_button.js" type="text/javascript"></script></div><div class="socialButtons_googlePlus"><div class="g-plusone" data-href="http://qiita.com/inuscript/items/54daa5aedde599e2637c" data-size="medium"></div></div><div class="socialButtons_facebook"><div class="fb-like" data-action="like" data-href="http://qiita.com/inuscript/items/54daa5aedde599e2637c" data-layout="button_count" data-share="false" data-show-faces="false"></div></div><div class="socialButtons_pocket"><a class="pocket-btn" data-lang="en" data-pocket-count="horizontal" data-pocket-label="pocket"></a></div></div></div><div class="itemsShowComment_wrapper" id="comments"><div class="js-react-on-rails-component" data-component-name="CommentListContainer" data-props="{&quot;currentUser&quot;:null,&quot;initialComments&quot;:[{&quot;banned&quot;:false,&quot;body&quot;:&quot;\u003cp\u003e大変参考になります。データの準備ですが、文字を数値化する方法は具体的にどのように行いましたか？\u003c/p\u003e\n&quot;,&quot;created_at&quot;:&quot;2016-01-26T11:58:54+09:00&quot;,&quot;expanded_references&quot;:&quot;&quot;,&quot;id&quot;:442316,&quot;is_team&quot;:false,&quot;item_id&quot;:349661,&quot;item_type&quot;:&quot;PublicDomainArticle&quot;,&quot;item_uuid&quot;:&quot;54daa5aedde599e2637c&quot;,&quot;likable&quot;:false,&quot;liked&quot;:false,&quot;public_likes_count&quot;:0,&quot;raw_body&quot;:&quot;大変参考になります。データの準備ですが、文字を数値化する方法は具体的にどのように行いましたか？\n&quot;,&quot;reaction_types&quot;:[{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png&quot;,&quot;name&quot;:&quot;+1&quot;},{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f64f.png&quot;,&quot;name&quot;:&quot;pray&quot;},{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f389.png&quot;,&quot;name&quot;:&quot;tada&quot;},{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f647.png&quot;,&quot;name&quot;:&quot;bow&quot;},{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f631.png&quot;,&quot;name&quot;:&quot;scream&quot;},{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f440.png&quot;,&quot;name&quot;:&quot;eyes&quot;}],&quot;reactions&quot;:[],&quot;team&quot;:null,&quot;team_membership&quot;:null,&quot;updatable&quot;:false,&quot;url&quot;:&quot;http://qiita.com/inuscript/items/54daa5aedde599e2637c#comment-b6645c1e5e5b30a0e5e9&quot;,&quot;user&quot;:{&quot;contribution&quot;:87,&quot;created_at&quot;:&quot;2012-08-05T15:31:02+09:00&quot;,&quot;id&quot;:8118,&quot;is_admin&quot;:false,&quot;profile_image_url&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/8118/profile-images/1473680895&quot;,&quot;suspended&quot;:false,&quot;url_name&quot;:&quot;eleven_2012&quot;},&quot;uuid&quot;:&quot;b6645c1e5e5b30a0e5e9&quot;,&quot;via_email&quot;:false},{&quot;banned&quot;:false,&quot;body&quot;:&quot;\u003cp\u003e\u003ca href=\&quot;/eleven_2012\&quot; class=\&quot;user-mention js-hovercard\&quot; title=\&quot;eleven_2012\&quot; data-hovercard-target-type=\&quot;user\&quot; data-hovercard-target-name=\&quot;eleven_2012\&quot;\u003e@eleven_2012\u003c/a\u003e \u003cbr\u003e\n文字列からの数値化についてはgensimの\u003ccode\u003ecorpora.Dictionary\u003c/code\u003eを利用しました。\u003cbr\u003e\nざっくり主要な部分のコードとしては、こんな感じでサンプルデータを結合したデータを食わせました\u003c/p\u003e\n\n\u003cdiv class=\&quot;code-frame\&quot; data-lang=\&quot;py\&quot;\u003e\u003cdiv class=\&quot;highlight\&quot;\u003e\u003cpre\u003e\n\u003cspan class=\&quot;kn\&quot;\u003efrom\u003c/span\u003e \u003cspan class=\&quot;nn\&quot;\u003egensim\u003c/span\u003e \u003cspan class=\&quot;kn\&quot;\u003eimport\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ecorpora\u003c/span\u003e\n\n\u003cspan class=\&quot;n\&quot;\u003echars\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e[\u003c/span\u003e \u003cspan class=\&quot;nb\&quot;\u003elist\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003er\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003estrip\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e())\u003c/span\u003e \u003cspan class=\&quot;k\&quot;\u003efor\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003er\u003c/span\u003e \u003cspan class=\&quot;ow\&quot;\u003ein\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003econcatinated_sample_string_data\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e]\u003c/span\u003e\n\u003cspan class=\&quot;n\&quot;\u003edic\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003ecorpora\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003eDictionary\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003echars\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e\n\u003c/pre\u003e\u003c/div\u003e\u003c/div\u003e\n\n\u003cp\u003eここらへんのやり方はTensorFlowで同様のことを行っていた下記スクリプトも参考の一端としましたので、こちらも参考になるかもしれません\u003cbr\u003e\n\u003ca href=\&quot;https://github.com/dennybritz/sentiment-analysis/blob/master/utils/ymr_data.py#L36\&quot; class=\&quot;autolink\&quot; rel=\&quot;nofollow noopener\&quot; target=\&quot;_blank\&quot;\u003ehttps://github.com/dennybritz/sentiment-analysis/blob/master/utils/ymr_data.py#L36\u003c/a\u003e\u003c/p\u003e\n&quot;,&quot;created_at&quot;:&quot;2016-01-26T23:44:25+09:00&quot;,&quot;expanded_references&quot;:&quot;&quot;,&quot;id&quot;:443088,&quot;is_team&quot;:false,&quot;item_id&quot;:349661,&quot;item_type&quot;:&quot;PublicDomainArticle&quot;,&quot;item_uuid&quot;:&quot;54daa5aedde599e2637c&quot;,&quot;likable&quot;:false,&quot;liked&quot;:false,&quot;public_likes_count&quot;:1,&quot;raw_body&quot;:&quot;@eleven_2012 \n文字列からの数値化についてはgensimの`corpora.Dictionary`を利用しました。\nざっくり主要な部分のコードとしては、こんな感じでサンプルデータを結合したデータを食わせました\n\n```py\nfrom gensim import corpora\n\nchars = [ list(r.strip()) for r in concatinated_sample_string_data ]\ndic = corpora.Dictionary(chars)\n```\n\nここらへんのやり方はTensorFlowで同様のことを行っていた下記スクリプトも参考の一端としましたので、こちらも参考になるかもしれません\nhttps://github.com/dennybritz/sentiment-analysis/blob/master/utils/ymr_data.py#L36\n&quot;,&quot;reaction_types&quot;:[{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f44d.png&quot;,&quot;name&quot;:&quot;+1&quot;},{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f64f.png&quot;,&quot;name&quot;:&quot;pray&quot;},{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f389.png&quot;,&quot;name&quot;:&quot;tada&quot;},{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f647.png&quot;,&quot;name&quot;:&quot;bow&quot;},{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f631.png&quot;,&quot;name&quot;:&quot;scream&quot;},{&quot;image_url&quot;:&quot;https://cdn.qiita.com/emoji/twemoji/unicode/1f440.png&quot;,&quot;name&quot;:&quot;eyes&quot;}],&quot;reactions&quot;:[],&quot;team&quot;:null,&quot;team_membership&quot;:null,&quot;updatable&quot;:false,&quot;url&quot;:&quot;http://qiita.com/inuscript/items/54daa5aedde599e2637c#comment-851152d9a8d58e5fee0e&quot;,&quot;user&quot;:{&quot;contribution&quot;:4120,&quot;created_at&quot;:&quot;2012-07-08T16:40:31+09:00&quot;,&quot;id&quot;:7307,&quot;is_admin&quot;:false,&quot;profile_image_url&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/7307/profile-images/1473684148&quot;,&quot;suspended&quot;:false,&quot;url_name&quot;:&quot;inuscript&quot;},&quot;uuid&quot;:&quot;851152d9a8d58e5fee0e&quot;,&quot;via_email&quot;:false}],&quot;monthly_public_image_uploadable_size_limit&quot;:null,&quot;total_uploaded_public_image_size_in_current_month&quot;:null,&quot;item&quot;:{&quot;id&quot;:349661,&quot;uuid&quot;:&quot;54daa5aedde599e2637c&quot;,&quot;suspended&quot;:false,&quot;secret&quot;:false},&quot;owner&quot;:{&quot;url_name&quot;:&quot;inuscript&quot;},&quot;is_team&quot;:false,&quot;is_project&quot;:false,&quot;logged_in&quot;:false,&quot;polling&quot;:false,&quot;mention_candidates&quot;:[{&quot;id&quot;:7307,&quot;url_name&quot;:&quot;inuscript&quot;,&quot;profile_image_url&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/7307/profile-images/1473684148&quot;},{&quot;id&quot;:8118,&quot;url_name&quot;:&quot;eleven_2012&quot;,&quot;profile_image_url&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/8118/profile-images/1473680895&quot;}]}" data-trace="false" data-dom-id="CommentListContainer-react-component-60261eac-c639-4b51-b786-4b430315e96d"></div>
    <div id="CommentListContainer-react-component-60261eac-c639-4b51-b786-4b430315e96d"></div>
    
</div></div></div></div></article><div class="js-report-form modal fade reportForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Report article</h4></div><div class="modal-body"><form action="/reports" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="QyQ8tmLV005kMoZcK0fRS+bxr/d4kEzH+isfil86EotUAveh414AHJiHFL0474sAm1KMnSr1EIrXZzp8b0SSKw==" /><input type="hidden" name="redirect_path" id="redirect_path" value="/inuscript/items/54daa5aedde599e2637c" /><input type="hidden" name="item_uuid" id="item_uuid" value="54daa5aedde599e2637c" /><p>Help us understand the problem. What is going on with this item?</p><br /><div class="form-group"><ul class="list-unstyled"><li><label><input type="radio" name="report_type" id="report_type_spam" value="spam" required="required" /> It&#39;s spam </label></li><li><label><input type="radio" name="report_type" id="report_type_harassment" value="harassment" required="required" /> It&#39;s abusive or harmful </label></li><li><label><input type="radio" name="report_type" id="report_type_inappropriate_content" value="inappropriate_content" required="required" /> It contains inappropriate content </label></li></ul></div><div class="reportForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary reportForm_submitButton"><i class="fa fa-send"></i> Submit</button></div></form></div></div></div></div><script id="js-item" type="application/json">{ "url": "http://qiita.com/inuscript/items/54daa5aedde599e2637c", "id": 349661, "uuid": "54daa5aedde599e2637c" }</script><script class="js-user" type="application/json">{&quot;id&quot;:7307,&quot;url_name&quot;:&quot;inuscript&quot;,&quot;profile_image_url&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/7307/profile-images/1473684148&quot;}</script><script language="JavaScript" src="//cdn.bigmining.com/private/js/qiita_bigmining.js" type="text/javascript"></script></div><footer class="footer"><div class="footer_inner"><div class="footer_container"><ul class="footer_links-left"><li class="footer_link"><a class="footer_copyright" href="http://increments.co.jp">© 2011-2017 Increments Inc.</a></li><li class="footer_link"><a href="http://qiita.com/terms">Terms</a></li><li class="footer_link"><a href="http://qiita.com/privacy">Privacy</a></li><li class="footer_link"><a href="http://help.qiita.com">Help</a></li><li class="footer_link"><a href="https://increments.zendesk.com/anonymous_requests/new">Contact</a></li></ul><ul class="footer_links-right"><li class="footer_link"><a href="http://qiita.com/about">About</a></li><li class="footer_link"><a href="/users">Users</a></li><li class="footer_link"><a href="/tags">Tags</a></li><li class="footer_link"><a href="http://blog.qiita.com">Blog</a></li><li class="footer_link"><a href="http://qiita.com/api/v2/docs">API</a></li><li class="footer_link"><a href="https://teams.qiita.com/">Team</a></li><li class="footer_link"><a href="http://kobito.qiita.com">Kobito</a></li><li class="footer_link"><a class="js-public-form-feedback-link" data-target=".js-feedback-form" data-toggle="modal" href=""><i class="fa fa-heart"></i> Feedback <i class="fa fa-caret-down"></i></a></li></ul></div></div></footer><div class="js-feedback-form modal fade feedbackForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Feedback</h4></div><div class="modal-body"><form class="js-feedback-form-form" action="/feedbacks" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="NBO3dQ4STDQ+0atWBfwGmD4iKvJBClfRkOBJXtwZrwwjNXxij5mfZsJkObcWVFzTQ4EJmBNvC5y9rGyo7GcvrA==" /><input type="hidden" name="redirect_path" id="redirect_path" value="/inuscript/items/54daa5aedde599e2637c" /><div class="form-group"><textarea name="feedback[message]" id="feedback_message" class="form-control js-feedback-form-text-area" placeholder="Please give us any feedback about Qiita." required="required" rows="5">
</textarea></div><div class="feedbackForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary feedbackForm_submitButton"><i class="fa fa-send"></i> Submit</button><p class="feedbackForm_note">We don&#39;t reply to any feedback.<br />If you need help with Qiita, please send a support request from <a href="https://increments.zendesk.com/anonymous_requests/new">here</a>.</p></div><div style="position:fixed;top:-99999px;opacity:0.0001;"><input name="feedback[name]" type="text" /></div></form></div></div></div></div><script>// if (window.mixpanel instanceof Element) {
//   window.mixpanel = [];
// }
// (function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
// for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2.2.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);</script><script src="http://cdn.qiita.com/assets/public-3af9c1d29a49f3320bb796fb5e75304b.min.js"></script><script>
  (function () {
    var script = document.getElementsByTagName('script')[0];
    var load = function (src, id) {
      var el = document.createElement('script');
      el.async = true;
      el.src = src;
      el.id = id;
      script.parentNode.insertBefore(el, script);
    };
      // Optimizely
      load('//cdn.optimizely.com/js/52738645.js', 'optimizely-jssdk');
      // Google Analytics
      window._gaq = window._gaq || [];
      var isCareer = location.hostname.split('.')[0] == 'career';
      if (isCareer) {
        window._gaq.push(['_setAccount', 'UA-24675221-11']);
        window._gaq.push(['_setDomainName', 'qiita.com']);
      } else {
        window._gaq.push(['_setAccount', 'UA-24675221-1']);
      }
      window._gaq.push(['_setCustomVar', 1, 'logged_in', 'false', 2]);
      window._gaq.push(['_trackPageview']);
      var src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      load(src, 'google-analytics-jssdk');
    // Google Analytics - Universal Analytics
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-24675221-12', {
          
        });
          ga('create', 'UA-5982830-8', { name: 'user' });
          ga('user.send', 'pageview');
        ga('set', 'dimension1', 'false');
        ga('set', 'dimension3', 'false');
      ga('require', 'displayfeatures');
      ga('set', 'forceSSL', true);
      ga('send', 'pageview');
    // Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TBQWPN');
  })();
</script>
</body></html>