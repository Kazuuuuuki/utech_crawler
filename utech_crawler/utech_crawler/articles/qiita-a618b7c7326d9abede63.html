<!DOCTYPE html><html xmlns:og="http://ogp.me/ns#"><head><meta charset="UTF-8" /><title>多価関数と Category - Qiita</title><meta content="width=device-width,initial-scale=1" name="viewport" /><meta content="Control.Category モジュールを用いて多価函数1 の合成について考えてみます．
余力があればより有用な Control.Arrow モジュールについて見ていきたいです．
GHC, GHCi を使う環境を想定しています．

次の記事 → 綱渡りと Category (と，Kleisli)


多価函数


多価函数とは

与えられた数 x に対して，その平方根を返す函数について考えてみます．

例えば 4 の平方根は 2 と -2,
9 の平方根は 3 と ..." name="description" /><meta content="summary" name="twitter:card" /><meta content="@Qiita" name="twitter:site" /><meta content="CyLomw" name="twitter:creator" /><meta content="多価関数と Category - Qiita" property="og:title" /><meta content="article" property="og:type" /><meta content="http://qiita.com/CyLomw/items/a618b7c7326d9abede63" property="og:url" /><meta content="http://cdn.qiita.com/assets/qiita-fb-2887e7b4aad86fd8c25cea84846f2236.png" property="og:image" /><meta content="`Control.Category` モジュールを用いて多価函数[^1] の合成について考えてみます．
余力があればより有用な `Control.Arrow` モジュールについて見ていきたいです．
GHC, GHCi を使う環境を想定..." property="og:description" /><meta content="Qiita" property="og:site_name" /><meta content="564524038" property="fb:admins" /><link rel="shortcut icon" type="image/x-icon" href="http://cdn.qiita.com/assets/favicons/public/production-4ff10c1e1e2b5fcb353ff9cafdd56c70.ico" /><link rel="apple-touch-icon" type="image/png" href="http://cdn.qiita.com/assets/favicons/public/apple-touch-icon-f9a6afad761ec2306e10db2736187c8b.png" /><link href="/opensearch.xml" rel="search" title="Qiita" type="application/opensearchdescription+xml" /><link rel="stylesheet" media="all" href="http://cdn.qiita.com/assets/public-e8d29e8ff1879118096f0f5877946857.min.css" /><meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="xw/vWdD45LW978T3l5HdHw0vy8ZuiqqRnifSvd0sm5KpjXQBS9bd/kI8cevnZGNGbWjvdflO8Gai+dtGPCKVVA==" /></head><body class="without-js" id=""><noscript><iframe height="0" src="//www.googletagmanager.com/ns.html?id=GTM-TBQWPN" style="display:none;visibility:hidden" width="0"></iframe></noscript><script>
  document.body.className = document.body.className.replace('without-js', '') + ' with-js';
  window.Qiita = {"asset_host":"cdn.qiita.com","TLD":"com","controller_path":"public/items","controller_action":"public/items#show","controller":"items","action":"show","env":"production","flash":{},"is_landing_page":false,"is_team_page":false,"root_domain":"qiita.com","variant":null,"config":{"mixpanel":{"career":"dd35af27e959781713d63fd7ca898a8d","per_team":"c0a2116368b33b44b5029ebd2cc9b094","public":"be87616606b0e26a87689099aab2c4e5","team":"b7c0342acba2dbc8742484d98788efb3"},"default_locale":"ja","locale":"en"},"team":null,"user":null,"GIT_BRANCH":null,"DEBUG":false};

</script>
<div class="headerContainer headerContainer-public" role="navigation"><div data-react-class="T.HeaderContainer" data-react-props="{&quot;user&quot;:null,&quot;team&quot;:null,&quot;news&quot;:{&quot;type&quot;:&quot;Hot&quot;,&quot;content&quot;:&quot;Markdownによる情報共有サービス、Qiita:Team&quot;,&quot;url&quot;:&quot;https://teams.qiita.com?utm_source=qiita\u0026utm_medium=header_news&quot;},&quot;initial_unread_count&quot;:null,&quot;siteid_image&quot;:&quot;http://cdn.qiita.com/siteid-reverse.png&quot;,&quot;is_team_page&quot;:false,&quot;on_team_setting&quot;:false,&quot;show_post_menu&quot;:true,&quot;show_search_menu&quot;:true,&quot;is_fluid&quot;:false,&quot;locale&quot;:&quot;en&quot;}"></div></div><div id="main"><ol class="itemBreadcrumbs" itemscope="" itemtype="http://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="/"><span itemprop="name">Qiita</span></a><meta content="1" itemprop="position" /></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="/items"><span itemprop="name">Items</span></a><meta content="2" itemprop="position" /></li><li itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem"><a itemprop="item" href="/tags/Haskell"><span itemprop="name">Haskell</span></a><meta content="3" itemprop="position" /></li></ol><article itemscope="" itemtype="http://schema.org/Article"><div class="ArticleMainHeader "><div class="container"></div><div class="container"><div class="row s-flex-align-center"><div class="col-sm-9"><h1 class="ArticleMainHeader__title">多価関数と Category</h1><ul class="TagList"><li class="TagList__item" data-count="1345"><a class="u-link-unstyled TagList__label" href="/tags/Haskell"><img alt="Haskell" class="TagList__icon" src="https://s3-ap-northeast-1.amazonaws.com/qiita-tag-image/373b3b0595a92712b2a45616f53dae97bc1a04e5/medium.jpg?1387913155" /><span>Haskell</span></a></li></ul></div><div class="col-sm-3"><div class="itemsShowHeaderStock"><ul class="list-unstyled itemsShowHeaderStock_statusList"><li><div class="itemsShowHeaderStock_count stock"><span class="fa fa-thumbs-up"></span><span class="js-likecount">26</span></div><div class="itemsShowHeaderStock_countText">Like</div></li><li><div class="itemsShowHeaderStock_count" content="0 UserComments" itemprop="interactionCount"><span class="fa fa-comment"></span>0</div><div class="itemsShowHeaderStock_countText">Comment</div></li></ul></div><div class="js-likebutton" data-props="{&quot;like_status&quot;:false,&quot;like_count&quot;:26,&quot;uuid&quot;:&quot;a618b7c7326d9abede63&quot;,&quot;likable_type&quot;:&quot;Article&quot;,&quot;position&quot;:&quot;article-header&quot;}"></div><ul class="list-inline ArticleMainHeader__users"><li class="js-hovercard" data-hovercard-target-name="yu-i9"><a itemprop="url" href="/yu-i9"><img alt="yu-i9" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/57513/profile-images/1473694353" /></a></li><li class="js-hovercard" data-hovercard-target-name="myuon_myon"><a itemprop="url" href="/myuon_myon"><img alt="myuon_myon" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/8867/profile-images/1473681176" /></a></li><li class="js-hovercard" data-hovercard-target-name="mrk_21"><a itemprop="url" href="/mrk_21"><img alt="mrk_21" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/20400/profile-images/1473683001" /></a></li><li class="js-hovercard" data-hovercard-target-name="techno-tanoC"><a itemprop="url" href="/techno-tanoC"><img alt="techno-tanoC" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/49469/profile-images/1473691739" /></a></li><li class="js-hovercard" data-hovercard-target-name="ykominami"><a itemprop="url" href="/ykominami"><img alt="ykominami" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/4321/profile-images/1473756115" /></a></li><li class="js-hovercard" data-hovercard-target-name="HirofumiYashima"><a itemprop="url" href="/HirofumiYashima"><img alt="HirofumiYashima" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/43487/profile-images/1473689546" /></a></li><li class="js-hovercard" data-hovercard-target-name="7shi"><a itemprop="url" href="/7shi"><img alt="7shi" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/32057/profile-images/1473685823" /></a></li><li class="js-hovercard" data-hovercard-target-name="objectx"><a itemprop="url" href="/objectx"><img alt="objectx" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/9635/profile-images/1473681490" /></a></li><li class="js-hovercard" data-hovercard-target-name="JunKikuchi"><a itemprop="url" href="/JunKikuchi"><img alt="JunKikuchi" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/13181/profile-images/1473682708" /></a></li><li class="js-hovercard" data-hovercard-target-name="mikamix"><a itemprop="url" href="/mikamix"><img alt="mikamix" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/16900/profile-images/1473681998" /></a></li><li><a href="/CyLomw/items/a618b7c7326d9abede63/likers"><span class="fa fa-ellipsis-h"></span></a></li></ul></div></div></div></div><div class="ArticleAsideHeader"><div class="container"><div class="u-flex u-space-between"><div class="u-flex u-flex-wrap"><div class="u-flex u-align-center s-pdv-5 u-flex-wrap"><div class="ArticleAsideHeader__author"><a href="/CyLomw"><img class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/64300/profile-images/1473696539" alt="1473696539" /></a> <a class="u-link-unstyled" href="/CyLomw">CyLomw</a> </div><div class="ArticleAsideHeader__date"><span data-toggle="tooltip" title="posted at 2014-12-28">Edited at <time datetime="2015-01-25T13:44:59+09:00" itemprop="dateModified">2015-01-25</time></span></div></div><div class="u-flex u-align-center s-pdv-5 mobile-hidden"><div class="ArticleAsideHeader__revision"> <a data-toggle="tooltip" title="Revisions" href="/CyLomw/items/a618b7c7326d9abede63/revisions"><span class="fa fa-history"></span></a><span class="ArticleAsideHeader__revisionCount">23</span></div></div><div class="u-flex u-align-center s-pdv-5 mobile-hidden"></div></div><div class="u-flex u-align-center s-flex-justiry-between s-pdv-5 u-shrink-0"><div class="ArticleAsideHeader__stock"><div class="js-stockbutton" data-position="top" data-props="{&quot;stock_status&quot;:false}"></div></div><div class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="fa fa-ellipsis-h fa-lg"></span></a><ul class="dropdown-menu dropdown-menu-right"><li class="dropdown__item--mobile"><a href="/CyLomw/items/a618b7c7326d9abede63/revisions"><span class="fa fa-fw fa-history"></span> Revisions<span>(23)</span></a></li><li><a href="/CyLomw/items/a618b7c7326d9abede63.md"><span class="fa fa-fw fa-file-text-o"></span> Show article as Markdown</a></li><li><a data-target=".js-report-form" data-toggle="modal" href="#"><span class="fa fa-fw fa-flag"></span> Report article</a></li></ul></div></div></div></div></div><div class="container"><div class="row" id="article-body-wrapper"><div class="col-sm-9"><section class="markdownContent markdownContent-headingEnabled js-task-list-container clearfix position-relative" id="item-a618b7c7326d9abede63" itemprop="articleBody"><div class="alert alert-warning"><i class="fa fa-clock-o"></i> More than 1 year has passed since last update.</div><p><code>Control.Category</code> モジュールを用いて多価函数<sup id="fnref1"><a href="#fn1" rel="footnote" title="let 函数 = 関数">1</a></sup> の合成について考えてみます．<br>
余力があればより有用な <code>Control.Arrow</code> モジュールについて見ていきたいです．<br>
GHC, GHCi を使う環境を想定しています．</p>

<p>次の記事 → <a href="http://qiita.com/CyLomw/items/ff1e5d1600291c952c5e" title="綱渡りと Category (と，Kleisli)" id="reference-0e6ae4552755064035ca">綱渡りと Category (と，Kleisli)</a></p>

<h1>
<span id="多価函数" class="fragment"></span><a href="#%E5%A4%9A%E4%BE%A1%E5%87%BD%E6%95%B0"><i class="fa fa-link"></i></a>多価函数</h1>

<h2>
<span id="多価函数とは" class="fragment"></span><a href="#%E5%A4%9A%E4%BE%A1%E5%87%BD%E6%95%B0%E3%81%A8%E3%81%AF"><i class="fa fa-link"></i></a>多価函数とは</h2>

<p>与えられた数 x に対して，その平方根を返す函数について考えてみます．</p>

<p>例えば 4 の平方根は 2 と -2,<br>
9 の平方根は 3 と -3,<br>
17 の平方根は √17 と -√17<br>
のように平方根は (0 等を除いて) 二つ存在することがわかります．</p>

<p>このように入力に対して複数の出力を持つ "函数" を多価函数と呼びます．<br>
数学においては冪根，複素数の対数函数，周期函数の逆函数などさまざまな多価函数が存在します．</p>

<h2>
<span id="多価函数は函数ではない" class="fragment"></span><a href="#%E5%A4%9A%E4%BE%A1%E5%87%BD%E6%95%B0%E3%81%AF%E5%87%BD%E6%95%B0%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84"><i class="fa fa-link"></i></a>多価函数は函数ではない？</h2>

<p>函数は一般的に "1 つの入力に対して 1 つの出力を返す" ものであり，複数の出力を返す多価函数などは函数ではなく「関係」と呼ばれるようです．</p>

<p>Haskell においても，すべての函数は 1 つの値を返すようになっています．<br>
しかし複数の値をリストにまとめて "1 つのリスト" を返すことで多価函数っぽいものを実装することができます．</p>

<p>例えば平方根を返す函数は次のように書けます</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">sqrts</span> <span class="ow">::</span> <span class="kt">Floating</span> <span class="n">t</span> <span class="ow">=&gt;</span> <span class="n">t</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>
<span class="nf">sqrts</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">[</span><span class="n">sqrt</span> <span class="n">x</span><span class="p">,</span> <span class="o">-</span> <span class="n">sqrt</span> <span class="n">x</span><span class="p">]</span>
</pre></div></div>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">sqrts</span> <span class="mi">4</span>
<span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="o">-</span><span class="mf">2.0</span><span class="p">]</span>

<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">sqrts</span> <span class="mi">2</span>
<span class="p">[</span><span class="mf">1.4142135623730951</span><span class="p">,</span><span class="o">-</span><span class="mf">1.4142135623730951</span><span class="p">]</span>
</pre></div>
</div>

<h2>
<span id="非決定性計算" class="fragment"></span><a href="#%E9%9D%9E%E6%B1%BA%E5%AE%9A%E6%80%A7%E8%A8%88%E7%AE%97"><i class="fa fa-link"></i></a>非決定性計算</h2>

<p>以降，上の <code>sqrts</code> のようにリストを返す函数のことを「非決定性計算」と呼ぶことにします．<br>
これは値 (出力) が 1 つに定まらない計算であるという意味です．多価函数は函数ではないとのことなので，「函数」ではなく「計算」という単語を用いました．</p>

<p>非決定性は，複数の値が重なり合っているなどと言われることもあります．どこかで聞いたことがありますね．Haskell では箱の中の猫は次のように表現することができます<sup id="fnref2"><a href="#fn2" rel="footnote" title="すごい H 本の Prob モナドを使うと，各状態の確率も表せそうです．">2</a></sup>．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">data</span> <span class="kt">DA</span> <span class="ow">=</span> <span class="kt">Dead</span> <span class="o">|</span> <span class="kt">Alive</span>
  <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">)</span>

<span class="nf">schroedingerscat</span> <span class="ow">::</span> <span class="n">t</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">DA</span><span class="p">]</span>
<span class="nf">schroedingerscat</span> <span class="kr">_</span> <span class="ow">=</span> <span class="p">[</span><span class="kt">Dead</span><span class="p">,</span> <span class="kt">Alive</span><span class="p">]</span>
</pre></div></div>

<p><code>schroedingerscat</code> は引数にかかわらずリスト <code>[Dead, Alive]</code> を返す函数なので，次のように <code>Prelude</code> の <code>const</code> 函数を使って書くこともできます．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">data</span> <span class="kt">DA</span> <span class="ow">=</span> <span class="kt">Dead</span> <span class="o">|</span> <span class="kt">Alive</span>
  <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">)</span>

<span class="nf">schroedingerscat</span> <span class="ow">::</span> <span class="n">t</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">DA</span><span class="p">]</span>
<span class="nf">schroedingerscat</span> <span class="ow">=</span> <span class="n">const</span> <span class="p">[</span><span class="kt">Dead</span><span class="p">,</span> <span class="kt">Alive</span><span class="p">]</span>
</pre></div></div>

<h1>
<span id="nondet-i-o-型" class="fragment"></span><a href="#nondet-i-o-%E5%9E%8B"><i class="fa fa-link"></i></a><code>NonDet i o</code> 型</h1>

<h2>
<span id="type" class="fragment"></span><a href="#type"><i class="fa fa-link"></i></a><code>type</code>
</h2>

<p>非決定性計算は <code>i -&gt; [o]</code> <sup id="fnref3"><a href="#fn3" rel="footnote" title="input, output">3</a></sup>のような型を持つ函数で表されると考えられます．よって，次のように非決定性計算を表す型を定義することができます．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">type</span> <span class="kt">NonDet</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">o</span><span class="p">]</span>
</pre></div></div>

<p>とりあえず <code>type</code> によって型シノニムを作成してみました<sup id="fnref4"><a href="#fn4" rel="footnote" title="nondeterministic (非決定性の)">4</a></sup>．これにより <code>sqrts</code> や <code>schroedingerscat</code> は次のように書くことができます．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">sqrts</span> <span class="ow">::</span> <span class="kt">Floating</span> <span class="n">t</span> <span class="ow">=&gt;</span> <span class="kt">NonDet</span> <span class="n">t</span> <span class="n">t</span>
<span class="nf">sqrts</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">[</span><span class="n">sqrt</span> <span class="n">x</span><span class="p">,</span> <span class="o">-</span> <span class="n">sqrt</span> <span class="n">x</span><span class="p">]</span>

<span class="kr">data</span> <span class="kt">DA</span> <span class="ow">=</span> <span class="kt">Dead</span> <span class="o">|</span> <span class="kt">Alive</span>
  <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">)</span>

<span class="nf">schroedingerscat</span> <span class="ow">::</span> <span class="kt">NonDet</span> <span class="n">t</span> <span class="kt">DA</span>
<span class="nf">schroedingerscat</span> <span class="ow">=</span> <span class="n">const</span> <span class="p">[</span><span class="kt">Dead</span><span class="p">,</span> <span class="kt">Alive</span><span class="p">]</span>
</pre></div></div>

<h2>
<span id="data" class="fragment"></span><a href="#data"><i class="fa fa-link"></i></a><code>data</code>
</h2>

<p>Haskell の <code>type</code> は単に型に別名 (シノニム) を与えるだけであることを思い出してください．Haskell では型シノニムをある型クラスのインスタンスにする，というようなことはできません．<br>
そこで, <code>type</code> ではなく <code>data</code> を用いて新しい <code>NonDet i o</code> 型をつくることにしましょう．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">data</span> <span class="kt">NonDet</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">(</span><span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">o</span><span class="p">])</span>
</pre></div></div>

<p><code>type</code> の時と異なり，もはや <code>i -&gt; [o]</code> 型と <code>NonDet i o</code> 型は異なる型です．<br>
<code>sqrts</code> 函数の型は <code>Floating t =&gt; t -&gt; [t]</code> であるため，そのままでは <code>NonDet t t</code> のような型にはなりません．そこで，<code>NonDet</code> 値コンストラクタを用いて <code>sqrts</code> 函数から <code>NonDet t t</code> 型を生み出します．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">sqrts</span> <span class="ow">::</span> <span class="kt">Floating</span> <span class="n">t</span> <span class="ow">=&gt;</span> <span class="n">t</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>
<span class="nf">sqrts</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">[</span><span class="n">sqrt</span> <span class="n">x</span><span class="p">,</span> <span class="o">-</span> <span class="n">sqrt</span> <span class="n">x</span><span class="p">]</span>

<span class="nf">sqrtsND</span> <span class="ow">::</span> <span class="kt">Floating</span> <span class="n">t</span> <span class="ow">=&gt;</span> <span class="kt">NonDet</span> <span class="n">t</span> <span class="n">t</span>
<span class="nf">sqrtsND</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="n">sqrts</span>
</pre></div></div>

<p>こうしてできた <code>sqrtsND</code> 型は <code>NonDet t t</code> 型にはなりましたが，当然このまま <code>sqrtsND 4</code> のようには使えません．そこで <code>runNonDet</code> 函数を次のように定義します．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">runNonDet</span> <span class="ow">::</span> <span class="kt">NonDet</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">o</span><span class="p">])</span>
<span class="nf">runNonDet</span> <span class="p">(</span><span class="kt">NonDet</span> <span class="n">f</span><span class="p">)</span> <span class="ow">=</span> <span class="n">f</span>
</pre></div></div>

<p><code>runNonDet</code> 函数は <code>NonDet</code> をほどく役割を果たします．これにより，次のように <code>sqrtsND</code> 函数を実行できます．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="n">sqrtsND</span> <span class="mi">4</span>
<span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="o">-</span><span class="mf">2.0</span><span class="p">]</span>

<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="n">sqrtsND</span> <span class="mi">2</span>
<span class="p">[</span><span class="mf">1.4142135623730951</span><span class="p">,</span><span class="o">-</span><span class="mf">1.4142135623730951</span><span class="p">]</span>
</pre></div>
</div>

<p>実は，<code>runNonDet</code> 函数は別途実装しなくても <code>NonDet i o</code> 型を次のようにレコード構文で定義することによって得ることができます．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">data</span> <span class="kt">NonDet</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">{</span> <span class="n">runNonDet</span> <span class="ow">::</span> <span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="p">}</span>
</pre></div></div>

<h2>
<span id="newtype" class="fragment"></span><a href="#newtype"><i class="fa fa-link"></i></a><code>newtype</code>
</h2>

<p>いままで <code>data</code> を用いてきましたが，<code>newtype</code> を用いるほうが高速なので以降は <code>newtype</code> を用いることにします．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">sqrts</span> <span class="ow">::</span> <span class="kt">Floating</span> <span class="n">t</span> <span class="ow">=&gt;</span> <span class="n">t</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>
<span class="nf">sqrts</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">[</span><span class="n">sqrt</span> <span class="n">x</span><span class="p">,</span> <span class="o">-</span> <span class="n">sqrt</span> <span class="n">x</span><span class="p">]</span>

<span class="nf">sqrtsND</span> <span class="ow">::</span> <span class="kt">Floating</span> <span class="n">t</span> <span class="ow">=&gt;</span> <span class="kt">NonDet</span> <span class="n">t</span> <span class="n">t</span>
<span class="nf">sqrtsND</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="n">sqrts</span>


<span class="kr">data</span> <span class="kt">DA</span> <span class="ow">=</span> <span class="kt">Dead</span> <span class="o">|</span> <span class="kt">Alive</span>
  <span class="kr">deriving</span> <span class="p">(</span><span class="kt">Show</span><span class="p">)</span>

<span class="nf">schroedingerscat</span> <span class="ow">::</span> <span class="n">t</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">DA</span><span class="p">]</span>
<span class="nf">schroedingerscat</span> <span class="ow">=</span> <span class="n">const</span> <span class="p">[</span><span class="kt">Dead</span><span class="p">,</span> <span class="kt">Alive</span><span class="p">]</span>

<span class="nf">schroedingerscatND</span> <span class="ow">::</span> <span class="kt">NonDet</span> <span class="n">t</span> <span class="kt">DA</span>
<span class="nf">schroedingerscatND</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="n">schroedingerscat</span>


<span class="kr">newtype</span> <span class="kt">NonDet</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">{</span> <span class="n">runNonDet</span> <span class="ow">::</span> <span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="p">}</span>
</pre></div></div>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="n">sqrtsND</span> <span class="mi">4</span>
<span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="o">-</span><span class="mf">2.0</span><span class="p">]</span>

<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="n">sqrtsND</span> <span class="mi">2</span>
<span class="p">[</span><span class="mf">1.4142135623730951</span><span class="p">,</span><span class="o">-</span><span class="mf">1.4142135623730951</span><span class="p">]</span>

<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="n">schroedingerscatND</span> <span class="mi">1</span>
<span class="p">[</span><span class="kt">Dead</span><span class="p">,</span><span class="kt">Alive</span><span class="p">]</span>
</pre></div>
</div>

<h1>
<span id="計算の合成と-category" class="fragment"></span><a href="#%E8%A8%88%E7%AE%97%E3%81%AE%E5%90%88%E6%88%90%E3%81%A8-category"><i class="fa fa-link"></i></a>計算の合成と <code>Category</code>
</h1>

<h2>
<span id="非決定性計算の合成" class="fragment"></span><a href="#%E9%9D%9E%E6%B1%BA%E5%AE%9A%E6%80%A7%E8%A8%88%E7%AE%97%E3%81%AE%E5%90%88%E6%88%90"><i class="fa fa-link"></i></a>非決定性計算の合成</h2>

<p>ここで新しく次のような函数を考えます．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">succ_n</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]</span>
<span class="nf">succ_n</span> <span class="n">n</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">[</span><span class="n">x</span><span class="o">..</span><span class="n">x</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>
</pre></div></div>

<p>この函数は x から x + n までのリストを返す函数です．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">succ_n</span> <span class="mi">2</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span>

<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">succ_n</span> <span class="mi">10</span> <span class="mi">2</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span>
</pre></div>
</div>

<p>この <code>succ_n</code> 函数の合成について考えてみます．</p>

<p>たとえば <code>(succ_n 2)</code> と <code>(succ_n 5)</code> を合成することを考えてみます．<br>
<code>(succ_n 2) :: Int -&gt; [Int]</code>, <code>(succ_n 5) :: Int -&gt; [Int]</code> なのでそのままではこの二つは当然函数合成できません．</p>

<p>しかし，もし合成するとしたら例えば次のような感じになるでしょうか．<br>
<a href="https://qiita-image-store.s3.amazonaws.com/0/64300/003e8537-5f5d-c9d6-188d-f73dd7bc2201.png" target="_blank" rel="nofollow noopener"><img src="https://qiita-image-store.s3.amazonaws.com/0/64300/003e8537-5f5d-c9d6-188d-f73dd7bc2201.png" alt="test.png"></a></p>

<p>このような合成は <code>map</code> と <code>concat</code> を用いれば行うことができます．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">concat</span> <span class="p">(</span><span class="n">map</span> <span class="p">(</span><span class="n">succ_n</span> <span class="mi">5</span><span class="p">)</span> <span class="p">((</span><span class="n">succ_n</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">10</span><span class="p">))</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">]</span>
</pre></div>
</div>

<p>括弧が多いですが函数合成を用いると次のように書き直せます．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="n">succ_n</span> <span class="mi">5</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="n">succ_n</span> <span class="mi">2</span><span class="p">)</span> <span class="o">$</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">]</span>
</pre></div>
</div>

<p>しかしいちいち <code>map</code> と <code>concat</code> を記述しなければならないのは，特に合成が長くなってくると面倒です．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="n">succ_n</span> <span class="mi">4</span><span class="p">)</span> <span class="o">.</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="n">succ_n</span> <span class="mi">3</span><span class="p">)</span> <span class="o">.</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="n">succ_n</span> <span class="mi">2</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="n">succ_n</span> <span class="mi">1</span><span class="p">)</span> <span class="o">$</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>

<h2>
<span id="controlcategory" class="fragment"></span><a href="#controlcategory"><i class="fa fa-link"></i></a><code>Control.Category</code>
</h2>

<p>ここで満を持して登場するのが <code>Control.Category</code> モジュール<sup id="fnref5"><a href="#fn5" rel="footnote" title="Control.Category モジュールは base パッケージに含まれています．">5</a></sup>です．<br>
<code>Control.Category</code> モジュール内には <code>Category</code> (カテゴリー, 圏) 型クラスが定義されています．まずは定義を見てみます．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">Control.Category</span></div>
<div class="highlight"><pre>
<span class="kr">class</span> <span class="kt">Category</span> <span class="n">cat</span> <span class="kr">where</span>
    <span class="c1">-- | the identity morphism</span>
    <span class="n">id</span> <span class="ow">::</span> <span class="n">cat</span> <span class="n">a</span> <span class="n">a</span>

    <span class="c1">-- | morphism composition</span>
    <span class="p">(</span><span class="o">.</span><span class="p">)</span> <span class="ow">::</span> <span class="n">cat</span> <span class="n">b</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">cat</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">cat</span> <span class="n">a</span> <span class="n">c</span>
</pre></div>
</div>

<p>見ての通り， <code>Category</code> 型クラスの定義は非常に簡単で，<code>id</code> 函数と <code>(.)</code> 函数を持つだけです．</p>

<p><code>id</code> も <code>(.)</code> も見覚えのある函数です．どちらも <code>Prelude</code> に同名の函数が定義されていて， <code>id</code> は引数をそのまま返す恒等函数，<code>(.)</code> は函数合成を行う函数でした．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="kt">Prelude</span><span class="o">&gt;</span> <span class="kt">:</span><span class="n">t</span> <span class="n">id</span>
<span class="nf">id</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span>
<span class="kt">Prelude</span><span class="o">&gt;</span> <span class="n">id</span> <span class="mi">10</span>
<span class="mi">10</span>
<span class="kt">Prelude</span><span class="o">&gt;</span> <span class="kt">:</span><span class="n">t</span> <span class="p">(</span><span class="o">.</span><span class="p">)</span>
<span class="p">(</span><span class="o">.</span><span class="p">)</span> <span class="ow">::</span> <span class="p">(</span><span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">c</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">c</span>
<span class="kt">Prelude</span><span class="o">&gt;</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span> <span class="o">$</span> <span class="mi">10</span>
<span class="mi">24</span>
</pre></div>
</div>

<p>まず，このままだと <code>Prelude</code> の <code>id</code>, <code>(.)</code> と <code>Control.Category</code> の <code>id</code>, <code>(.)</code> が名前の衝突を起こしてしまうので，<code>Control.Category</code> モジュールをインポートするときは下のように「修飾付きインポート」するようにします．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Control.Category</span> <span class="k">as</span> <span class="n">Cat</span>
</pre></div></div>

<p>以降，<code>Control.Category.id</code> を <code>Cat.id</code>, <code>(Control.Category..)</code> を <code>(Cat..)</code> と書くことにします．<br>
<code>.</code> が二つ見えるのは気のせいではないです．<code>Cat.</code> 部分が修飾で <code>.</code> が合成を行う函数 <code>(.)</code> です．</p>

<p>さて，<code>Cat.id</code> と <code>(Cat..)</code> は一体どういう働きをする函数なのでしょう．<br>
<code>Prelude</code> にある函数と同名なのだから，きっと同じような働きをするのだろうと考えられます．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kt">Prelude</span><span class="o">.</span><span class="n">id</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span>
<span class="kt">Cat</span><span class="o">.</span><span class="n">id</span> <span class="ow">::</span> <span class="kt">Cat</span><span class="o">.</span><span class="kt">Category</span> <span class="n">cat</span> <span class="ow">=&gt;</span> <span class="n">cat</span> <span class="n">a</span> <span class="n">a</span>

<span class="p">(</span><span class="kt">Prelude</span><span class="o">..</span><span class="p">)</span> <span class="ow">::</span> <span class="p">(</span><span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">c</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">c</span>
<span class="p">(</span><span class="kt">Cat</span><span class="o">..</span><span class="p">)</span> <span class="ow">::</span> <span class="kt">Cat</span><span class="o">.</span><span class="kt">Category</span> <span class="n">cat</span> <span class="ow">=&gt;</span> <span class="n">cat</span> <span class="n">b</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">cat</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">cat</span> <span class="n">a</span> <span class="n">c</span>
</pre></div></div>

<p>それぞれを見比べてみると，あることがわかります．<br>
<code>Cat.id</code> と <code>(Cat..)</code> において <code>cat</code> を <code>(-&gt;)</code> に置き換えるとそれぞれ <code>Prelude.id</code> と <code>(Prelude..)</code> に一致します<sup id="fnref6"><a href="#fn6" rel="footnote" title="a -&gt; b は (-&gt;) a b と書くことができます．">6</a></sup>．</p>

<p>つまり，型クラス <code>Category</code> の型変数 <code>cat</code> には，<code>(-&gt;)</code> のようなものが入るということです．</p>

<p>実は <code>(-&gt;)</code> は二つの型引数をとる型コンストラクタなのですが，少々わかりにくいですね．そういえば二つの型引数をとる型コンストラクタといえば，先ほど定義した <code>NonDet</code> もそうでした．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">newtype</span> <span class="kt">NonDet</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">{</span> <span class="n">runNonDet</span> <span class="ow">::</span> <span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="p">}</span>
</pre></div></div>

<p>ということで試しに <code>cat</code> を <code>NonDet</code> で置き換えてみると，次のようになります</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kt">Cat</span><span class="o">.</span><span class="n">id</span> <span class="ow">::</span> <span class="kt">NonDet</span> <span class="n">a</span> <span class="n">a</span>
<span class="p">(</span><span class="kt">Cat</span><span class="o">..</span><span class="p">)</span> <span class="ow">::</span> <span class="kt">NonDet</span> <span class="n">b</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="kt">NonDet</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="kt">NonDet</span> <span class="n">a</span> <span class="n">c</span>
</pre></div></div>

<p>なんだかこれ，「非決定性計算における恒等計算」 と「非決定性計算の合成を行う函数」 に見えてきました．</p>

<p>実は，<code>Category</code> 型クラスは「恒等計算 (引数をそのまま返すような計算) <code>Cat.id</code>」と「計算の合成を行う函数 <code>(Cat..)</code>」を提供してくれる型クラスだったのです．</p>

<h2>
<span id="nondet-を-category-のインスタンスにする" class="fragment"></span><a href="#nondet-%E3%82%92-category-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AB%E3%81%99%E3%82%8B"><i class="fa fa-link"></i></a><code>NonDet</code> を <code>Category</code> のインスタンスにする</h2>

<p>とりあえず，<code>Category</code> は型クラスであり，<code>NonDet</code> は <code>Category</code> のインスタンスになれそうであるというので，実際にインスタンスにしてみることにします．</p>

<p>まず <code>Cat.id :: NonDet a a</code> は引数をそのまま返すようなものということですが，リストを返さなければならない都合上 <code>NonDet (\x -&gt; x)</code> とはできないので <code>NonDet (\x -&gt; [x])</code> とします．</p>

<p><code>(Cat..) :: NonDet b c -&gt; NonDet a b -&gt; NonDet a c</code> の方は，先ほど考えた <code>map</code> と <code>concat</code> を使った合成 <code>concat . map f . g</code> を使って，それを <code>NonDet</code> でくるんでみます．</p>

<p>よって次のようなインスタンス宣言が書けると思います．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Control.Category</span> <span class="k">as</span> <span class="n">Cat</span>

<span class="kr">newtype</span> <span class="kt">NonDet</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">{</span> <span class="n">runNonDet</span> <span class="ow">::</span> <span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="p">}</span>

<span class="kr">instance</span> <span class="kt">Cat</span><span class="o">.</span><span class="kt">Category</span> <span class="kt">NonDet</span> <span class="kr">where</span>
    <span class="n">id</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
    <span class="p">(</span><span class="kt">NonDet</span> <span class="n">f</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="kt">NonDet</span> <span class="n">g</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="o">$</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="n">f</span> <span class="o">.</span> <span class="n">g</span>
</pre></div></div>

<p>修飾付きインポートをしているので，<code>instance Cat.Category</code> の部分の <code>Category</code> にも修飾が必要なことを忘れないでください．<br>
逆に <code>instance</code> 宣言中の <code>id</code>, <code>(.)</code> には修飾は必要ないことにも注意してください．<br>
(右辺の <code>(.)</code> は通常の函数合成であることにも注意してください．)</p>

<p>さて，これで無事 <code>NonDet</code> を <code>Category</code> のインスタンスにすることができましたが，期待通り動くでしょうか．</p>

<p>まず <code>succ_n</code> の <code>NonDet</code> 版を作っていなかったので作成します．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Control.Category</span> <span class="k">as</span> <span class="n">Cat</span>

<span class="kr">newtype</span> <span class="kt">NonDet</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">{</span> <span class="n">runNonDet</span> <span class="ow">::</span> <span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="p">}</span>

<span class="kr">instance</span> <span class="kt">Cat</span><span class="o">.</span><span class="kt">Category</span> <span class="kt">NonDet</span> <span class="kr">where</span>
    <span class="n">id</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
    <span class="p">(</span><span class="kt">NonDet</span> <span class="n">f</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="kt">NonDet</span> <span class="n">g</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="o">$</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="n">f</span> <span class="o">.</span> <span class="n">g</span>

<span class="nf">succ_n</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]</span>
<span class="nf">succ_n</span> <span class="n">n</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">[</span><span class="n">x</span><span class="o">..</span><span class="n">x</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>

<span class="nf">succ_n_ND</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">NonDet</span> <span class="kt">Int</span> <span class="kt">Int</span>
<span class="nf">succ_n_ND</span> <span class="n">n</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">(</span><span class="n">succ_n</span> <span class="n">n</span><span class="p">)</span>
</pre></div></div>

<p>例のように <code>runNonDet</code> を使って実行します．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="p">(</span><span class="n">succ_n_ND</span> <span class="mi">2</span><span class="p">)</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span>

<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="p">(</span><span class="n">succ_n_ND</span> <span class="mi">10</span><span class="p">)</span> <span class="mi">2</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]</span>
</pre></div>
</div>

<p>では <code>(Cat..)</code> を使って <code>(succ_n_ND 2)</code> と <code>(succ_n_ND 5)</code> の合成を行ってみます．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="p">((</span><span class="n">succ_n_ND</span> <span class="mi">5</span><span class="p">)</span> <span class="kt">Cat</span><span class="o">..</span> <span class="p">(</span><span class="n">succ_n_ND</span> <span class="mi">2</span><span class="p">))</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">]</span>
</pre></div>
</div>

<p><code>concat . map (succ_n 5) . (succ_n 2) $ 10</code> とちゃんと結果が一致しています！</p>

<p>合成が長くなっても同じようにできます．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="p">((</span><span class="n">succ_n_ND</span> <span class="mi">4</span><span class="p">)</span> <span class="kt">Cat</span><span class="o">..</span> <span class="p">(</span><span class="n">succ_n_ND</span> <span class="mi">3</span><span class="p">)</span> <span class="kt">Cat</span><span class="o">..</span> <span class="p">(</span><span class="n">succ_n_ND</span> <span class="mi">2</span><span class="p">)</span> <span class="kt">Cat</span><span class="o">..</span> <span class="p">(</span><span class="n">succ_n_ND</span> <span class="mi">1</span><span class="p">))</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>

<p>いい感じです．</p>

<p><code>Cat.id</code> も使ってみましょう．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="p">(</span><span class="kt">Cat</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">]</span>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="p">(</span><span class="kt">Cat</span><span class="o">.</span><span class="n">id</span> <span class="kt">Cat</span><span class="o">..</span> <span class="kt">Cat</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">]</span>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="p">((</span><span class="n">succ_n_ND</span> <span class="mi">5</span><span class="p">)</span> <span class="kt">Cat</span><span class="o">..</span> <span class="kt">Cat</span><span class="o">.</span><span class="n">id</span> <span class="kt">Cat</span><span class="o">..</span> <span class="p">(</span><span class="n">succ_n_ND</span> <span class="mi">2</span><span class="p">)</span> <span class="kt">Cat</span><span class="o">..</span> <span class="kt">Cat</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">]</span>
</pre></div>
</div>

<p><code>Cat.id</code> はまさに通常の函数合成における <code>id</code> のように，合成しても影響を与えません．</p>

<h2>
<span id="controlcategory-モジュールの他の函数" class="fragment"></span><a href="#controlcategory-%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E4%BB%96%E3%81%AE%E5%87%BD%E6%95%B0"><i class="fa fa-link"></i></a><code>Control.Category</code> モジュールの他の函数</h2>

<p><code>Control.Category</code> モジュールには <code>(&lt;&lt;&lt;)</code> と <code>(&gt;&gt;&gt;)</code> の二つの函数が定義されています．が，これらの定義はいたって単純です<sup id="fnref7"><a href="#fn7" rel="footnote" title="Control.Category モジュール内では import qualified Prelude しています．">7</a></sup>．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">Control.Category</span></div>
<div class="highlight"><pre>
<span class="c1">-- | Right-to-left composition</span>
<span class="p">(</span><span class="o">&lt;&lt;&lt;</span><span class="p">)</span> <span class="ow">::</span> <span class="kt">Category</span> <span class="n">cat</span> <span class="ow">=&gt;</span> <span class="n">cat</span> <span class="n">b</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">cat</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">cat</span> <span class="n">a</span> <span class="n">c</span>
<span class="p">(</span><span class="o">&lt;&lt;&lt;</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="o">.</span><span class="p">)</span>

<span class="c1">-- | Left-to-right composition</span>
<span class="p">(</span><span class="o">&gt;&gt;&gt;</span><span class="p">)</span> <span class="ow">::</span> <span class="kt">Category</span> <span class="n">cat</span> <span class="ow">=&gt;</span> <span class="n">cat</span> <span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">cat</span> <span class="n">b</span> <span class="n">c</span> <span class="ow">-&gt;</span> <span class="n">cat</span> <span class="n">a</span> <span class="n">c</span>
<span class="nf">f</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">g</span> <span class="ow">=</span> <span class="n">g</span> <span class="o">.</span> <span class="n">f</span>
</pre></div>
</div>

<p>つまり <code>(&lt;&lt;&lt;)</code> は <code>Cat..</code> とまったく同じで <code>(&gt;&gt;&gt;)</code> は <code>(&lt;&lt;&lt;)</code> を逆にしただけです．</p>

<p>次のようにインポートすることで <code>Cat..</code> と書く代わりに <code>&lt;&lt;&lt;</code> を用いることができるようになります．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">import</span> <span class="nn">Control.Category</span> <span class="k">hiding</span> <span class="p">(</span><span class="nf">id</span><span class="p">,</span> <span class="p">(</span><span class="o">.</span><span class="p">))</span> <span class="c1">-- Prelude との衝突防止</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Control.Category</span> <span class="k">as</span> <span class="n">Cat</span>

<span class="kr">newtype</span> <span class="kt">NonDet</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">{</span> <span class="n">runNonDet</span> <span class="ow">::</span> <span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="p">}</span>

<span class="kr">instance</span> <span class="kt">Category</span> <span class="kt">NonDet</span> <span class="kr">where</span>
    <span class="n">id</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
    <span class="p">(</span><span class="kt">NonDet</span> <span class="n">f</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="kt">NonDet</span> <span class="n">g</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="o">$</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="n">f</span> <span class="o">.</span> <span class="n">g</span>

<span class="nf">succ_n</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="kt">Int</span><span class="p">]</span>
<span class="nf">succ_n</span> <span class="n">n</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">[</span><span class="n">x</span><span class="o">..</span><span class="n">x</span><span class="o">+</span><span class="n">n</span><span class="p">]</span>

<span class="nf">succ_n_ND</span> <span class="ow">::</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">NonDet</span> <span class="kt">Int</span> <span class="kt">Int</span>
<span class="nf">succ_n_ND</span> <span class="n">n</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">(</span><span class="n">succ_n</span> <span class="n">n</span><span class="p">)</span>
</pre></div></div>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">ghci</span></div>
<div class="highlight"><pre>
<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="p">((</span><span class="n">succ_n_ND</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&lt;&lt;&lt;</span> <span class="p">(</span><span class="n">succ_n_ND</span> <span class="mi">2</span><span class="p">))</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">]</span>

<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="p">((</span><span class="n">succ_n_ND</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">succ_n_ND</span> <span class="mi">5</span><span class="p">))</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">]</span>

<span class="nf">ghci</span><span class="o">&gt;</span> <span class="n">runNonDet</span> <span class="p">((</span><span class="n">succ_n_ND</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="n">succ_n_ND</span> <span class="mi">2</span><span class="p">))</span> <span class="mi">10</span>
<span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">]</span>
</pre></div>
</div>

<h2>
<span id="通常の函数も-category-のインスタンス" class="fragment"></span><a href="#%E9%80%9A%E5%B8%B8%E3%81%AE%E5%87%BD%E6%95%B0%E3%82%82-category-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9"><i class="fa fa-link"></i></a>通常の函数も <code>Category</code> のインスタンス</h2>

<p>通常の函数 <code>(-&gt;)</code> も <code>Category</code> のインスタンスです．インスタンス宣言は <code>Control.Category</code> 内にあるので，見てみましょう．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">Control.Category</span></div>
<div class="highlight"><pre>
<span class="kr">instance</span> <span class="kt">Category</span> <span class="p">(</span><span class="ow">-&gt;</span><span class="p">)</span> <span class="kr">where</span>
    <span class="n">id</span> <span class="ow">=</span> <span class="kt">Prelude</span><span class="o">.</span><span class="n">id</span>
    <span class="p">(</span><span class="o">.</span><span class="p">)</span> <span class="ow">=</span> <span class="p">(</span><span class="kt">Prelude</span><span class="o">..</span><span class="p">)</span>
</pre></div>
</div>

<p>通常の函数に於いては，<code>Cat.id</code> は通常の恒等函数 <code>Prelude.id</code> であり， <code>(Cat..)</code> は通常の函数合成 <code>(Prelude..)</code> ということになります．</p>

<h2>
<span id="category-則" class="fragment"></span><a href="#category-%E5%89%87"><i class="fa fa-link"></i></a><code>Category</code> 則</h2>

<p>Functor や Monad に存在する Functor 則や Monad 則のように，Category にも「則」があります．一般にあまり聞かないですが，とりあえずここでは Category 則と呼ぶことにします．</p>

<p>Category 則は以下の二つで，Category のインスタンスはこれを満たさなければなりません．</p>

<ol>
<li>恒等性 <code>Cat.id &gt;&gt;&gt; f = f &gt;&gt;&gt; Cat.id = f</code>
</li>
<li>結合性 <code>(f &gt;&gt;&gt; g) &gt;&gt;&gt; h = f &gt;&gt;&gt; (g &gt;&gt;&gt; h)</code>
</li>
</ol>

<h3>
<span id="nondet-カテゴリーが-category-則を満たすことの確認" class="fragment"></span><a href="#nondet-%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%83%BC%E3%81%8C-category-%E5%89%87%E3%82%92%E6%BA%80%E3%81%9F%E3%81%99%E3%81%93%E3%81%A8%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a><code>NonDet</code> カテゴリーが <code>Category</code> 則を満たすことの確認</h3>

<p>再度インスタンス宣言を見てみると，</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">instance</span> <span class="kt">Category</span> <span class="kt">NonDet</span> <span class="kr">where</span>
    <span class="n">id</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span>
    <span class="p">(</span><span class="kt">NonDet</span> <span class="n">f</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="kt">NonDet</span> <span class="n">g</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="o">$</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="n">f</span> <span class="o">.</span> <span class="n">g</span>
</pre></div></div>

<p>ここで，</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="p">(</span><span class="kt">NonDet</span> <span class="n">f</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="kt">NonDet</span> <span class="n">g</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="o">$</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="n">f</span> <span class="o">.</span> <span class="n">g</span>
</pre></div></div>

<p>は</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="p">(</span><span class="kt">NonDet</span> <span class="n">f</span><span class="p">)</span> <span class="o">&lt;&lt;&lt;</span> <span class="p">(</span><span class="kt">NonDet</span> <span class="n">g</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="o">$</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="n">f</span> <span class="o">.</span> <span class="n">g</span>
</pre></div></div>

<p>さらに</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="p">(</span><span class="kt">NonDet</span> <span class="n">g</span><span class="p">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="p">(</span><span class="kt">NonDet</span> <span class="n">f</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="o">$</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="n">f</span> <span class="o">.</span> <span class="n">g</span>
</pre></div></div>

<p>と同じ等式になります．右辺の <code>(.)</code> は通常の函数合成であることに注意してください．</p>

<ul>
<li>恒等性 <code>Cat.id &gt;&gt;&gt; f = f &gt;&gt;&gt; Cat.id = f</code> の確認</li>
</ul>

<p>恒等性の式 <code>Cat.id &gt;&gt;&gt; f = f &gt;&gt;&gt; Cat.id = f</code> を変形してこれが成り立っていることを確かめます．</p>

<p><code>Cat.id</code> は <code>NonDet (\x -&gt; [x])</code> と定義したので</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kt">NonDet</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">f</span> <span class="o">&gt;&gt;&gt;</span> <span class="kt">NonDet</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="ow">=</span> <span class="n">f</span>
</pre></div></div>

<p>さらに <code>f = NonDet f'</code> とおくと</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kt">NonDet</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">&gt;&gt;&gt;</span> <span class="kt">NonDet</span> <span class="n">f'</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="n">f'</span> <span class="o">&gt;&gt;&gt;</span> <span class="kt">NonDet</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="n">f'</span>
</pre></div></div>

<p>よって</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kt">NonDet</span> <span class="o">$</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="n">f'</span> <span class="o">.</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="o">$</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">.</span> <span class="n">f'</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="o">$</span> <span class="n">f'</span>
</pre></div></div>

<p>即ち，次の等式が成立していることが確認できれば OK です．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="nf">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="n">f'</span> <span class="o">.</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="ow">=</span> <span class="n">concat</span> <span class="o">.</span> <span class="n">map</span> <span class="p">(</span><span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">x</span><span class="p">])</span> <span class="o">.</span> <span class="n">f'</span> <span class="ow">=</span> <span class="n">f'</span>
</pre></div></div>

<p>ここで，<code>f': i -&gt; [o]</code> なので， <code>f' s = [t_1, t_2, ..., t_n]</code> とします．</p>

<p>すると，</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>
concat . map f' . (\x -&gt; [x]) $ s
= concat . map f' $ [s]
= concat [f' s]
= concat [[t_1, t_2, ..., t_n]]
= [t_1, t_2, ..., t_n]
= f' s
</pre></div></div>

<p>より <code>concat . map f' . (\x -&gt; [x]) = f'</code> であることがわかりました．</p>

<p>また，</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>
concat . map (\x -&gt; [x]) . f' $ s
= concat . map (\x -&gt; [x]) $ [t_1, t_2, ..., t_n]
= concat [[t_1], [t_2], ..., [t_n]]
= [t_1, t_2, ..., t_n]
= f' s
</pre></div></div>

<p>より <code>concat . map (\x -&gt; [x]) . f' = f'</code> であることもわかりました．</p>

<p>以上より NonDet カテゴリーは恒等性を満たしていることがわかりました．</p>

<ul>
<li>結合性 <code>(f &gt;&gt;&gt; g) &gt;&gt;&gt; h = f &gt;&gt;&gt; (g &gt;&gt;&gt; h)</code> の確認</li>
</ul>

<p>結合性の確認も，恒等性のときと同様に地道にやっていけば確認できるのですが，ここではモナド則を利用して結合性を確認してみたいと思います．</p>

<p>リストは <code>Monad</code> でした．リストの <code>Monad</code> インスタンスは次のようになっています．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">GHC.Base</span></div>
<div class="highlight"><pre>
<span class="kr">instance</span> <span class="kt">Monad</span> <span class="kt">[]</span> <span class="kr">where</span>
    <span class="n">return</span> <span class="n">x</span> <span class="ow">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">xs</span> <span class="o">&gt;&gt;=</span> <span class="n">f</span> <span class="ow">=</span> <span class="n">concat</span> <span class="p">(</span><span class="n">map</span> <span class="n">f</span> <span class="n">xs</span><span class="p">)</span>
    <span class="n">faile</span> <span class="kr">_</span> <span class="ow">=</span> <span class="kt">[]</span>
</pre></div>
</div>

<p>また，<code>Control.Monad</code> モジュールには次のように <code>(&gt;=&gt;)</code>, <code>(&lt;=&lt;)</code> という函数が定義されています．</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">Control.Monad</span></div>
<div class="highlight"><pre>
<span class="c1">-- | Left-to-right Kleisli composition of monads.</span>
<span class="p">(</span><span class="o">&gt;=&gt;</span><span class="p">)</span>       <span class="ow">::</span> <span class="kt">Monad</span> <span class="n">m</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">c</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">c</span><span class="p">)</span>
<span class="nf">f</span> <span class="o">&gt;=&gt;</span> <span class="n">g</span>     <span class="ow">=</span> <span class="nf">\</span><span class="n">x</span> <span class="ow">-&gt;</span> <span class="n">f</span> <span class="n">x</span> <span class="o">&gt;&gt;=</span> <span class="n">g</span>

<span class="c1">-- | Right-to-left Kleisli composition of monads. @('&gt;=&gt;')@, with the arguments flipped</span>
<span class="p">(</span><span class="o">&lt;=&lt;</span><span class="p">)</span>       <span class="ow">::</span> <span class="kt">Monad</span> <span class="n">m</span> <span class="ow">=&gt;</span> <span class="p">(</span><span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">c</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">b</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">c</span><span class="p">)</span>
<span class="p">(</span><span class="o">&lt;=&lt;</span><span class="p">)</span>       <span class="ow">=</span> <span class="n">flip</span> <span class="p">(</span><span class="o">&gt;=&gt;</span><span class="p">)</span>
</pre></div>
</div>

<p>これらを利用すると，</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>
concat . map f . g 
= \x -&gt; concat (map f (g x))
= \x -&gt; (g x) &gt;&gt;= f
= g &gt;=&gt; f
= f &lt;=&lt; g
</pre></div></div>

<p>と書くことができます．よって <code>NonDet</code> の <code>Category</code> インスタンスは次のように書けます．</p>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">import</span> <span class="nn">Control.Category</span> <span class="k">hiding</span> <span class="p">(</span><span class="nf">id</span><span class="p">,</span> <span class="p">(</span><span class="o">.</span><span class="p">))</span>
<span class="kr">import</span> <span class="k">qualified</span> <span class="nn">Control.Category</span> <span class="k">as</span> <span class="n">Cat</span>
<span class="kr">import</span> <span class="nn">Control.Monad</span>

<span class="kr">newtype</span> <span class="kt">NonDet</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="p">{</span> <span class="n">runNonDet</span> <span class="ow">::</span> <span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">[</span><span class="n">o</span><span class="p">]</span> <span class="p">}</span>

<span class="kr">instance</span> <span class="kt">Category</span> <span class="kt">NonDet</span> <span class="kr">where</span>
    <span class="n">id</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="n">return</span>
    <span class="p">(</span><span class="kt">NonDet</span> <span class="n">f</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="kt">NonDet</span> <span class="n">g</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">NonDet</span> <span class="o">$</span> <span class="n">f</span> <span class="o">&lt;=&lt;</span> <span class="n">g</span>
</pre></div></div>

<p><code>id</code> (<code>Cat.id</code>) のほうもリストモナドの <code>return = \x -&gt; [x]</code> に書き直してみました。</p>

<p>さて，モナド則の一つに結合法則 <code>f &lt;=&lt; (g &lt;=&lt; h) = (f &lt;=&lt; g) &lt;=&lt; h</code> というものがあります．リストモナドももちろんこの法則を満たしています．</p>

<p>これを利用して <code>NonDet</code> カテゴリーの結合性を証明します．</p>

<p><code>f = NonDet f'</code>, <code>g = NonDet g'</code>, <code>h = NonDet h'</code> とおくと，</p>

<div class="code-frame" data-lang="text"><div class="highlight"><pre>
(f &gt;&gt;&gt; g) &gt;&gt;&gt; h
= (NonDet f' &gt;&gt;&gt; NonDet g') &gt;&gt;&gt; NonDet h'
= NonDet h' &lt;&lt;&lt; (NonDet g' &lt;&lt;&lt; NonDet f')
= NonDet h' &lt;&lt;&lt; (NonDet $ g' &lt;=&lt; f')
= NonDet $ h' &lt;=&lt; (g' &lt;=&lt; f')
= NonDet $ (h' &lt;=&lt; g') &lt;=&lt; f'
= (NonDet $ h' &lt;=&lt; g') &lt;&lt;&lt; NonDet f'
= (NonDet h' &lt;&lt;&lt; NonDet g') &lt;&lt;&lt; NonDet f'
= NonDet f' &gt;&gt;&gt; (NonDet g' &gt;&gt;&gt; NonDet h')
= f &gt;&gt;&gt; (g &gt;&gt;&gt; h)
</pre></div></div>

<p>以上より <code>NonDet</code> カテゴリーは結合性を満たしていることがわかりました．</p>

<h3>
<span id="--カテゴリーが-category-則を満たすことの確認" class="fragment"></span><a href="#--%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%83%BC%E3%81%8C-category-%E5%89%87%E3%82%92%E6%BA%80%E3%81%9F%E3%81%99%E3%81%93%E3%81%A8%E3%81%AE%E7%A2%BA%E8%AA%8D"><i class="fa fa-link"></i></a><code>(-&gt;)</code> カテゴリーが <code>Category</code> 則を満たすことの確認</h3>

<p>通常の函数 <code>(-&gt;)</code> については，恒等性 <code>Cat.id &gt;&gt;&gt; f = f &gt;&gt;&gt; Cat.id = f</code> は通常の函数の恒等性 <code>f . id = id . f = f</code>, 結合性 <code>(f &gt;&gt;&gt; g) &gt;&gt;&gt; h = f &gt;&gt;&gt; (g &gt;&gt;&gt; h)</code> は通常の函数合成の結合性 <code>h . (g . f) = (h . g) . f</code> となり，<code>Category</code> 則を満たしていることがわかります．</p>

<h2>
<span id="もっと-category" class="fragment"></span><a href="#%E3%82%82%E3%81%A3%E3%81%A8-category"><i class="fa fa-link"></i></a>もっと <code>Category</code>
</h2>

<p>通常の函数 <code>(-&gt;)</code> と非決定性計算 <code>NonDet</code> が <code>Category</code> のインスタンスであるということがわかりました．<br>
<code>Category</code> のインスタンスになれるものは他にもたくさん考えることができますが，どれにも共通しているのは入力と出力がある「計算」であるということです．</p>

<p>詳しくは参考文献「関数プログラミングの楽しみ」を読むかググるか強い人に聞くといいと思います．</p>

<ul>
<li>状態変換子</li>
</ul>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">newtype</span> <span class="kt">StateA</span> <span class="n">s</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">StateA</span> <span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>
</pre></div></div>

<ul>
<li>写像変換子</li>
</ul>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">newtype</span> <span class="kt">MapTrans</span> <span class="n">s</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">MapTrans</span> <span class="p">((</span><span class="n">s</span> <span class="ow">-&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">s</span> <span class="ow">-&gt;</span> <span class="n">o</span><span class="p">))</span>
</pre></div></div>

<ul>
<li>単純オートマトン</li>
</ul>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">newtype</span> <span class="kt">Auto</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">Auto</span> <span class="p">(</span><span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="kt">Auto</span> <span class="n">i</span> <span class="n">o</span><span class="p">))</span>
</pre></div></div>

<p>以下のページで詳しく解説されています<br>
<a href="http://blog.jle.im/entry/intro-to-machines-arrows-part-1-stream-and" title="Intro to Machines &amp; Arrows (Part 1: Stream and Auto) · in Code" rel="nofollow noopener" target="_blank">Intro to Machines &amp; Arrows (Part 1: Stream and Auto) · in Code</a><br>
<a href="http://blog.jle.im/entry/auto-as-category-applicative-arrow-intro-to-machines" title="Auto as Category, Applicative &amp; Arrow (Intro to Machines/Arrows Part 2) · in Code" rel="nofollow noopener" target="_blank">Auto as Category, Applicative &amp; Arrow (Intro to Machines/Arrows Part 2) · in Code</a></p>

<ul>
<li>Reader</li>
</ul>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">newtype</span> <span class="kt">ReaderA</span> <span class="n">s</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">ReaderA</span> <span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">o</span><span class="p">)</span>
</pre></div></div>

<ul>
<li>Writer</li>
</ul>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">newtype</span> <span class="kt">WriterA</span> <span class="n">w</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">WriterA</span> <span class="p">(</span><span class="n">i</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">o</span><span class="p">))</span>
</pre></div></div>

<ul>
<li>Kleisli</li>
</ul>

<div class="code-frame" data-lang="hs"><div class="highlight"><pre>
<span class="kr">newtype</span> <span class="kt">Kleisli</span> <span class="n">m</span> <span class="n">i</span> <span class="n">o</span> <span class="ow">=</span> <span class="kt">Kleisli</span> <span class="p">(</span><span class="n">i</span> <span class="ow">-&gt;</span> <span class="n">m</span> <span class="n">o</span><span class="p">)</span>
</pre></div></div>

<p>今回作った <code>NonDet</code> カテゴリーは <code>i -&gt; [o]</code> という計算をもっていましたが，リスト以外でも任意のモナドを返す計算 <code>i -&gt; m o</code> はカテゴリーにすることができます．<code>Kleisli</code> カテゴリーはそのことを表しています．<br>
実際，Kleisli カテゴリーのインスタンス宣言は以下のようになっています (<code>Control.Arrow</code> モジュール<sup id="fnref8"><a href="#fn8" rel="footnote" title="Control.Arrow モジュールは base パッケージに含まれています．">8</a></sup>)</p>

<div class="code-frame" data-lang="hs">
<div class="code-lang"><span class="bold">Control.Arrow</span></div>
<div class="highlight"><pre>
<span class="kr">instance</span> <span class="kt">Monad</span> <span class="n">m</span> <span class="ow">=&gt;</span> <span class="kt">Category</span> <span class="p">(</span><span class="kt">Kleisli</span> <span class="n">m</span><span class="p">)</span> <span class="kr">where</span>
    <span class="n">id</span> <span class="ow">=</span> <span class="kt">Kleisli</span> <span class="n">return</span>
    <span class="p">(</span><span class="kt">Kleisli</span> <span class="n">f</span><span class="p">)</span> <span class="o">.</span> <span class="p">(</span><span class="kt">Kleisli</span> <span class="n">g</span><span class="p">)</span> <span class="ow">=</span> <span class="kt">Kleisli</span> <span class="p">(</span><span class="nf">\</span><span class="n">b</span> <span class="ow">-&gt;</span> <span class="n">g</span> <span class="n">b</span> <span class="o">&gt;&gt;=</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>

<p><code>(\b -&gt; g b &gt;&gt;= f)</code> は <code>f &lt;=&lt; g</code> と同値です．</p>

<h1>
<span id="arrow" class="fragment"></span><a href="#arrow"><i class="fa fa-link"></i></a><code>Arrow</code>
</h1>

<p><code>Control.Arrow</code> モジュールには <code>Category</code> 型クラスを拡張した (?) <code>Arrow</code> 型クラスが定義されています．<br>
<code>Arrow</code> にも触れようかと思いましたが力尽きたのでとりあえずここまでにします．</p>

<h1>
<span id="参考文献" class="fragment"></span><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE"><i class="fa fa-link"></i></a>参考文献</h1>

<p>Jeremy Gibbons and Oege de Moor 編，山下伸夫訳 「関数プログラミングの楽しみ」 (オーム社) 2010, 215-238</p>

<p>Miran Lipovača 著，田中英行・村主崇行訳 「すごい Haskell たのしく学ぼう！」 (オーム社) 2012</p>

<h1>
<span id="あとがき" class="fragment"></span><a href="#%E3%81%82%E3%81%A8%E3%81%8C%E3%81%8D"><i class="fa fa-link"></i></a>あとがき</h1>

<p>最後のほうが投げやりになってしまったのと，自分もまだ勉強中のため間違い等等あると思います．指摘などいただけると嬉しいです．<br>
Arrow のすごさに感動している年末です．</p>

<h1>
<span id="注釈" class="fragment"></span><a href="#%E6%B3%A8%E9%87%88"><i class="fa fa-link"></i></a>注釈</h1>

<div class="footnotes">
<hr>
<ol>

<li id="fn1">
<p>let 函数 = 関数 <a href="#fnref1">↩</a></p>
</li>

<li id="fn2">
<p>すごい H 本の <code>Prob</code> モナドを使うと，各状態の確率も表せそうです． <a href="#fnref2">↩</a></p>
</li>

<li id="fn3">
<p>input, output <a href="#fnref3">↩</a></p>
</li>

<li id="fn4">
<p>nondeterministic (非決定性の) <a href="#fnref4">↩</a></p>
</li>

<li id="fn5">
<p><code>Control.Category</code> モジュールは base パッケージに含まれています． <a href="#fnref5">↩</a></p>
</li>

<li id="fn6">
<p><code>a -&gt; b</code> は <code>(-&gt;) a b</code> と書くことができます． <a href="#fnref6">↩</a></p>
</li>

<li id="fn7">
<p><code>Control.Category</code> モジュール内では <code>import qualified Prelude</code> しています． <a href="#fnref7">↩</a></p>
</li>

<li id="fn8">
<p><code>Control.Arrow</code> モジュールは base パッケージに含まれています． <a href="#fnref8">↩</a></p>
</li>

</ol>
</div>
<div class="hidden"><form class="js-task-list-update" action="/CyLomw/items/a618b7c7326d9abede63" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="_method" value="patch" /><input type="hidden" name="authenticity_token" value="P0cFtrX8+TY7TkJOan/Vm1fpKnn0Ziq6wdAgcMcO949RxZ7uLtLAfcSd91IaimvCN64OymOicE39DimLJgD5SQ==" /><input type="hidden" name="updated_at_confirmation_in_unixtime" id="updated_at_confirmation_in_unixtime" value="1422161099" class="js-task-list-updated-at" /><textarea name="raw_body" id="raw_body" class="js-task-list-field">
`Control.Category` モジュールを用いて多価函数[^1] の合成について考えてみます．
余力があればより有用な `Control.Arrow` モジュールについて見ていきたいです．
GHC, GHCi を使う環境を想定しています．


次の記事 → [綱渡りと Category (と，Kleisli)](http://qiita.com/CyLomw/items/ff1e5d1600291c952c5e &quot;綱渡りと Category (と，Kleisli)&quot;)

# 多価函数

## 多価函数とは

与えられた数 x に対して，その平方根を返す函数について考えてみます．

例えば 4 の平方根は 2 と -2,
9 の平方根は 3 と -3,
17 の平方根は √17 と -√17
のように平方根は (0 等を除いて) 二つ存在することがわかります．

このように入力に対して複数の出力を持つ &quot;函数&quot; を多価函数と呼びます．
数学においては冪根，複素数の対数函数，周期函数の逆函数などさまざまな多価函数が存在します．

## 多価函数は函数ではない？

函数は一般的に &quot;1 つの入力に対して 1 つの出力を返す&quot; ものであり，複数の出力を返す多価函数などは函数ではなく「関係」と呼ばれるようです．


Haskell においても，すべての函数は 1 つの値を返すようになっています．
しかし複数の値をリストにまとめて &quot;1 つのリスト&quot; を返すことで多価函数っぽいものを実装することができます．

例えば平方根を返す函数は次のように書けます

```hs
sqrts :: Floating t =&gt; t -&gt; [t]
sqrts x = [sqrt x, - sqrt x]
```

```hs:ghci
ghci&gt; sqrts 4
[2.0,-2.0]

ghci&gt; sqrts 2
[1.4142135623730951,-1.4142135623730951]
```

## 非決定性計算
以降，上の `sqrts` のようにリストを返す函数のことを「非決定性計算」と呼ぶことにします．
これは値 (出力) が 1 つに定まらない計算であるという意味です．多価函数は函数ではないとのことなので，「函数」ではなく「計算」という単語を用いました．

非決定性は，複数の値が重なり合っているなどと言われることもあります．どこかで聞いたことがありますね．Haskell では箱の中の猫は次のように表現することができます[^2]．

```hs
data DA = Dead | Alive
  deriving (Show)

schroedingerscat :: t -&gt; [DA]
schroedingerscat _ = [Dead, Alive]
```

`schroedingerscat` は引数にかかわらずリスト `[Dead, Alive]` を返す函数なので，次のように `Prelude` の `const` 函数を使って書くこともできます．

```hs
data DA = Dead | Alive
  deriving (Show)

schroedingerscat :: t -&gt; [DA]
schroedingerscat = const [Dead, Alive]
```

# `NonDet i o` 型

## `type`
非決定性計算は `i -&gt; [o]` [^3]のような型を持つ函数で表されると考えられます．よって，次のように非決定性計算を表す型を定義することができます．

```hs
type NonDet i o = i -&gt; [o]
```

とりあえず `type` によって型シノニムを作成してみました[^4]．これにより `sqrts` や `schroedingerscat` は次のように書くことができます．

```hs
sqrts :: Floating t =&gt; NonDet t t
sqrts x = [sqrt x, - sqrt x]

data DA = Dead | Alive
  deriving (Show)

schroedingerscat :: NonDet t DA
schroedingerscat = const [Dead, Alive]
```

## `data`
Haskell の `type` は単に型に別名 (シノニム) を与えるだけであることを思い出してください．Haskell では型シノニムをある型クラスのインスタンスにする，というようなことはできません．
そこで, `type` ではなく `data` を用いて新しい `NonDet i o` 型をつくることにしましょう．

```hs
data NonDet i o = NonDet (i -&gt; [o])
```

`type` の時と異なり，もはや `i -&gt; [o]` 型と `NonDet i o` 型は異なる型です．
`sqrts` 函数の型は `Floating t =&gt; t -&gt; [t]` であるため，そのままでは `NonDet t t` のような型にはなりません．そこで，`NonDet` 値コンストラクタを用いて `sqrts` 函数から `NonDet t t` 型を生み出します．

```hs
sqrts :: Floating t =&gt; t -&gt; [t]
sqrts x = [sqrt x, - sqrt x]

sqrtsND :: Floating t =&gt; NonDet t t
sqrtsND = NonDet sqrts
```

こうしてできた `sqrtsND` 型は `NonDet t t` 型にはなりましたが，当然このまま `sqrtsND 4` のようには使えません．そこで `runNonDet` 函数を次のように定義します．

```hs
runNonDet :: NonDet i o -&gt; (i -&gt; [o])
runNonDet (NonDet f) = f
```

`runNonDet` 函数は `NonDet` をほどく役割を果たします．これにより，次のように `sqrtsND` 函数を実行できます．

```hs:ghci
ghci&gt; runNonDet sqrtsND 4
[2.0,-2.0]

ghci&gt; runNonDet sqrtsND 2
[1.4142135623730951,-1.4142135623730951]
```

実は，`runNonDet` 函数は別途実装しなくても `NonDet i o` 型を次のようにレコード構文で定義することによって得ることができます．

```hs
data NonDet i o = NonDet { runNonDet :: i -&gt; [o] }
```

## `newtype`
いままで `data` を用いてきましたが，`newtype` を用いるほうが高速なので以降は `newtype` を用いることにします．

```hs
sqrts :: Floating t =&gt; t -&gt; [t]
sqrts x = [sqrt x, - sqrt x]

sqrtsND :: Floating t =&gt; NonDet t t
sqrtsND = NonDet sqrts


data DA = Dead | Alive
  deriving (Show)

schroedingerscat :: t -&gt; [DA]
schroedingerscat = const [Dead, Alive]

schroedingerscatND :: NonDet t DA
schroedingerscatND = NonDet schroedingerscat


newtype NonDet i o = NonDet { runNonDet :: i -&gt; [o] }
```

```hs:ghci
ghci&gt; runNonDet sqrtsND 4
[2.0,-2.0]

ghci&gt; runNonDet sqrtsND 2
[1.4142135623730951,-1.4142135623730951]

ghci&gt; runNonDet schroedingerscatND 1
[Dead,Alive]
```

# 計算の合成と `Category`
## 非決定性計算の合成
ここで新しく次のような函数を考えます．

```hs
succ_n :: Int -&gt; Int -&gt; [Int]
succ_n n x = [x..x+n]
```

この函数は x から x + n までのリストを返す函数です．

```hs:ghci
ghci&gt; succ_n 2 10
[10,11,12]

ghci&gt; succ_n 10 2
[2,3,4,5,6,7,8,9,10,11,12]
```

この `succ_n` 函数の合成について考えてみます．

たとえば `(succ_n 2)` と `(succ_n 5)` を合成することを考えてみます．
`(succ_n 2) :: Int -&gt; [Int]`, `(succ_n 5) :: Int -&gt; [Int]` なのでそのままではこの二つは当然函数合成できません．

しかし，もし合成するとしたら例えば次のような感じになるでしょうか．
![test.png](https://qiita-image-store.s3.amazonaws.com/0/64300/003e8537-5f5d-c9d6-188d-f73dd7bc2201.png)

このような合成は `map` と `concat` を用いれば行うことができます．

```hs:ghci
ghci&gt; concat (map (succ_n 5) ((succ_n 2) 10))
[10,11,12,13,14,15,11,12,13,14,15,16,12,13,14,15,16,17]
```

括弧が多いですが函数合成を用いると次のように書き直せます．

```hs:ghci
ghci&gt; concat . map (succ_n 5) . (succ_n 2) $ 10
[10,11,12,13,14,15,11,12,13,14,15,16,12,13,14,15,16,17]
```

しかしいちいち `map` と `concat` を記述しなければならないのは，特に合成が長くなってくると面倒です．

```hs:ghci
ghci&gt; concat . map (succ_n 4) . concat . map (succ_n 3) . concat . map (succ_n 2) . (succ_n 1) $ 10
[10,11,12,13,14,11,12,13,14,15,12,13,14,15,16,13,14,15,16,17,11,12,13,14,15,12,13,14,15,16,13,14,15,16,17,14,15,16,17,18,12,13,14,15,16,13,14,15,16,17,14,15,16,17,18,15,16,17,18,19,11,12,13,14,15,12,13,14,15,16,13,14,15,16,17,14,15,16,17,18,12,13,14,15,16,13,14,15,16,17,14,15,16,17,18,15,16,17,18,19,13,14,15,16,17,14,15,16,17,18,15,16,17,18,19,16,17,18,19,20]
```

## `Control.Category`
ここで満を持して登場するのが `Control.Category` モジュール[^5]です．
`Control.Category` モジュール内には `Category` (カテゴリー, 圏) 型クラスが定義されています．まずは定義を見てみます．


```hs:Control.Category
class Category cat where
    -- | the identity morphism
    id :: cat a a

    -- | morphism composition
    (.) :: cat b c -&gt; cat a b -&gt; cat a c
```

見ての通り， `Category` 型クラスの定義は非常に簡単で，`id` 函数と `(.)` 函数を持つだけです．

`id` も `(.)` も見覚えのある函数です．どちらも `Prelude` に同名の函数が定義されていて， `id` は引数をそのまま返す恒等函数，`(.)` は函数合成を行う函数でした．

```hs:ghci
Prelude&gt; :t id
id :: a -&gt; a
Prelude&gt; id 10
10
Prelude&gt; :t (.)
(.) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
Prelude&gt; (\x -&gt; 2 * x) . (\x -&gt; 2 + x) $ 10
24
```

まず，このままだと `Prelude` の `id`, `(.)` と `Control.Category` の `id`, `(.)` が名前の衝突を起こしてしまうので，`Control.Category` モジュールをインポートするときは下のように「修飾付きインポート」するようにします．

```hs
import qualified Control.Category as Cat
```

以降，`Control.Category.id` を `Cat.id`, `(Control.Category..)` を `(Cat..)` と書くことにします．
`.` が二つ見えるのは気のせいではないです．`Cat.` 部分が修飾で `.` が合成を行う函数 `(.)` です．

さて，`Cat.id` と `(Cat..)` は一体どういう働きをする函数なのでしょう．
`Prelude` にある函数と同名なのだから，きっと同じような働きをするのだろうと考えられます．

```hs
Prelude.id :: a -&gt; a
Cat.id :: Cat.Category cat =&gt; cat a a

(Prelude..) :: (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
(Cat..) :: Cat.Category cat =&gt; cat b c -&gt; cat a b -&gt; cat a c
```

それぞれを見比べてみると，あることがわかります．
`Cat.id` と `(Cat..)` において `cat` を `(-&gt;)` に置き換えるとそれぞれ `Prelude.id` と `(Prelude..)` に一致します[^6]．

つまり，型クラス `Category` の型変数 `cat` には，`(-&gt;)` のようなものが入るということです．

実は `(-&gt;)` は二つの型引数をとる型コンストラクタなのですが，少々わかりにくいですね．そういえば二つの型引数をとる型コンストラクタといえば，先ほど定義した `NonDet` もそうでした．

```hs
newtype NonDet i o = NonDet { runNonDet :: i -&gt; [o] }
```

ということで試しに `cat` を `NonDet` で置き換えてみると，次のようになります

```hs
Cat.id :: NonDet a a
(Cat..) :: NonDet b c -&gt; NonDet a b -&gt; NonDet a c
```

なんだかこれ，「非決定性計算における恒等計算」 と「非決定性計算の合成を行う函数」 に見えてきました．

実は，`Category` 型クラスは「恒等計算 (引数をそのまま返すような計算) `Cat.id`」と「計算の合成を行う函数 `(Cat..)`」を提供してくれる型クラスだったのです．

## `NonDet` を `Category` のインスタンスにする

とりあえず，`Category` は型クラスであり，`NonDet` は `Category` のインスタンスになれそうであるというので，実際にインスタンスにしてみることにします．

まず `Cat.id :: NonDet a a` は引数をそのまま返すようなものということですが，リストを返さなければならない都合上 `NonDet (\x -&gt; x)` とはできないので `NonDet (\x -&gt; [x])` とします．

`(Cat..) :: NonDet b c -&gt; NonDet a b -&gt; NonDet a c` の方は，先ほど考えた `map` と `concat` を使った合成 `concat . map f . g` を使って，それを `NonDet` でくるんでみます．

よって次のようなインスタンス宣言が書けると思います．

```hs
import qualified Control.Category as Cat

newtype NonDet i o = NonDet { runNonDet :: i -&gt; [o] }

instance Cat.Category NonDet where
    id = NonDet (\x -&gt; [x])
    (NonDet f) . (NonDet g) = NonDet $ concat . map f . g
```

修飾付きインポートをしているので，`instance Cat.Category` の部分の `Category` にも修飾が必要なことを忘れないでください．
逆に `instance` 宣言中の `id`, `(.)` には修飾は必要ないことにも注意してください．
(右辺の `(.)` は通常の函数合成であることにも注意してください．)

さて，これで無事 `NonDet` を `Category` のインスタンスにすることができましたが，期待通り動くでしょうか．

まず `succ_n` の `NonDet` 版を作っていなかったので作成します．

```hs
import qualified Control.Category as Cat

newtype NonDet i o = NonDet { runNonDet :: i -&gt; [o] }

instance Cat.Category NonDet where
    id = NonDet (\x -&gt; [x])
    (NonDet f) . (NonDet g) = NonDet $ concat . map f . g

succ_n :: Int -&gt; Int -&gt; [Int]
succ_n n x = [x..x+n]

succ_n_ND :: Int -&gt; NonDet Int Int
succ_n_ND n = NonDet (succ_n n)
```

例のように `runNonDet` を使って実行します．

```hs:ghci
ghci&gt; runNonDet (succ_n_ND 2) 10
[10,11,12]

ghci&gt; runNonDet (succ_n_ND 10) 2
[2,3,4,5,6,7,8,9,10,11,12]
```

では `(Cat..)` を使って `(succ_n_ND 2)` と `(succ_n_ND 5)` の合成を行ってみます．

```hs:ghci
ghci&gt; runNonDet ((succ_n_ND 5) Cat.. (succ_n_ND 2)) 10
[10,11,12,13,14,15,11,12,13,14,15,16,12,13,14,15,16,17]
```

`concat . map (succ_n 5) . (succ_n 2) $ 10` とちゃんと結果が一致しています！

合成が長くなっても同じようにできます．

```hs:ghci
ghci&gt; runNonDet ((succ_n_ND 4) Cat.. (succ_n_ND 3) Cat.. (succ_n_ND 2) Cat.. (succ_n_ND 1)) 10
[10,11,12,13,14,11,12,13,14,15,12,13,14,15,16,13,14,15,16,17,11,12,13,14,15,12,13,14,15,16,13,14,15,16,17,14,15,16,17,18,12,13,14,15,16,13,14,15,16,17,14,15,16,17,18,15,16,17,18,19,11,12,13,14,15,12,13,14,15,16,13,14,15,16,17,14,15,16,17,18,12,13,14,15,16,13,14,15,16,17,14,15,16,17,18,15,16,17,18,19,13,14,15,16,17,14,15,16,17,18,15,16,17,18,19,16,17,18,19,20]
```

いい感じです．

 `Cat.id` も使ってみましょう．

```hs:ghci
ghci&gt; runNonDet (Cat.id) 10
[10]
ghci&gt; runNonDet (Cat.id Cat.. Cat.id) 10
[10]
ghci&gt; runNonDet ((succ_n_ND 5) Cat.. Cat.id Cat.. (succ_n_ND 2) Cat.. Cat.id) 10
[10,11,12,13,14,15,11,12,13,14,15,16,12,13,14,15,16,17]
```

`Cat.id` はまさに通常の函数合成における `id` のように，合成しても影響を与えません．

## `Control.Category` モジュールの他の函数

`Control.Category` モジュールには `(&lt;&lt;&lt;)` と `(&gt;&gt;&gt;)` の二つの函数が定義されています．が，これらの定義はいたって単純です[^7]．

```hs:Control.Category
-- | Right-to-left composition
(&lt;&lt;&lt;) :: Category cat =&gt; cat b c -&gt; cat a b -&gt; cat a c
(&lt;&lt;&lt;) = (.)

-- | Left-to-right composition
(&gt;&gt;&gt;) :: Category cat =&gt; cat a b -&gt; cat b c -&gt; cat a c
f &gt;&gt;&gt; g = g . f
```

つまり `(&lt;&lt;&lt;)` は `Cat..` とまったく同じで `(&gt;&gt;&gt;)` は `(&lt;&lt;&lt;)` を逆にしただけです．

次のようにインポートすることで `Cat..` と書く代わりに `&lt;&lt;&lt;` を用いることができるようになります．

```hs
import Control.Category hiding (id, (.)) -- Prelude との衝突防止
import qualified Control.Category as Cat

newtype NonDet i o = NonDet { runNonDet :: i -&gt; [o] }

instance Category NonDet where
    id = NonDet (\x -&gt; [x])
    (NonDet f) . (NonDet g) = NonDet $ concat . map f . g

succ_n :: Int -&gt; Int -&gt; [Int]
succ_n n x = [x..x+n]

succ_n_ND :: Int -&gt; NonDet Int Int
succ_n_ND n = NonDet (succ_n n)
```

```hs:ghci
ghci&gt; runNonDet ((succ_n_ND 5) &lt;&lt;&lt; (succ_n_ND 2)) 10
[10,11,12,13,14,15,11,12,13,14,15,16,12,13,14,15,16,17]

ghci&gt; runNonDet ((succ_n_ND 2) &gt;&gt;&gt; (succ_n_ND 5)) 10
[10,11,12,13,14,15,11,12,13,14,15,16,12,13,14,15,16,17]

ghci&gt; runNonDet ((succ_n_ND 5) &gt;&gt;&gt; (succ_n_ND 2)) 10
[10,11,12,11,12,13,12,13,14,13,14,15,14,15,16,15,16,17]
```


## 通常の函数も `Category` のインスタンス

通常の函数 `(-&gt;)` も `Category` のインスタンスです．インスタンス宣言は `Control.Category` 内にあるので，見てみましょう．

```hs:Control.Category
instance Category (-&gt;) where
    id = Prelude.id
    (.) = (Prelude..)
```

通常の函数に於いては，`Cat.id` は通常の恒等函数 `Prelude.id` であり， `(Cat..)` は通常の函数合成 `(Prelude..)` ということになります．

## `Category` 則

Functor や Monad に存在する Functor 則や Monad 則のように，Category にも「則」があります．一般にあまり聞かないですが，とりあえずここでは Category 則と呼ぶことにします．

Category 則は以下の二つで，Category のインスタンスはこれを満たさなければなりません．

1. 恒等性 `Cat.id &gt;&gt;&gt; f = f &gt;&gt;&gt; Cat.id = f`
1. 結合性 `(f &gt;&gt;&gt; g) &gt;&gt;&gt; h = f &gt;&gt;&gt; (g &gt;&gt;&gt; h)`

### `NonDet` カテゴリーが `Category` 則を満たすことの確認

再度インスタンス宣言を見てみると，

```hs
instance Category NonDet where
    id = NonDet (\x -&gt; [x])
    (NonDet f) . (NonDet g) = NonDet $ concat . map f . g
```

ここで，

```hs
(NonDet f) . (NonDet g) = NonDet $ concat . map f . g
```

は

```hs
(NonDet f) &lt;&lt;&lt; (NonDet g) = NonDet $ concat . map f . g
```

さらに

```hs
(NonDet g) &gt;&gt;&gt; (NonDet f) = NonDet $ concat . map f . g
```

と同じ等式になります．右辺の `(.)` は通常の函数合成であることに注意してください．

- 恒等性 `Cat.id &gt;&gt;&gt; f = f &gt;&gt;&gt; Cat.id = f` の確認

恒等性の式 `Cat.id &gt;&gt;&gt; f = f &gt;&gt;&gt; Cat.id = f` を変形してこれが成り立っていることを確かめます．

`Cat.id` は `NonDet (\x -&gt; [x])` と定義したので

```hs
NonDet (\x -&gt; [x]) &gt;&gt;&gt; f = f &gt;&gt;&gt; NonDet (\x -&gt; [x]) = f
```

さらに `f = NonDet f&#39;` とおくと

```hs
NonDet (\x -&gt; [x]) &gt;&gt;&gt; NonDet f&#39; = NonDet f&#39; &gt;&gt;&gt; NonDet (\x -&gt; [x]) = NonDet f&#39;
```

よって

```hs
NonDet $ concat . map f&#39; . (\x -&gt; [x]) = NonDet $ concat . map (\x -&gt; [x]) . f&#39; = NonDet $ f&#39;
```

即ち，次の等式が成立していることが確認できれば OK です．


```hs
concat . map f&#39; . (\x -&gt; [x]) = concat . map (\x -&gt; [x]) . f&#39; = f&#39;
```


ここで，`f&#39;: i -&gt; [o]` なので， `f&#39; s = [t_1, t_2, ..., t_n]` とします．

すると，

```
concat . map f&#39; . (\x -&gt; [x]) $ s
= concat . map f&#39; $ [s]
= concat [f&#39; s]
= concat [[t_1, t_2, ..., t_n]]
= [t_1, t_2, ..., t_n]
= f&#39; s
```


より `concat . map f&#39; . (\x -&gt; [x]) = f&#39;` であることがわかりました．

また，

```
concat . map (\x -&gt; [x]) . f&#39; $ s
= concat . map (\x -&gt; [x]) $ [t_1, t_2, ..., t_n]
= concat [[t_1], [t_2], ..., [t_n]]
= [t_1, t_2, ..., t_n]
= f&#39; s
```

より `concat . map (\x -&gt; [x]) . f&#39; = f&#39;` であることもわかりました．

以上より NonDet カテゴリーは恒等性を満たしていることがわかりました．

- 結合性 `(f &gt;&gt;&gt; g) &gt;&gt;&gt; h = f &gt;&gt;&gt; (g &gt;&gt;&gt; h)` の確認

結合性の確認も，恒等性のときと同様に地道にやっていけば確認できるのですが，ここではモナド則を利用して結合性を確認してみたいと思います．

リストは `Monad` でした．リストの `Monad` インスタンスは次のようになっています．

```hs:GHC.Base
instance Monad [] where
    return x = [x]
    xs &gt;&gt;= f = concat (map f xs)
    faile _ = []
```

また，`Control.Monad` モジュールには次のように `(&gt;=&gt;)`, `(&lt;=&lt;)` という函数が定義されています．

```hs:Control.Monad
-- | Left-to-right Kleisli composition of monads.
(&gt;=&gt;)       :: Monad m =&gt; (a -&gt; m b) -&gt; (b -&gt; m c) -&gt; (a -&gt; m c)
f &gt;=&gt; g     = \x -&gt; f x &gt;&gt;= g

-- | Right-to-left Kleisli composition of monads. @(&#39;&gt;=&gt;&#39;)@, with the arguments flipped
(&lt;=&lt;)       :: Monad m =&gt; (b -&gt; m c) -&gt; (a -&gt; m b) -&gt; (a -&gt; m c)
(&lt;=&lt;)       = flip (&gt;=&gt;)
```

これらを利用すると，

```
concat . map f . g 
= \x -&gt; concat (map f (g x))
= \x -&gt; (g x) &gt;&gt;= f
= g &gt;=&gt; f
= f &lt;=&lt; g
```

と書くことができます．よって `NonDet` の `Category` インスタンスは次のように書けます．

```hs
import Control.Category hiding (id, (.))
import qualified Control.Category as Cat
import Control.Monad

newtype NonDet i o = NonDet { runNonDet :: i -&gt; [o] }

instance Category NonDet where
    id = NonDet return
    (NonDet f) . (NonDet g) = NonDet $ f &lt;=&lt; g
```

`id` (`Cat.id`) のほうもリストモナドの `return = \x -&gt; [x]` に書き直してみました。

さて，モナド則の一つに結合法則 `f &lt;=&lt; (g &lt;=&lt; h) = (f &lt;=&lt; g) &lt;=&lt; h` というものがあります．リストモナドももちろんこの法則を満たしています．


これを利用して `NonDet` カテゴリーの結合性を証明します．

`f = NonDet f&#39;`, `g = NonDet g&#39;`, `h = NonDet h&#39;` とおくと，

```
(f &gt;&gt;&gt; g) &gt;&gt;&gt; h
= (NonDet f&#39; &gt;&gt;&gt; NonDet g&#39;) &gt;&gt;&gt; NonDet h&#39;
= NonDet h&#39; &lt;&lt;&lt; (NonDet g&#39; &lt;&lt;&lt; NonDet f&#39;)
= NonDet h&#39; &lt;&lt;&lt; (NonDet $ g&#39; &lt;=&lt; f&#39;)
= NonDet $ h&#39; &lt;=&lt; (g&#39; &lt;=&lt; f&#39;)
= NonDet $ (h&#39; &lt;=&lt; g&#39;) &lt;=&lt; f&#39;
= (NonDet $ h&#39; &lt;=&lt; g&#39;) &lt;&lt;&lt; NonDet f&#39;
= (NonDet h&#39; &lt;&lt;&lt; NonDet g&#39;) &lt;&lt;&lt; NonDet f&#39;
= NonDet f&#39; &gt;&gt;&gt; (NonDet g&#39; &gt;&gt;&gt; NonDet h&#39;)
= f &gt;&gt;&gt; (g &gt;&gt;&gt; h)
```

以上より `NonDet` カテゴリーは結合性を満たしていることがわかりました．

### `(-&gt;)` カテゴリーが `Category` 則を満たすことの確認

通常の函数 `(-&gt;)` については，恒等性 `Cat.id &gt;&gt;&gt; f = f &gt;&gt;&gt; Cat.id = f` は通常の函数の恒等性 `f . id = id . f = f`, 結合性 `(f &gt;&gt;&gt; g) &gt;&gt;&gt; h = f &gt;&gt;&gt; (g &gt;&gt;&gt; h)` は通常の函数合成の結合性 `h . (g . f) = (h . g) . f` となり，`Category` 則を満たしていることがわかります．


## もっと `Category` 
通常の函数 `(-&gt;)` と非決定性計算 `NonDet` が `Category` のインスタンスであるということがわかりました．
`Category` のインスタンスになれるものは他にもたくさん考えることができますが，どれにも共通しているのは入力と出力がある「計算」であるということです．

詳しくは参考文献「関数プログラミングの楽しみ」を読むかググるか強い人に聞くといいと思います．

- 状態変換子

```hs
newtype StateA s i o = StateA ((s, i) -&gt; (s, o))
```

- 写像変換子

```hs
newtype MapTrans s i o = MapTrans ((s -&gt; i) -&gt; (s -&gt; o))
```

- 単純オートマトン

```hs
newtype Auto i o = Auto (i -&gt; (o, Auto i o))
```

以下のページで詳しく解説されています
[Intro to Machines &amp; Arrows (Part 1: Stream and Auto) · in Code](http://blog.jle.im/entry/intro-to-machines-arrows-part-1-stream-and &quot;Intro to Machines &amp; Arrows (Part 1: Stream and Auto) · in Code&quot;)
[Auto as Category, Applicative &amp; Arrow (Intro to Machines/Arrows Part 2) · in Code](http://blog.jle.im/entry/auto-as-category-applicative-arrow-intro-to-machines &quot;Auto as Category, Applicative &amp; Arrow (Intro to Machines/Arrows Part 2) · in Code&quot;)

- Reader

```hs
newtype ReaderA s i o = ReaderA ((s, i) -&gt; o)
```

- Writer

```hs
newtype WriterA w i o = WriterA (i -&gt; (w, o))
```

- Kleisli

```hs
newtype Kleisli m i o = Kleisli (i -&gt; m o)
```
今回作った `NonDet` カテゴリーは `i -&gt; [o]` という計算をもっていましたが，リスト以外でも任意のモナドを返す計算 `i -&gt; m o` はカテゴリーにすることができます．`Kleisli` カテゴリーはそのことを表しています．
実際，Kleisli カテゴリーのインスタンス宣言は以下のようになっています (`Control.Arrow` モジュール[^8])

```hs:Control.Arrow
instance Monad m =&gt; Category (Kleisli m) where
    id = Kleisli return
    (Kleisli f) . (Kleisli g) = Kleisli (\b -&gt; g b &gt;&gt;= f)
```

`(\b -&gt; g b &gt;&gt;= f)` は `f &lt;=&lt; g` と同値です．

# `Arrow`

`Control.Arrow` モジュールには `Category` 型クラスを拡張した (?) `Arrow` 型クラスが定義されています．
`Arrow` にも触れようかと思いましたが力尽きたのでとりあえずここまでにします．



# 参考文献

Jeremy Gibbons and Oege de Moor 編，山下伸夫訳 「関数プログラミングの楽しみ」 (オーム社) 2010, 215-238

Miran Lipovača 著，田中英行・村主崇行訳 「すごい Haskell たのしく学ぼう！」 (オーム社) 2012

# あとがき

最後のほうが投げやりになってしまったのと，自分もまだ勉強中のため間違い等等あると思います．指摘などいただけると嬉しいです．
Arrow のすごさに感動している年末です．

# 注釈

[^1]: let 函数 = 関数
[^2]: すごい H 本の `Prob` モナドを使うと，各状態の確率も表せそうです．
[^3]: input, output
[^4]: nondeterministic (非決定性の)
[^5]: `Control.Category` モジュールは base パッケージに含まれています．
[^6]: `a -&gt; b` は `(-&gt;) a b` と書くことができます．
[^7]: `Control.Category` モジュール内では `import qualified Prelude` しています．
[^8]: `Control.Arrow` モジュールは base パッケージに含まれています．
</textarea><input type="submit" name="commit" value="Save changes" data-disable-with="Save changes" /></form></div></section></div><div class="col-sm-3"><div class="socialButtons"><div class="socialButtons_twitter"><a class="twitter-share-button" data-text="多価関数と Category by @CyLomw on @Qiita" data-url="http://qiita.com/CyLomw/items/a618b7c7326d9abede63" href="https://twitter.com/share">Tweet</a></div><div class="socialButtons_hatebu"><a class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" data-hatena-bookmark-title="多価関数と Category" href="http://b.hatena.ne.jp/entry/http://qiita.com/CyLomw/items/a618b7c7326d9abede63" title="Add to Hatena Bookmark"><img alt="Add to Hatena Bookmark" height="20" src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" style="border: none;" width="20" /></a><script async="async" charset="utf-8" src="https://b.st-hatena.com/js/bookmark_button.js" type="text/javascript"></script></div><div class="socialButtons_googlePlus"><div class="g-plusone" data-href="http://qiita.com/CyLomw/items/a618b7c7326d9abede63" data-size="medium"></div></div><div class="socialButtons_facebook"><div class="fb-like" data-action="like" data-href="http://qiita.com/CyLomw/items/a618b7c7326d9abede63" data-layout="button_count" data-share="false" data-show-faces="false"></div></div><div class="socialButtons_pocket"><a class="pocket-btn" data-lang="en" data-pocket-count="horizontal" data-pocket-label="pocket"></a></div></div><section class="itemsShowAuthorInfo" itemprop="author" itemscope="" itemtype="http://schema.org/Person"><a href="/CyLomw"><img alt="" class="itemsShowAuthorInfo_userIcon" itemprop="image" src="https://qiita-image-store.s3.amazonaws.com/0/64300/profile-images/1473696539" /></a><div class="itemsShowAuthorInfo_profileStats"><strong class="itemsShowAuthorInfo_userName" itemprop="name"><a itemprop="url" href="/CyLomw">CyLomw</a></strong><div class="itemsShowAuthorInfo_contribution"><span class="itemsShowAuthorInfo_count">181</span><span class="itemsShowAuthorInfo_unit">Contribution</span></div><div data-react-class="T.UserFollowButton" data-react-props="{&quot;url_name&quot;:&quot;CyLomw&quot;,&quot;initial_followed_by&quot;:false,&quot;size&quot;:&quot;btn-xs&quot;,&quot;position&quot;:&quot;author-info&quot;}"></div></div><section class="itemsShowAuthorPopularItems"><h5 class="itemsShowAuthorPopularItems_sectionTitle">Popular Posts</h5><ul class="itemsShowAuthorPopularItems_posts list-unstyled"><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/CyLomw/items/61b247f209a6d49e5017">Haskell 上で簡単なプログラミング言語を作る</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/CyLomw/items/a618b7c7326d9abede63">多価関数と Category</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/CyLomw/items/82362e2766e10561641a">Haskell でノベルゲームスクリプトのようなものを作る</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/CyLomw/items/eb543cff8715e4f441a3">Arrow を理解する (まとめ)</a></li><li itemscope="" itemtype="http://schema.org/Article"> <a itemprop="url" track="click" data-label="AuthorPopularItemsAtSidebar" href="/CyLomw/items/7e72e98cfe1c8026df2a">GHC 拡張を使って直積っぽい型の表記とかしてみる</a></li></ul></section></section><div class="scroll-chaser"><div class="google-adsense"><style>.test-text-responsible { width: 200px; height: 200px; }@media(min-width: 1200px) {  .test-text-responsible { width: 250px; height: 250px; }}@media(max-width: 979px) and (min-width: 768px) {  .test-text-responsible { width: 120px; height: 240px; }}@media(max-width: 767px) {  .test-text-responsible { width: 320px; height: 50px; }}</style><script async="" src="http://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><ins class="adsbygoogle test-text-responsible" data-ad-client="ca-pub-8127218772604357" data-ad-slot="3880091879" style="display:inline-block"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script></div></div><div data-react-class="T.Toc" data-react-props="{&quot;body&quot;:&quot;\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%A4%9A%E4%BE%A1%E5%87%BD%E6%95%B0\&quot;\u003e多価函数\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%A4%9A%E4%BE%A1%E5%87%BD%E6%95%B0%E3%81%A8%E3%81%AF\&quot;\u003e多価函数とは\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%A4%9A%E4%BE%A1%E5%87%BD%E6%95%B0%E3%81%AF%E5%87%BD%E6%95%B0%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%84\&quot;\u003e多価函数は函数ではない？\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E9%9D%9E%E6%B1%BA%E5%AE%9A%E6%80%A7%E8%A8%88%E7%AE%97\&quot;\u003e非決定性計算\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#nondet-i-o-%E5%9E%8B\&quot;\u003e\u003ccode\u003eNonDet i o\u003c/code\u003e 型\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#type\&quot;\u003e\u003ccode\u003etype\u003c/code\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#data\&quot;\u003e\u003ccode\u003edata\u003c/code\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#newtype\&quot;\u003e\u003ccode\u003enewtype\u003c/code\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E8%A8%88%E7%AE%97%E3%81%AE%E5%90%88%E6%88%90%E3%81%A8-category\&quot;\u003e計算の合成と \u003ccode\u003eCategory\u003c/code\u003e\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E9%9D%9E%E6%B1%BA%E5%AE%9A%E6%80%A7%E8%A8%88%E7%AE%97%E3%81%AE%E5%90%88%E6%88%90\&quot;\u003e非決定性計算の合成\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#controlcategory\&quot;\u003e\u003ccode\u003eControl.Category\u003c/code\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#nondet-%E3%82%92-category-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9%E3%81%AB%E3%81%99%E3%82%8B\&quot;\u003e\u003ccode\u003eNonDet\u003c/code\u003e を \u003ccode\u003eCategory\u003c/code\u003e のインスタンスにする\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#controlcategory-%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AE%E4%BB%96%E3%81%AE%E5%87%BD%E6%95%B0\&quot;\u003e\u003ccode\u003eControl.Category\u003c/code\u003e モジュールの他の函数\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E9%80%9A%E5%B8%B8%E3%81%AE%E5%87%BD%E6%95%B0%E3%82%82-category-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%82%BF%E3%83%B3%E3%82%B9\&quot;\u003e通常の函数も \u003ccode\u003eCategory\u003c/code\u003e のインスタンス\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#category-%E5%89%87\&quot;\u003e\u003ccode\u003eCategory\u003c/code\u003e 則\u003c/a\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#nondet-%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%83%BC%E3%81%8C-category-%E5%89%87%E3%82%92%E6%BA%80%E3%81%9F%E3%81%99%E3%81%93%E3%81%A8%E3%81%AE%E7%A2%BA%E8%AA%8D\&quot;\u003e\u003ccode\u003eNonDet\u003c/code\u003e カテゴリーが \u003ccode\u003eCategory\u003c/code\u003e 則を満たすことの確認\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#--%E3%82%AB%E3%83%86%E3%82%B4%E3%83%AA%E3%83%BC%E3%81%8C-category-%E5%89%87%E3%82%92%E6%BA%80%E3%81%9F%E3%81%99%E3%81%93%E3%81%A8%E3%81%AE%E7%A2%BA%E8%AA%8D\&quot;\u003e\u003ccode\u003e(-\u0026gt;)\u003c/code\u003e カテゴリーが \u003ccode\u003eCategory\u003c/code\u003e 則を満たすことの確認\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E3%82%82%E3%81%A3%E3%81%A8-category\&quot;\u003eもっと \u003ccode\u003eCategory\u003c/code\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#arrow\&quot;\u003e\u003ccode\u003eArrow\u003c/code\u003e\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE\&quot;\u003e参考文献\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E3%81%82%E3%81%A8%E3%81%8C%E3%81%8D\&quot;\u003eあとがき\u003c/a\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003ca href=\&quot;#%E6%B3%A8%E9%87%88\&quot;\u003e注釈\u003c/a\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n&quot;,&quot;wrapper&quot;:&quot;#article-body-wrapper&quot;}"></div></div></div><div class="row"><div class="col-sm-9"><div class="ArticleFooter__menu"><div class="s-flex-align-center"><div class="js-likebutton" data-props="{&quot;like_status&quot;:false,&quot;like_count&quot;:26,&quot;show_count&quot;:true,&quot;uuid&quot;:&quot;a618b7c7326d9abede63&quot;,&quot;likable_type&quot;:&quot;Article&quot;,&quot;position&quot;:&quot;article-footer&quot;}"></div><div class="ArticleFooter__userList"><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="yu-i9"><a itemprop="url" href="/yu-i9"><img alt="yu-i9" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/57513/profile-images/1473694353" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="myuon_myon"><a itemprop="url" href="/myuon_myon"><img alt="myuon_myon" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/8867/profile-images/1473681176" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="mrk_21"><a itemprop="url" href="/mrk_21"><img alt="mrk_21" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/20400/profile-images/1473683001" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="techno-tanoC"><a itemprop="url" href="/techno-tanoC"><img alt="techno-tanoC" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/49469/profile-images/1473691739" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="ykominami"><a itemprop="url" href="/ykominami"><img alt="ykominami" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/4321/profile-images/1473756115" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="HirofumiYashima"><a itemprop="url" href="/HirofumiYashima"><img alt="HirofumiYashima" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/43487/profile-images/1473689546" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="7shi"><a itemprop="url" href="/7shi"><img alt="7shi" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/32057/profile-images/1473685823" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="objectx"><a itemprop="url" href="/objectx"><img alt="objectx" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/9635/profile-images/1473681490" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="JunKikuchi"><a itemprop="url" href="/JunKikuchi"><img alt="JunKikuchi" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/13181/profile-images/1473682708" /></a></div></div><div class="ArticleFooter__user"><div class="js-hovercard" data-hovercard-target-name="mikamix"><a itemprop="url" href="/mikamix"><img alt="mikamix" class="thumb thumb--xs" src="https://qiita-image-store.s3.amazonaws.com/0/16900/profile-images/1473681998" /></a></div></div><div class="ArticleFooter__user"><a href="/CyLomw/items/a618b7c7326d9abede63/likers"><span class="fa fa-ellipsis-h"></span></a></div></div></div><div class="u-flex u-align-center"><div class="ArticleFooter__stock"><div class="js-stockbutton" data-position="footer_menu" data-props="{&quot;stock_status&quot;:false}"></div></div><div class="ArticleFooter__editRequest"><a class="u-link-no-underline" data-toggle="tooltip" title="You can propose improvements about the article to the author 💪" href="/drafts/a618b7c7326d9abede63/edit"><span class="fa fa-send-o fa-lg"></span> <span>Edit request</span></a></div><div class="dropdown ArticleFooter__dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#"><span class="fa fa-ellipsis-h"></span></a><ul class="dropdown-menu dropdown-menu-right"><li><a href="/CyLomw/items/a618b7c7326d9abede63.md"><span class="fa fa-fw fa-file-text-o"></span> Show article as Markdown</a></li><li><a data-target=".js-report-form" data-toggle="modal" href="#"><i class="fa fa-fw fa-flag"></i> Report article</a></li></ul></div></div></div><ul class="references js-referencesView"><li class="references_header"><i class="fa fa-fw fa-link"></i> Linked from these articles</li><li class="references_reference js-reference"><span>Linked from </span><a href="/CyLomw/items/ff1e5d1600291c952c5e#_reference-295f99d5e9381b6b52d0"><img alt="" width="18" height="18" src="https://qiita-image-store.s3.amazonaws.com/0/64300/profile-images/1473696539" />綱渡りと Category (と，Kleisli)</a><time class="references_datetime js-dateTimeView" datetime="2014-12-29T10:12:36+00:00">about 2 years ago</time></li><li class="references_reference js-reference"><span>Linked from </span><a href="/CyLomw/items/eb543cff8715e4f441a3#_reference-ee23c19c96222d612f01"><img alt="" width="18" height="18" src="https://qiita-image-store.s3.amazonaws.com/0/64300/profile-images/1473696539" />Arrow を理解する (まとめ)</a><time class="references_datetime js-dateTimeView" datetime="2015-01-02T15:57:37+00:00">about 2 years ago</time></li></ul><div class="itemsShowBody_articleColumnFooter"><div class="socialButtons"><div class="socialButtons_twitter"><a class="twitter-share-button" data-text="多価関数と Category by @CyLomw on @Qiita" data-url="http://qiita.com/CyLomw/items/a618b7c7326d9abede63" href="https://twitter.com/share">Tweet</a></div><div class="socialButtons_hatebu"><a class="hatena-bookmark-button" data-hatena-bookmark-layout="simple-balloon" data-hatena-bookmark-title="多価関数と Category" href="http://b.hatena.ne.jp/entry/http://qiita.com/CyLomw/items/a618b7c7326d9abede63" title="Add to Hatena Bookmark"><img alt="Add to Hatena Bookmark" height="20" src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" style="border: none;" width="20" /></a><script async="async" charset="utf-8" src="https://b.st-hatena.com/js/bookmark_button.js" type="text/javascript"></script></div><div class="socialButtons_googlePlus"><div class="g-plusone" data-href="http://qiita.com/CyLomw/items/a618b7c7326d9abede63" data-size="medium"></div></div><div class="socialButtons_facebook"><div class="fb-like" data-action="like" data-href="http://qiita.com/CyLomw/items/a618b7c7326d9abede63" data-layout="button_count" data-share="false" data-show-faces="false"></div></div><div class="socialButtons_pocket"><a class="pocket-btn" data-lang="en" data-pocket-count="horizontal" data-pocket-label="pocket"></a></div></div></div><div class="itemsShowComment_wrapper" id="comments"><div data-react-class="T.CommentListContainer" data-react-props="{&quot;currentUser&quot;:null,&quot;initialComments&quot;:[],&quot;monthly_public_image_uploadable_size_limit&quot;:null,&quot;total_uploaded_public_image_size_in_current_month&quot;:null,&quot;item&quot;:{&quot;id&quot;:217639,&quot;uuid&quot;:&quot;a618b7c7326d9abede63&quot;,&quot;suspended&quot;:false,&quot;secret&quot;:false},&quot;owner&quot;:{&quot;url_name&quot;:&quot;CyLomw&quot;},&quot;is_team&quot;:false,&quot;is_project&quot;:false,&quot;logged_in&quot;:false,&quot;polling&quot;:false,&quot;mention_candidates&quot;:[{&quot;id&quot;:64300,&quot;url_name&quot;:&quot;CyLomw&quot;,&quot;profile_image_url&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/64300/profile-images/1473696539&quot;}]}">Comments Loading...</div></div></div></div></div></article><div class="js-report-form modal fade reportForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Report article</h4></div><div class="modal-body"><form action="/reports" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="y45ff48g2xGpkrRWe/BOA/aSNRxjFzVtjzExxU7bHoClDMQnFA7iWlZBAUoLBfBaltURr/TTb5qz7zg+r9UQRg==" /><input type="hidden" name="redirect_path" id="redirect_path" value="/CyLomw/items/a618b7c7326d9abede63" /><input type="hidden" name="item_uuid" id="item_uuid" value="a618b7c7326d9abede63" /><p>Help us understand the problem. What is going on with this item?</p><br /><div class="form-group"><ul class="list-unstyled"><li><label><input type="radio" name="report_type" id="report_type_spam" value="spam" required="required" /> It&#39;s spam </label></li><li><label><input type="radio" name="report_type" id="report_type_harassment" value="harassment" required="required" /> It&#39;s abusive or harmful </label></li><li><label><input type="radio" name="report_type" id="report_type_inappropriate_content" value="inappropriate_content" required="required" /> It contains inappropriate content </label></li></ul></div><div class="reportForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary reportForm_submitButton"><i class="fa fa-send"></i> Submit</button></div></form></div></div></div></div><script id="js-item" type="application/json">{ "url": "http://qiita.com/CyLomw/items/a618b7c7326d9abede63", "id": 217639, "uuid": "a618b7c7326d9abede63" }</script><script class="js-user" type="application/json">{&quot;id&quot;:64300,&quot;url_name&quot;:&quot;CyLomw&quot;,&quot;profile_image_url&quot;:&quot;https://qiita-image-store.s3.amazonaws.com/0/64300/profile-images/1473696539&quot;}</script><script language="JavaScript" src="//cdn.bigmining.com/private/js/qiita_bigmining.js" type="text/javascript"></script></div><footer class="footer"><div class="footer_inner"><div class="footer_container"><ul class="footer_links-left"><li class="footer_link"><a class="footer_copyright" href="http://increments.co.jp">© 2011-2017 Increments Inc.</a></li><li class="footer_link"><a href="http://qiita.com/terms">Terms</a></li><li class="footer_link"><a href="http://qiita.com/privacy">Privacy</a></li><li class="footer_link"><a href="http://help.qiita.com">Help</a></li><li class="footer_link"><a href="https://increments.zendesk.com/anonymous_requests/new">Contact</a></li></ul><ul class="footer_links-right"><li class="footer_link"><a href="http://qiita.com/about">About</a></li><li class="footer_link"><a href="/users">Users</a></li><li class="footer_link"><a href="/tags">Tags</a></li><li class="footer_link"><a href="http://blog.qiita.com">Blog</a></li><li class="footer_link"><a href="http://qiita.com/api/v2/docs">API</a></li><li class="footer_link"><a href="https://teams.qiita.com/">Team</a></li><li class="footer_link"><a href="http://kobito.qiita.com">Kobito</a></li><li class="footer_link"><a class="js-public-form-feedback-link" data-target=".js-feedback-form" data-toggle="modal" href=""><i class="fa fa-heart"></i> Feedback <i class="fa fa-caret-down"></i></a></li></ul></div></div></footer><div class="js-feedback-form modal fade feedbackForm"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button name="button" type="submit" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title">Feedback</h4></div><div class="modal-body"><form class="js-feedback-form-form" action="/feedbacks" accept-charset="UTF-8" method="post"><input name="utf8" type="hidden" value="&#x2713;" /><input type="hidden" name="authenticity_token" value="wugzR7HEofrVuRBJgoKI9praDU/HS6qOO6Cha4CbVc2saqgfKuqYsSpqpVXydzav+p0p/FCP8HkHfqiQYZVbCw==" /><input type="hidden" name="redirect_path" id="redirect_path" value="/CyLomw/items/a618b7c7326d9abede63" /><div class="form-group"><textarea name="feedback[message]" id="feedback_message" class="form-control js-feedback-form-text-area" placeholder="Please give us any feedback about Qiita." required="required" rows="5">
</textarea></div><div class="feedbackForm_submitButtonContainer"><button name="button" type="submit" class="btn btn-primary feedbackForm_submitButton"><i class="fa fa-send"></i> Submit</button><p class="feedbackForm_note">We don&#39;t reply to any feedback.<br />If you need help with Qiita, please send a support request from <a href="https://increments.zendesk.com/anonymous_requests/new">here</a>.</p></div><div style="position:fixed;top:-99999px;opacity:0.0001;"><input name="feedback[name]" type="text" /></div></form></div></div></div></div><script>// if (window.mixpanel instanceof Element) {
//   window.mixpanel = [];
// }
// (function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");
// for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src="//cdn.mxpnl.com/libs/mixpanel-2.2.min.js";e=f.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}})(document,window.mixpanel||[]);</script><script src="http://cdn.qiita.com/assets/public-8c6201a66dc6db6f64a9017391c319bf.min.js"></script><script>
  (function () {
    var script = document.getElementsByTagName('script')[0];
    var load = function (src, id) {
      var el = document.createElement('script');
      el.async = true;
      el.src = src;
      el.id = id;
      script.parentNode.insertBefore(el, script);
    };
      // Optimizely
      load('//cdn.optimizely.com/js/52738645.js', 'optimizely-jssdk');
      // Google Analytics
      window._gaq = window._gaq || [];
      var isCareer = location.hostname.split('.')[0] == 'career';
      if (isCareer) {
        window._gaq.push(['_setAccount', 'UA-24675221-11']);
        window._gaq.push(['_setDomainName', 'qiita.com']);
      } else {
        window._gaq.push(['_setAccount', 'UA-24675221-1']);
      }
      window._gaq.push(['_setCustomVar', 1, 'logged_in', 'false', 2]);
      window._gaq.push(['_trackPageview']);
      var src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      load(src, 'google-analytics-jssdk');
    // Google Analytics - Universal Analytics
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-24675221-12', {
          
        });
        ga('set', 'dimension1', 'false');
        ga('set', 'dimension3', 'false');
      ga('require', 'displayfeatures');
      ga('set', 'forceSSL', true);
      ga('send', 'pageview');
    // Google Tag Manager
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      '//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-TBQWPN');
  })();
</script>
</body></html>